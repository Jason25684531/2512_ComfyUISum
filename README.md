# ğŸ¨ ComfyUI Studio - AI Creative Platform

<div align="center">

**å°ˆæ¥­ç´š AI åœ–åƒç”Ÿæˆå¹³å° | åŸºæ–¼ ComfyUI çš„ Web ç•Œé¢**

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://www.python.org/)
[![Flask](https://img.shields.io/badge/Flask-3.0+-green.svg)](https://flask.palletsprojects.com/)
[![ComfyUI](https://img.shields.io/badge/ComfyUI-Latest-purple.svg)](https://github.com/comfyanonymous/ComfyUI)
[![Docker](https://img.shields.io/badge/Docker-Ready-blue.svg)](https://www.docker.com/)

[åŠŸèƒ½ç‰¹é»](#-æ ¸å¿ƒåŠŸèƒ½) â€¢ [å¿«é€Ÿé–‹å§‹](#-å¿«é€Ÿé–‹å§‹) â€¢ [æ¶æ§‹èªªæ˜](#-ç³»çµ±æ¶æ§‹) â€¢ [API æ–‡æª”](#-api-ç«¯é») â€¢ [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)

</div>

---

## ğŸ“‹ ç›®éŒ„

- [é …ç›®æ¦‚è¿°](#-é …ç›®æ¦‚è¿°)
- [æ ¸å¿ƒåŠŸèƒ½](#-æ ¸å¿ƒåŠŸèƒ½)
- [ç³»çµ±æ¶æ§‹](#-ç³»çµ±æ¶æ§‹)
- [æŠ€è¡“æ£§](#-æŠ€è¡“æ£§)
- [å¿«é€Ÿé–‹å§‹](#-å¿«é€Ÿé–‹å§‹)
- [æ–‡ä»¶çµæ§‹](#-æ–‡ä»¶çµæ§‹)
- [API ç«¯é»](#-api-ç«¯é»)
- [é…ç½®èªªæ˜](#-é…ç½®èªªæ˜)
- [Ngrok å…¬ç¶²å­˜å–](#-ngrok-å…¬ç¶²å­˜å–)
- [é–‹ç™¼æŒ‡å—](#-é–‹ç™¼æŒ‡å—)
- [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)
- [æ›´æ–°æ—¥èªŒ](#-æ›´æ–°æ—¥èªŒ)
- [ç³»çµ±ç›£æ§](#-ç³»çµ±ç›£æ§)

---

## ğŸš€ é …ç›®æ¦‚è¿°

ComfyUI Studio æ˜¯ä¸€å€‹ç¾ä»£åŒ–çš„ AI åœ–åƒç”Ÿæˆå¹³å°ï¼Œæä¾›ç›´è§€çš„ Web ç•Œé¢ä¾†æ“ä½œå¼·å¤§çš„ ComfyUI å¾Œç«¯ã€‚æ¡ç”¨å¾®æœå‹™æ¶æ§‹ï¼Œæ”¯æŒä»»å‹™éšŠåˆ—ã€å¯¦æ™‚é€²åº¦è¿½è¹¤ã€æ­·å²è¨˜éŒ„ç®¡ç†ï¼Œä¸¦å…§å»º Ngrok æ”¯æŒå¯¦ç¾å…¬ç¶²å­˜å–ã€‚

### é—œéµç‰¹æ€§

- âœ¨ **ç¾ä»£åŒ– UI** - åŸºæ–¼ Tailwind CSS çš„æµæš¢ç»ç’ƒæ…‹è¨­è¨ˆ
- ğŸ¯ **ä»»å‹™éšŠåˆ—** - Redis é©…å‹•çš„ç•°æ­¥ä»»å‹™è™•ç†
- ğŸ“Š **å¯¦æ™‚è¿½è¹¤** - WebSocket é€£æ¥æä¾›å³æ™‚é€²åº¦æ›´æ–°
- ğŸ–¼ï¸ **åœ–ç‰‡ç®¡ç†** - MySQL æŒä¹…åŒ–å­˜å„²ï¼Œæ”¯æŒæ­·å²è¨˜éŒ„æŸ¥è©¢
- ğŸ“± **éŸ¿æ‡‰å¼è¨­è¨ˆ** - å®Œæ•´æ”¯æŒæ¡Œé¢ç«¯å’Œç§»å‹•ç«¯
- ğŸŒ **å…¬ç¶²è¨ªå•** - å…§å»º Ngrok æ”¯æŒï¼Œä¸€éµåˆ†äº«çµ¦ä»»ä½•äºº
- ğŸ³ **å®¹å™¨åŒ–** - Docker Compose ä¸€éµéƒ¨ç½²åŸºç¤æœå‹™
- ğŸ”„ **è‡ªå‹•åŒ–** - å¾é…ç½®åˆ°éƒ¨ç½²çš„å®Œæ•´è‡ªå‹•åŒ–æµç¨‹
- ğŸ›¡ï¸ **å®‰å…¨åŠ å›º** - Rate Limitingã€Input Validationã€Path Traversal Protection (Phase 6)
- ğŸ“Š **ç³»çµ±ç›£æ§** - Real-time HUDã€Metrics APIã€Worker Heartbeat (Phase 6)

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. åœ–åƒç”Ÿæˆå·¥ä½œæµ

| å·¥ä½œæµé¡å‹ | åŠŸèƒ½æè¿° | æ”¯æŒåƒæ•¸ |
|-----------|---------|---------|
| **Text to Image** | æ–‡å­—è½‰åœ–åƒ | Prompt, Model, Aspect Ratio, Batch Size, Seed |
| **Face Swap** | äººè‡‰æ›¿æ› | Source Image, Target Image, Model |
| **Image Blend** | å¤šåœ–æ··åˆ | Multiple Images, Blend Mode, Opacity |
| **Single Edit** | å–®åœ–ç·¨è¼¯ | Image, Edit Instructions, Strength |
| **Sketch to Image** | è‰åœ–è½‰åœ–åƒ | Sketch, Style, Detail Level |
| **Virtual Human** ğŸ†• | è™›æ“¬äººèªªè©± (InfiniteTalk) | Audio File, Prompt Text, Seed |

### 2. æ ¸å¿ƒæ¨¡å¡Š

#### ğŸ¨ Frontend (Web UI)
- ç»ç’ƒæ…‹è¨­è¨ˆé¢¨æ ¼
- å¯¦æ™‚ä»»å‹™é€²åº¦é¡¯ç¤º
- åœ–ç‰‡ç•«å»Šèˆ‡ä¸‹è¼‰
- éŸ¿æ‡‰å¼ç§»å‹•ç«¯æ”¯æŒ

#### ğŸ”§ Backend (Flask API)
- RESTful API æ¥å£
- ä»»å‹™æäº¤èˆ‡ç‹€æ…‹æŸ¥è©¢
- éœæ…‹æ–‡ä»¶æœå‹™
- å®Œæ•´çš„ CORS æ”¯æŒ

#### ğŸ‘· Worker (Task Processor)
- ç•°æ­¥ä»»å‹™è™•ç†
- ComfyUI Workflow è§£æ
- WebSocket é€²åº¦ç›£è½
- è‡ªå‹•é‡è©¦æ©Ÿåˆ¶

#### ğŸ—„ï¸ æ•¸æ“šå±¤
- **MySQL**: æŒä¹…åŒ–ä»»å‹™è¨˜éŒ„
- **Redis**: ä»»å‹™éšŠåˆ—èˆ‡ç‹€æ…‹ç·©å­˜
- **File System**: åœ–ç‰‡å­˜å„²ç®¡ç†

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ•´é«”æ¶æ§‹åœ– (å« Ngrok å…¬ç¶²å­˜å–)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ğŸŒ Ngrok å…¬ç¶²å­˜å–å±¤ (å¯é¸)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  https://[your-id].ngrok-free.app                    â”‚  â”‚
â”‚  â”‚  â†“ (è‡ªå‹•æ˜ å°„)                                        â”‚  â”‚
â”‚  â”‚  http://localhost:5000                               â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  å•Ÿå‹•æ–¹å¼:                                           â”‚  â”‚
â”‚  â”‚  1. start_ngrok.bat  â†’ å•Ÿå‹• Ngrok éš§é“              â”‚  â”‚
â”‚  â”‚  2. update_ngrok_config.ps1 â†’ è‡ªå‹•æ›´æ–°é…ç½®          â”‚  â”‚
â”‚  â”‚  3. å‹•æ…‹å¯«å…¥ .env èˆ‡ frontend/config.js             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTPS Tunnel
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœ¬åœ°è¨ªå• / Local Access (Port 5000)             â”‚
â”‚                   http://localhost:5000/                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä½¿ç”¨è€…ä»‹é¢ (Frontend)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Dashboard â”‚  â”‚ Canvas   â”‚  â”‚ Gallery  â”‚  â”‚ Settings â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚             â”‚             â”‚           â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                   HTTP REST API                              â”‚
â”‚  ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ: æ¡Œé¢ç«¯ + ç§»å‹•ç«¯è‡ªå‹•é©é…                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Backend API (Flask - Port 5000)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  çµ±ä¸€ç«¯å£æ¶æ§‹ (Phase 5 å„ªåŒ–)                        â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚  â”‚
â”‚  â”‚  POST /api/generate  â†’ æäº¤ä»»å‹™åˆ° Redis Queue       â”‚  â”‚
â”‚  â”‚  GET  /api/status    â†’ æŸ¥è©¢ Redis ä»»å‹™ç‹€æ…‹          â”‚  â”‚
â”‚  â”‚  GET  /api/history   â†’ æŸ¥è©¢ MySQL æ­·å²è¨˜éŒ„ (åˆ†é )   â”‚  â”‚
â”‚  â”‚  GET  /api/models    â†’ æƒæ ComfyUI æ¨¡å‹ç›®éŒ„        â”‚  â”‚
â”‚  â”‚  GET  /              â†’ å‰ç«¯ç¶²é æœå‹™ (index.html)    â”‚  â”‚
â”‚  â”‚  GET  /style.css     â†’ éœæ…‹ CSS æ–‡ä»¶                â”‚  â”‚
â”‚  â”‚  GET  /outputs/*     â†’ éœæ…‹æª”æ¡ˆæœå‹™ (ç”Ÿæˆåœ–ç‰‡)      â”‚  â”‚
â”‚  â”‚  POST /api/cancel    â†’ å–æ¶ˆåŸ·è¡Œä¸­çš„ä»»å‹™             â”‚  â”‚
â”‚  â”‚  GET  /api/health    â†’ å¥åº·æª¢æŸ¥ (Redis + MySQL)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  ğŸ“ æ—¥èªŒç³»çµ±: logs/backend.log                              â”‚
â”‚     - RotatingFileHandler (5MB Ã— 3 backups)                â”‚
â”‚     - è¨˜éŒ„æ‰€æœ‰ HTTP è«‹æ±‚ (Method, Path, Status)            â”‚
â”‚     - è¨˜éŒ„ Exception Stack Trace                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                      â”‚
                    â–¼                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Redis (Port 6379)  â”‚  â”‚  MySQL (Port 3307)  â”‚
        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚  Queue:             â”‚  â”‚  Table: jobs        â”‚
        â”‚  - studio_jobs      â”‚  â”‚  - id, prompt       â”‚
        â”‚                     â”‚  â”‚  - workflow, model  â”‚
        â”‚  Hash:              â”‚  â”‚  - status, output   â”‚
        â”‚  - job:status:{id}  â”‚  â”‚  - created_at       â”‚
        â”‚  - TTL: 24h         â”‚  â”‚  - is_deleted       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                        â”‚
                   â”‚ BLPOP (é˜»å¡å¼è®€å–)      â”‚ è®€å¯«åŒæ­¥
                   â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Worker (Python å¾Œå°æœå‹™)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å®Œæ•´ä»»å‹™è™•ç†æµç¨‹:                                   â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚  â”‚
â”‚  â”‚  1. å¾ Redis Queue å–å¾—ä»»å‹™ (BLPOP studio_jobs)     â”‚  â”‚
â”‚  â”‚  2. è§£æ Workflow JSON ä¸¦æ³¨å…¥åƒæ•¸                   â”‚  â”‚
â”‚  â”‚  3. è™•ç† Base64 åœ–ç‰‡å­˜åˆ° ComfyUI/input/             â”‚  â”‚
â”‚  â”‚  4. é€é HTTP POST /prompt æäº¤åˆ° ComfyUI           â”‚  â”‚
â”‚  â”‚  5. é€é WebSocket /ws ç›£è½åŸ·è¡Œé€²åº¦ (0-100%)        â”‚  â”‚
â”‚  â”‚  6. è¤‡è£½è¼¸å‡ºåœ–ç‰‡åˆ° storage/outputs/                  â”‚  â”‚
â”‚  â”‚  7. æ›´æ–° Redis ç‹€æ…‹ + MySQL è¨˜éŒ„ (output_path)      â”‚  â”‚
â”‚  â”‚  8. å®šæœŸæ¸…ç†éæœŸæª”æ¡ˆ (inputs: 24h, outputs: 30å¤©)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  ğŸ“ æ—¥èªŒç³»çµ±: logs/worker.log                               â”‚
â”‚     - RotatingFileHandler (5MB Ã— 3 backups)                â”‚
â”‚     - è¨˜éŒ„ä»»å‹™ç”Ÿå‘½é€±æœŸ (é–‹å§‹ã€é€²åº¦ã€å®Œæˆã€å¤±æ•—)             â”‚
â”‚     - è¨˜éŒ„ ComfyUI é€£ç·šç‹€æ…‹å’Œé‡è©¦äº‹ä»¶                       â”‚
â”‚     - æ‰€æœ‰ print() å·²æ›¿æ›ç‚º logger.info/warning/error()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ HTTP API + WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ComfyUI (Port 8188) - AI åœ–åƒç”Ÿæˆå¼•æ“             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  HTTP API:                                            â”‚  â”‚
â”‚  â”‚  - POST /prompt       â†’ æäº¤ç”Ÿæˆä»»å‹™                  â”‚  â”‚
â”‚  â”‚  - POST /interrupt    â†’ ä¸­æ–·åŸ·è¡Œä¸­çš„ä»»å‹™              â”‚  â”‚
â”‚  â”‚  - GET  /system_stats â†’ ç³»çµ±ç‹€æ…‹æŸ¥è©¢                 â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  WebSocket:                                           â”‚  â”‚
â”‚  â”‚  - /ws                â†’ å³æ™‚é€²åº¦æ¨é€                  â”‚  â”‚
â”‚  â”‚    â”œâ”€ progress event  â†’ {value, max}                â”‚  â”‚
â”‚  â”‚    â”œâ”€ executing event â†’ {node, prompt_id}           â”‚  â”‚
â”‚  â”‚    â””â”€ executed event  â†’ {output: {images}}          â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  File System:                                         â”‚  â”‚
â”‚  â”‚  - input/  â†’ æ¥æ”¶ä¸Šå‚³åœ–ç‰‡                            â”‚  â”‚
â”‚  â”‚  - output/ â†’ ç”Ÿæˆçµæœè¼¸å‡º                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»»å‹™ç”Ÿå‘½é€±æœŸ

```
1. ç”¨æˆ¶æäº¤ â†’ 2. Backend é©—è­‰ â†’ 3. å¯«å…¥ MySQL â†’ 4. æ¨é€ Redis Queue
                                           â†“
5. Worker å–å‡º â†’ 6. è§£æ Workflow â†’ 7. æäº¤ ComfyUI â†’ 8. WebSocket ç›£è½
                                           â†“
9. çµæœè™•ç† â†’ 10. ä¿å­˜åœ–ç‰‡ â†’ 11. æ›´æ–°æ•¸æ“šåº« â†’ 12. å‰ç«¯è¼ªè©¢é¡¯ç¤º
```

### çµ±ä¸€ç«¯å£æ¶æ§‹ (Port 5000)

**é‡è¦**: è‡ª Phase 5 èµ·ï¼Œæ‰€æœ‰æœå‹™é€šé **Port 5000** çµ±ä¸€æä¾›ï¼š

```
localhost:5000/              â†’ å‰ç«¯ index.html
localhost:5000/style.css     â†’ CSS æ¨£å¼æ–‡ä»¶
localhost:5000/api/generate  â†’ API ç«¯é»
localhost:5000/outputs/*     â†’ ç”Ÿæˆåœ–ç‰‡
```

**Ngrok æ˜ å°„**:
```
https://[your-id].ngrok-free.app/  â†’ å°æ‡‰ localhost:5000/
```

é€™å€‹æ¶æ§‹æ¶ˆé™¤äº†ä¹‹å‰çš„ç«¯å£æ··äº‚ï¼ˆPort 8000 vs Port 5000ï¼‰ï¼Œç¢ºä¿æœ¬åœ°å’Œ Ngrok è¨ªå•å®Œå…¨ä¸€è‡´ã€‚

---

## ğŸ› ï¸ æŠ€è¡“æ£§

### å¾Œç«¯æŠ€è¡“
- **Python 3.11+** - ä¸»è¦é–‹ç™¼èªè¨€
- **Flask 3.0** - Web æ¡†æ¶
- **MySQL 8.0** - é—œä¿‚å‹æ•¸æ“šåº«
- **Redis 7.0** - å…§å­˜æ•¸æ“šåº«/æ¶ˆæ¯éšŠåˆ—
- **Docker** - å®¹å™¨åŒ–éƒ¨ç½²

### å‰ç«¯æŠ€è¡“
- **HTML5 / CSS3** - çµæ§‹èˆ‡æ¨£å¼
- **Tailwind CSS** - å¯¦ç”¨å„ªå…ˆçš„ CSS æ¡†æ¶
- **Vanilla JavaScript** - åŸç”Ÿ JSï¼Œç„¡æ¡†æ¶ä¾è³´
- **Lucide Icons** - ç¾ä»£åŒ–åœ–æ¨™åº«

### AI å¼•æ“
- **ComfyUI** - ç¯€é»å¼ AI åœ–åƒç”Ÿæˆå·¥å…·
- **Stable Diffusion** - åœ–åƒç”Ÿæˆæ¨¡å‹
- **Custom Workflows** - é å®šç¾©å·¥ä½œæµæ¨¡æ¿

### é–‹ç™¼å·¥å…·
- **Docker Compose** - å¤šå®¹å™¨ç·¨æ’
- **Ngrok** - å…¬ç¶²éš§é“æœå‹™
- **VS Code** - æ¨è–¦é–‹ç™¼ç’°å¢ƒ
- **Git** - ç‰ˆæœ¬æ§åˆ¶

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

> **å…¨æ–°çµ±ä¸€éƒ¨ç½²æ¶æ§‹ï¼** ç¾åœ¨æ”¯æ´ Windows/Linux æ··åˆéƒ¨ç½²ï¼Œä¸€å¥—é…ç½®å¤šç’°å¢ƒä½¿ç”¨ã€‚è©³è¦‹ [æ··åˆéƒ¨ç½²ç­–ç•¥æŒ‡å—](HYBRID_DEPLOYMENT_STRATEGY.md)

### éƒ¨ç½²æ–¹å¼é¸æ“‡

æœ¬å°ˆæ¡ˆæä¾›å…©ç¨®éƒ¨ç½²æ–¹å¼ï¼Œè«‹æ ¹æ“šéœ€æ±‚é¸æ“‡ï¼š

#### æ–¹å¼ 1: çµ±ä¸€æ¶æ§‹éƒ¨ç½² (æ¨è–¦ â­)

ä½¿ç”¨ Docker Compose Profiles å¯¦ç¾è·¨å¹³å°çµ±ä¸€éƒ¨ç½²ã€‚

**Windows é–‹ç™¼ç’°å¢ƒ (5åˆ†é˜)**
```batch
# 1. é…ç½®ç’°å¢ƒ
copy .env.unified.example .env
# ç·¨è¼¯ .env è¨­å®šç‚º Windows ç’°å¢ƒ

# 2. å•Ÿå‹•æœå‹™
cd scripts
start_unified_windows.bat
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [1] Infrastructure only (MySQL + Redis)               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚  å•Ÿå‹•å…§å®¹: MySQL (3307) + Redis (6379)                 â”‚
â”‚  Backend:  éœ€æ‰‹å‹•å•Ÿå‹• (python backend/src/app.py)      â”‚
â”‚  Worker:   éœ€æ‰‹å‹•å•Ÿå‹• (python worker/src/main.py)      â”‚
â”‚  é©ç”¨å ´æ™¯: æœ¬åœ°é–‹ç™¼é™¤éŒ¯ã€å³æ™‚ä»£ç¢¼ä¿®æ”¹                   â”‚
â”‚  Ngrok:    âŒ ç„¡æ³•ä½¿ç”¨ (Backend æœªé‹è¡Œ)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [2] Full stack with Docker Backend                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚  å•Ÿå‹•å…§å®¹: MySQL + Redis + Backend (Docker)            â”‚
â”‚  Backend:  å®¹å™¨åŒ–é‹è¡Œ (è‡ªå‹•å•Ÿå‹•)                       â”‚
â”‚  Worker:   éœ€æ‰‹å‹•å•Ÿå‹•                                   â”‚
â”‚  é©ç”¨å ´æ™¯: å®Œæ•´æ¸¬è©¦ã€Ngrok å…¬ç¶²å­˜å–                    â”‚
â”‚  Ngrok:    âœ… å¯ä½¿ç”¨                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [3] Full stack with Local Backend + Worker â­ æ¨è–¦    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚  å•Ÿå‹•å…§å®¹: MySQL + Redis + Backend + Worker (æœ¬åœ°)     â”‚
â”‚  Backend:  æœ¬åœ° Python é‹è¡Œ (è‡ªå‹•é–‹å•Ÿæ–°è¦–çª—)           â”‚
â”‚  Worker:   æœ¬åœ° Python é‹è¡Œ (è‡ªå‹•é–‹å•Ÿæ–°è¦–çª—)           â”‚
â”‚  é©ç”¨å ´æ™¯: å®Œæ•´é–‹ç™¼ã€å³æ™‚é™¤éŒ¯ã€Ngrok å…¬ç¶²å­˜å–          â”‚
â”‚  Ngrok:    âœ… å¯ä½¿ç”¨                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [4] Stop all services                                  â”‚
â”‚  åœæ­¢æ‰€æœ‰ Docker æœå‹™                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [5] View logs                                          â”‚
â”‚  æŸ¥çœ‹å®¹å™¨æ—¥èªŒ (å³æ™‚è¼¸å‡ºï¼ŒCtrl+C é€€å‡º)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [6] Rebuild containers                                 â”‚
â”‚  é‡å»ºå®¹å™¨ (æ¸…é™¤å¿«å–ï¼Œæ›´æ–° Dockerfile å¾Œä½¿ç”¨)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---------------------------------------------------------------------------
### ğŸ“Œ æ¨è–¦æµç¨‹: Windows é–‹ç™¼ + Ngrok å…¬ç¶²å­˜å–

# æ­¥é©Ÿ 1: å•Ÿå‹• ComfyUI (ç¨ç«‹çµ‚ç«¯)
D:\02_software\ComfyUI_windows_portable\run_nvidia_gpu.bat

# æ­¥é©Ÿ 2: å•Ÿå‹•å®Œæ•´å †ç–Š
cd D:\01_Project\2512_ComfyUISum\scripts
start_unified_windows.bat
é¸æ“‡ [3] Full stack with Local Backend + Worker â† æ¨è–¦ï¼

# æ­¥é©Ÿ 3: ç­‰å¾…æœå‹™å•Ÿå‹• (ç´„ 10 ç§’)
# æœƒè‡ªå‹•é–‹å•Ÿ Backend å’Œ Worker è¦–çª—

# æ­¥é©Ÿ 4: æ¸¬è©¦æœ¬åœ°è¨ªå•
ç€è¦½å™¨æ‰“é–‹: http://localhost:5000/

# æ­¥é©Ÿ 5: å•Ÿå‹• Ngrok å…¬ç¶²å­˜å– (å¯é¸)
cd D:\01_Project\2512_ComfyUISum\scripts
start_ngrok.bat

# æ­¥é©Ÿ 6: è¨ªå•å…¬ç¶² URL
è¤‡è£½ Ngrok URL (ä¾‹å¦‚: https://abc123.ngrok-free.app)
åœ¨ä»»ä½•è¨­å‚™è¨ªå•è©² URL
---------------------------------------------------------------------------
```

**Linux ç’°å¢ƒ (5åˆ†é˜)**
```bash
# 1. é…ç½®ç’°å¢ƒ
cp .env.unified.example .env
# ç·¨è¼¯ .env è¨­å®šç‚º Linux ç’°å¢ƒ

# 2. å•Ÿå‹•æœå‹™
cd scripts
chmod +x start_unified_linux.sh
./start_unified_linux.sh
é¸æ“‡ [1] Development (é–‹ç™¼) æˆ– [2] Production (ç”Ÿç”¢)
```

ğŸ“š **å®Œæ•´æŒ‡å—**: [HYBRID_DEPLOYMENT_STRATEGY.md](HYBRID_DEPLOYMENT_STRATEGY.md)

#### æ–¹å¼ 2: å‚³çµ±éƒ¨ç½² (å‘å¾Œå…¼å®¹)

ä½¿ç”¨åŸæœ‰çš„å•Ÿå‹•è…³æœ¬ã€‚

### å‰ç½®è¦æ±‚

1. **ComfyUI å·²å®‰è£ä¸¦å¯é‹è¡Œ**
   ```
   è·¯å¾‘: D:\02_software\ComfyUI_windows_portable\
   ç«¯å£: 8188
   ```

2. **Docker Desktop å·²å®‰è£ä¸¦é‹è¡Œ**
   ```
   ç‰ˆæœ¬: 20.10+
   æœå‹™: MySQL (3307), Redis (6379)
   ```

3. **Python ç’°å¢ƒ**
   ```
   ç‰ˆæœ¬: 3.11+
   è™›æ“¬ç’°å¢ƒ: venv/
   ```

4. **(å¯é¸) Ngrok å·²å®‰è£**
   ```
   è·¯å¾‘: D:\02_software\Ngrok\ngrok-v3-stable-windows-amd64\ngrok.exe
   ç”¨é€”: å…¬ç¶²å­˜å–
   ```

### å‚³çµ±ä¸€éµå•Ÿå‹•

```powershell
# 1. å•Ÿå‹• ComfyUI (åœ¨ç¨ç«‹çµ‚ç«¯)
D:\02_software\ComfyUI_windows_portable\run_nvidia_gpu.bat

# 2. å•Ÿå‹•æ‰€æœ‰å¾Œç«¯æœå‹™ (Docker + Backend + Worker)
cd scripts
start_all_with_docker.bat

# 3. (å¯é¸) å•Ÿå‹• Ngrok å…¬ç¶²å­˜å–
start_ngrok.bat

# 4. è¨ªå•æ‡‰ç”¨
# æœ¬åœ°: http://localhost:5000/
# å…¬ç¶²: https://[your-id].ngrok-free.app/
```

### é©—è­‰ç³»çµ±ç‹€æ…‹

```powershell
# çµ±ä¸€æ¶æ§‹ - æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker-compose -f docker-compose.unified.yml ps

# å‚³çµ±æ–¹å¼ - å¿«é€Ÿé©—è­‰æ‰€æœ‰æœå‹™
cd scripts
verify.bat

# æ‰‹å‹•æª¢æŸ¥å„æœå‹™
netstat -ano | findstr "5000 6379 3307 8188"

# æ¸¬è©¦ API å¥åº·æª¢æŸ¥
curl http://localhost:5000/api/health
```

---

## ğŸ“ æ–‡ä»¶çµæ§‹

```
ComfyUISum/
â”œâ”€â”€ shared/                     # å…±ç”¨æ¨¡çµ„ (æ ¸å¿ƒ - 2026-01-21 ç¢ºèª)
â”‚   â”œâ”€â”€ __init__.py            # æ¨¡çµ„å°å‡º (18 å€‹é…ç½®é …)
â”‚   â”œâ”€â”€ utils.py               # load_env(), get_project_root(), setup_logger(), JobLogAdapter
â”‚   â”œâ”€â”€ config_base.py         # å…±ç”¨é…ç½® (Redis, DB, Storage, ComfyUI)
â”‚   â””â”€â”€ database.py            # Database é¡ + ORM æ¨¡å‹ (User, Job) - 558 è¡Œ
â”‚
â”œâ”€â”€ backend/                    # Flask å¾Œç«¯æœå‹™
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app.py             # ä¸»æ‡‰ç”¨ (1447 è¡Œ, API + éœæ…‹æœå‹™ + æœƒå“¡ç³»çµ±)
â”‚   â”‚   â””â”€â”€ config.py          # é…ç½®ç®¡ç† (ç¹¼æ‰¿ shared.config_base)
â”‚   â”œâ”€â”€ Readme/                # æ–‡æª”ç›®éŒ„
â”‚   â”‚   â”œâ”€â”€ README.md          # Backend ä½¿ç”¨æŒ‡å—
â”‚   â”‚   â””â”€â”€ API_TESTING.md     # API æ¸¬è©¦é›†åˆ
â”‚   â””â”€â”€ Dockerfile             # Backend å®¹å™¨å®šç¾©
â”‚
â”œâ”€â”€ worker/                     # ä»»å‹™è™•ç†å™¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.py            # Worker ä¸»é‚è¼¯ (743 è¡Œ)
â”‚   â”‚   â”œâ”€â”€ json_parser.py     # Workflow è§£æ (631 è¡Œ)
â”‚   â”‚   â”œâ”€â”€ comfy_client.py    # ComfyUI å®¢æˆ¶ç«¯ (525 è¡Œ)
â”‚   â”‚   â”œâ”€â”€ check_comfy_connection.py  # é€£ç·šæª¢æŸ¥å·¥å…·
â”‚   â”‚   â””â”€â”€ config.py          # é…ç½®ç®¡ç† (ç¹¼æ‰¿ shared.config_base)
â”‚   â””â”€â”€ Dockerfile             # Worker å®¹å™¨å®šç¾©
â”‚
â”œâ”€â”€ frontend/                   # Web å‰ç«¯
â”‚   â”œâ”€â”€ index.html             # ä¸»é é¢ (SPA + æœƒå“¡ç‹€æ…‹åˆ‡æ›) - 157KB
â”‚   â”œâ”€â”€ login.html             # ç™»å…¥/è¨»å†Šé é¢ (æœƒå“¡ç³»çµ±) - 18KB
â”‚   â”œâ”€â”€ profile.html           # æœƒå“¡ä¸­å¿ƒ - 28KB
â”‚   â”œâ”€â”€ dashboard.html         # å„€è¡¨æ¿ - 158KB
â”‚   â”œâ”€â”€ motion-workspace.js    # Video Studio é‚è¼¯ - 29KB
â”‚   â”œâ”€â”€ style.css              # æ“´å±•æ¨£å¼
â”‚   â””â”€â”€ config.js              # API é…ç½® (è‡ªå‹•ç”Ÿæˆ)
â”‚
â”œâ”€â”€ ComfyUIworkflow/           # Workflow æ¨¡æ¿
â”‚   â”œâ”€â”€ config.json            # Workflow é…ç½®æ˜ å°„ (å« image_map)
â”‚   â”œâ”€â”€ T2V.json, FLF.json     # Video Studio å·¥ä½œæµ
â”‚   â”œâ”€â”€ Veo3_VideoConnection.json  # é•·ç‰‡ç”Ÿæˆ
â”‚   â”œâ”€â”€ text_to_image_*.json   # æ–‡å­—è½‰åœ–åƒ
â”‚   â”œâ”€â”€ face_swap_*.json       # äººè‡‰æ›¿æ›
â”‚   â”œâ”€â”€ multi_image_blend_*.json  # åœ–ç‰‡æ··åˆ
â”‚   â”œâ”€â”€ single_image_edit_*.json  # å–®åœ–ç·¨è¼¯
â”‚   â””â”€â”€ sketch_to_image_*.json    # è‰åœ–è½‰åœ–åƒ
â”‚
â”œâ”€â”€ docs/                       # æ–‡æª”ç›®éŒ„ (6 å€‹æª”æ¡ˆ)
â”‚   â”œâ”€â”€ UpdateList.md          # è©³ç´°æ›´æ–°æ—¥èªŒ (2500+ è¡Œ)
â”‚   â”œâ”€â”€ HYBRID_DEPLOYMENT_STRATEGY.md  # æ··åˆéƒ¨ç½²ç­–ç•¥æŒ‡å—
â”‚   â”œâ”€â”€ Phase8C_Monitoring_Guide.md    # ç›£æ§æŒ‡å—
â”‚   â”œâ”€â”€ Phase9_Completion_Report.md    # Phase 9 å®Œæˆå ±å‘Š
â”‚   â”œâ”€â”€ PersonalGallery_Debug_Guide.md # Gallery é™¤éŒ¯æŒ‡å—
â”‚   â””â”€â”€ Veo3_LongVideo_Guide.md        # Veo3 é•·ç‰‡æŒ‡å—
â”‚
â”œâ”€â”€ storage/                    # æ•¸æ“šå­˜å„²
â”‚   â”œâ”€â”€ inputs/                # ä¸Šå‚³åœ–ç‰‡æš«å­˜
â”‚   â”œâ”€â”€ outputs/               # ç”Ÿæˆçµæœ
â”‚   â””â”€â”€ models/                # AI æ¨¡å‹æ–‡ä»¶
â”‚
â”œâ”€â”€ logs/                       # æ—¥èªŒæ–‡ä»¶
â”‚   â”œâ”€â”€ backend.log            # Backend æ—¥èªŒ (5MB Ã— 3)
â”‚   â”œâ”€â”€ worker.log             # Worker æ—¥èªŒ (5MB Ã— 3)
â”‚   â””â”€â”€ *.json.log             # JSON æ ¼å¼æ—¥èªŒ (åˆå¤œè¼ªæ›)
â”‚
â”œâ”€â”€ scripts/                    # å•Ÿå‹•è…³æœ¬ç›®éŒ„ (9 å€‹æª”æ¡ˆ)
â”‚   â”œâ”€â”€ start_unified_windows.bat   # Windows çµ±ä¸€å•Ÿå‹• (æ¨è–¦) â­
â”‚   â”œâ”€â”€ start_unified_linux.sh      # Linux çµ±ä¸€å•Ÿå‹• (æ¨è–¦) â­
â”‚   â”œâ”€â”€ start_ngrok.bat             # Ngrok å•Ÿå‹•è…³æœ¬
â”‚   â”œâ”€â”€ update_ngrok_config.ps1     # Ngrok é…ç½®æ›´æ–°
â”‚   â”œâ”€â”€ monitor_status.bat          # ç‹€æ…‹ç›£æ§
â”‚   â”œâ”€â”€ run_stack_test.bat          # æ•´åˆæ¸¬è©¦
â”‚   â””â”€â”€ *.bat/*.py                  # å…¶ä»–è¼”åŠ©è…³æœ¬
â”‚
â”œâ”€â”€ mysql_data/                 # MySQL æ•¸æ“šå·
â”œâ”€â”€ redis_data/                 # Redis æ•¸æ“šå·
â”‚
â”œâ”€â”€ .env                        # ç’°å¢ƒè®Šæ•¸é…ç½® (ä½¿ç”¨ä¸­)
â”œâ”€â”€ .env.unified.example        # ç’°å¢ƒè®Šæ•¸æ¨¡æ¿ (æ¨è–¦) â­
â”œâ”€â”€ docker-compose.unified.yml  # çµ±ä¸€ Docker é…ç½® (æ¨è–¦) â­
â”œâ”€â”€ docker-compose.yml          # ç”Ÿç”¢ç’°å¢ƒ Docker é…ç½® (å‚³çµ±)
â”œâ”€â”€ docker-compose.dev.yml      # é–‹ç™¼ç’°å¢ƒ Docker é…ç½® (å‚³çµ±)
â”œâ”€â”€ requirements.txt            # Python ä¾è³´
â””â”€â”€ README.md                   # æœ¬æ–‡ä»¶ (1260+ è¡Œ)
```

---

## ğŸ”Œ API ç«¯é»

### å¥åº·æª¢æŸ¥
```http
GET /api/health
```
**éŸ¿æ‡‰**:
```json
{
  "status": "ok",
  "redis": "healthy",
  "mysql": "healthy",
  "timestamp": "2026-01-05T10:30:00"
}
```

### ä¸Šå‚³éŸ³è¨Š (Phase 7 æ–°å¢) ğŸ†•
```http
POST /api/upload
Content-Type: multipart/form-data

file: (éŸ³è¨Šæª”æ¡ˆï¼Œæ”¯æ´ .wav å’Œ .mp3)
```

**éŸ¿æ‡‰**:
```json
{
  "filename": "audio_550e8400-e29b.wav",
  "original_name": "my_voice.wav"
}
```

### æäº¤ä»»å‹™
```http
POST /api/generate
Content-Type: application/json

{
  "workflow": "text_to_image",
  "prompt": "A beautiful sunset over mountains",
  "negative_prompt": "blurry, low quality",
  "model": "sd_xl_turbo_1.0_fp16.safetensors",
  "aspect_ratio": "16:9",
  "batch_size": 1,
  "seed": -1,
  "images": [],
  "audio": ""
}
```

**Virtual Human å·¥ä½œæµç¯„ä¾‹**:
```json
{
  "workflow": "virtual_human",
  "prompt": "é€™æ˜¯ä¸€å€‹æ¸¬è©¦èªéŸ³ç”Ÿæˆ",
  "audio": "audio_550e8400-e29b.wav"
}
```

**éŸ¿æ‡‰**:
```json
{
  "job_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "pending"
}
```

### æŸ¥è©¢ç‹€æ…‹
```http
GET /api/status/{job_id}
```

**éŸ¿æ‡‰**:
```json
{
  "job_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "completed",
  "progress": 100,
  "image_url": "/outputs/20260105_103045_abc123.png",
  "created_at": "2026-01-05T10:30:00"
}
```

### æŸ¥è©¢æ­·å²
```http
GET /api/history?page=1&limit=20
```

**éŸ¿æ‡‰**:
```json
{
  "jobs": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "prompt": "A beautiful sunset...",
      "workflow": "text_to_image",
      "status": "completed",
      "output_path": "/outputs/20260105_103045_abc123.png",
      "created_at": "2026-01-05T10:30:00"
    }
  ],
  "total": 150,
  "page": 1,
  "total_pages": 8
}
```

---

## âš™ï¸ é…ç½®èªªæ˜

### ç’°å¢ƒè®Šæ•¸ (.env)

```ini
# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=mysecret

# MySQL é…ç½®
DB_HOST=localhost
DB_PORT=3307
DB_USER=studio_user
DB_PASSWORD=studio_password
DB_NAME=studio_db

# ComfyUI é…ç½®
COMFY_HOST=127.0.0.1
COMFY_PORT=8188
COMFYUI_ROOT=D:/02_software/ComfyUI_windows_portable/ComfyUI
COMFYUI_INPUT_DIR=D:/02_software/ComfyUI_windows_portable/ComfyUI/input
COMFYUI_OUTPUT_DIR=D:/02_software/ComfyUI_windows_portable/ComfyUI/output

# Ngrok å…¬ç¶²å­˜å– (è‡ªå‹•æ›´æ–°)
NGROK_URL=
BACKEND_URL=
```

### Docker é…ç½®

#### ç”Ÿç”¢ç’°å¢ƒ (docker-compose.yml)
- Backend API (å®¹å™¨åŒ–)
- Worker (å®¹å™¨åŒ–)
- MySQL + Redis (å®¹å™¨åŒ–)

#### é–‹ç™¼ç’°å¢ƒ (docker-compose.dev.yml) â­ æ¨è–¦
- MySQL + Redis (å®¹å™¨åŒ–)
- Backend + Worker (æœ¬åœ° Python)
- å„ªé»: å³æ™‚ä»£ç¢¼é‡è¼‰ã€æ˜“æ–¼é™¤éŒ¯

---

## ğŸŒ Ngrok å…¬ç¶²å­˜å–

### ç‚ºä»€éº¼ä½¿ç”¨ Ngrokï¼Ÿ

1. **ç§»å‹•ç«¯æ¸¬è©¦** - åœ¨æ‰‹æ©Ÿ/å¹³æ¿ä¸Šæ¸¬è©¦æ‡‰ç”¨
2. **é ç¨‹å”ä½œ** - åˆ†äº«çµ¦åœ˜éšŠæˆå“¡æˆ–å®¢æˆ¶
3. **å¤–ç¶²æ¼”ç¤º** - ç„¡éœ€å…¬ç¶² IP æˆ–ç«¯å£è½‰ç™¼
4. **HTTPS æ”¯æŒ** - è‡ªå‹•æä¾› SSL è­‰æ›¸

### å¿«é€Ÿå•Ÿå‹•

```powershell
# 1. ç¢ºä¿ Backend é‹è¡Œ
.\start_all_with_docker.bat

# 2. å•Ÿå‹• Ngrok
.\start_ngrok.bat
# è‡ªå‹•ç²å– URL ä¸¦æ›´æ–°é…ç½®

# 3. è¨ªå•å…¬ç¶² URL
# é¡¯ç¤ºåœ¨çµ‚ç«¯æˆ–æŸ¥çœ‹ .env æ–‡ä»¶ä¸­çš„ NGROK_URL
```

### å·¥ä½œåŸç†

```
æœ¬åœ° Backend (Port 5000)
    â†“
Ngrok å®¢æˆ¶ç«¯ (æœ¬åœ°)
    â†“
Ngrok æœå‹™å™¨ (é›²ç«¯)
    â†“
å…¬ç¶² HTTPS URL
    â†“
ä»»ä½•è¨­å‚™éƒ½å¯è¨ªå•
```

### é…ç½®è‡ªå‹•åŒ–

1. **start_ngrok.bat** å•Ÿå‹• Ngrok
2. **update_ngrok_config.ps1** ç²å– URL
3. è‡ªå‹•æ›´æ–° `.env` å’Œ `frontend/config.js`
4. å‰ç«¯è‡ªå‹•é¸æ“‡æ­£ç¢ºçš„ API ç«¯é»

è©³ç´°èªªæ˜è«‹åƒé–± [NGROK_SETUP.md](NGROK_SETUP.md)

---

## ğŸ‘¨â€ğŸ’» é–‹ç™¼æŒ‡å—

### æœ¬åœ°é–‹ç™¼æ¨¡å¼

```powershell
# 1. å•Ÿå‹•åŸºç¤æœå‹™
docker-compose -f docker-compose.dev.yml up -d

# 2. å•Ÿå‹• Backend (é–‹ç™¼æ¨¡å¼)
cd backend
python src/app.py
# Debug mode enabled, auto-reload on code changes

# 3. å•Ÿå‹• Worker (é–‹ç™¼æ¨¡å¼)
cd worker
python src/main.py
# Detailed logging for debugging

# 4. è¨ªå•æ‡‰ç”¨
start http://localhost:5000/
```

### æ—¥èªŒæŸ¥çœ‹

```powershell
# Backend æ—¥èªŒ
Get-Content logs\backend.log -Tail 50 -Wait

# Worker æ—¥èªŒ
Get-Content logs\worker.log -Tail 50 -Wait

# æ—¥èªŒç‰¹é»
- è‡ªå‹•è¼ªè½‰ (5MB å–®æ–‡ä»¶)
- ä¿ç•™ 3 ä»½å‚™ä»½
- æ™‚é–“æˆ³ + ç´šåˆ¥ + è¨Šæ¯
```

### æ·»åŠ æ–° Workflow

1. **æº–å‚™ Workflow JSON**
   ```
   ComfyUIworkflow/my_new_workflow.json
   ```

2. **æ›´æ–°é…ç½®æ˜ å°„**
   ```json
   // ComfyUIworkflow/config.json
   {
     "my_workflow": {
       "file": "my_new_workflow.json",
       "description": "My Custom Workflow"
     }
   }
   ```

3. **å¯¦ç¾åƒæ•¸æ³¨å…¥é‚è¼¯**
   ```python
   # worker/src/main.py
   def inject_parameters(workflow, params):
       # æ ¹æ“š workflow type æ³¨å…¥åƒæ•¸
       pass
   ```

4. **å‰ç«¯æ·»åŠ  UI**
   ```html
   <!-- frontend/index.html -->
   <button onclick="submitJob('my_workflow', params)">
       My Workflow
   </button>
   ```

### æ•¸æ“šåº«ç®¡ç†

```powershell
# é€£æ¥ MySQL
mysql -h 127.0.0.1 -P 3307 -u studio_user -p

# æŸ¥çœ‹ä»»å‹™è¨˜éŒ„
USE studio_db;
SELECT * FROM jobs ORDER BY created_at DESC LIMIT 10;

# æ¸…ç†èˆŠè¨˜éŒ„
UPDATE jobs SET is_deleted = 1 WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);
```

---

## ğŸ§ª æ¸¬è©¦

### æ•´åˆæ¸¬è©¦è…³æœ¬

å°ˆæ¡ˆåŒ…å«è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬ï¼Œç”¨æ–¼é©—è­‰å®Œæ•´çš„ API æµç¨‹ï¼š

```bash
# é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd D:\01_Project\2512_ComfyUISum

# å®Œæ•´æ¸¬è©¦ (éœ€è¦ Backend + Worker + ComfyUI)
python tests/test_virtual_human_flow.py

# åƒ…æ¸¬è©¦ä¸Šå‚³åŠŸèƒ½ (å¿«é€Ÿé©—è­‰)
python tests/test_virtual_human_flow.py --upload-only

# è·³éç”Ÿæˆæ­¥é©Ÿ (æ¸¬è©¦ API ä½†ä¸ç­‰å¾…çµæœ)
python tests/test_virtual_human_flow.py --skip-generation

# ä½¿ç”¨è‡ªè¨‚ Backend URL
python tests/test_virtual_human_flow.py --url http://192.168.1.100:5000
```

### æ¸¬è©¦è¦†è“‹ç¯„åœ

| æ¸¬è©¦é …ç›® | èªªæ˜ |
|---------|-----|
| å¥åº·æª¢æŸ¥ | é©—è­‰ Backendã€Redisã€MySQL é€£ç·š |
| éŸ³è¨Šä¸Šå‚³ | é©—è­‰ `/api/upload` æ”¯æ´ .wav/.mp3 |
| ä»»å‹™æäº¤ | é©—è­‰ `/api/generate` æ”¯æ´ audio åƒæ•¸ |
| ç‹€æ…‹è¼ªè©¢ | é©—è­‰ç‹€æ…‹å¾ queued â†’ processing â†’ finished |
| è¼¸å‡ºé©—è­‰ | é©—è­‰ç”Ÿæˆçš„æª”æ¡ˆå¯æ­£ç¢ºå­˜å– |

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 0. Backend å•Ÿå‹•å¾Œç«‹å³é€€å‡º (Windows é™å®š) âš ï¸ æ–°å¢

**ç—‡ç‹€**: 
```
 * Running on http://127.0.0.1:5000
Press CTRL+C to quit
(é€²ç¨‹ç«‹å³é€€å‡ºï¼Œè¿”å› PowerShell æç¤ºç¬¦)
```

**æ ¹æœ¬åŸå› **:
Flask çš„ `debug=True` æ¨¡å¼åœ¨ Windows PowerShell ä¸­èˆ‡ Werkzeug reloader æ©Ÿåˆ¶ä¸å…¼å®¹ã€‚ä¸»é€²ç¨‹å•Ÿå‹•å­é€²ç¨‹å¾Œç«‹å³é€€å‡ºã€‚

**è§£æ±ºæ–¹æ¡ˆ**:
```powershell
# æ–¹æ¡ˆ 1: ä½¿ç”¨å•Ÿå‹•è…³æœ¬ (æ¨è–¦)
cd scripts
.\start_unified_windows.bat
# é¸æ“‡ [3] Full stack with Local Backend + Worker

# æ–¹æ¡ˆ 2: ä½¿ç”¨ Start-Process
Start-Process -FilePath ".\venv\Scripts\python.exe" -ArgumentList "backend\src\app.py" -NoNewWindow

# æ–¹æ¡ˆ 3: ä½¿ç”¨ CMD è€Œé PowerShell
cmd /c "venv\Scripts\activate.bat && cd backend\src && python app.py"
```

**æŠ€è¡“èªªæ˜**:
- ä»£ç¢¼å·²æ›´æ–°: `use_reloader=False, threaded=True` (Windows è‡ªå‹•æ‡‰ç”¨)
- é€™ç¢ºä¿ Flask åœ¨å–®ä¸€é€²ç¨‹ä¸­é‹è¡Œï¼Œé¿å…ä¸»/å­é€²ç¨‹åˆ†é›¢å•é¡Œ
- ç¼ºé»: ä»£ç¢¼è®Šæ›´éœ€æ‰‹å‹•é‡å•Ÿæœå‹™

#### 1. Backend ç„¡æ³•é€£æ¥åˆ° Redis

**ç—‡ç‹€**: 
```
redis.exceptions.ConnectionError: Error connecting to Redis
```

**è§£æ±ºæ–¹æ¡ˆ**:
```powershell
# æª¢æŸ¥ Redis æ˜¯å¦é‹è¡Œ
docker ps | findstr redis

# é‡å•Ÿ Redis
docker-compose -f docker-compose.dev.yml restart redis

# æª¢æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr 6379
```

#### 2. Worker ç„¡æ³•é€£æ¥åˆ° ComfyUI

**ç—‡ç‹€**:
```
ConnectionRefusedError: [WinError 10061] ç„¡æ³•é€£ç·š
```

**è§£æ±ºæ–¹æ¡ˆ**:
```powershell
# ç¢ºèª ComfyUI é‹è¡Œ
netstat -ano | findstr 8188

# æ‰‹å‹•å•Ÿå‹• ComfyUI
D:\02_software\ComfyUI_windows_portable\run_nvidia_gpu.bat

# æª¢æŸ¥ .env é…ç½®
findstr "COMFY" .env
```

#### 3. Ngrok URL ç„¡æ³•è¨ªå•

**ç—‡ç‹€**:
```
404 Not Found æˆ– 502 Bad Gateway
```

**è§£æ±ºæ–¹æ¡ˆ**:
```powershell
# 1. ç¢ºèª Backend é‹è¡Œ
curl http://localhost:5000/api/health

# 2. æª¢æŸ¥ Ngrok ç‹€æ…‹
start http://localhost:4040

# 3. é‡æ–°å•Ÿå‹• Ngrok
.\start_ngrok.bat

# 4. é©—è­‰é…ç½®
Get-Content .env | Select-String "NGROK"
Get-Content frontend\config.js
```

#### 4. åœ–ç‰‡ç„¡æ³•é¡¯ç¤º

**ç—‡ç‹€**:
Gallery ä¸­åœ–ç‰‡é¡¯ç¤ºç‚ºæå£åœ–æ¨™

**è§£æ±ºæ–¹æ¡ˆ**:
```powershell
# 1. æª¢æŸ¥è¼¸å‡ºç›®éŒ„
dir storage\outputs

# 2. ç¢ºèªæ–‡ä»¶æ¬Šé™
icacls storage\outputs

# 3. æª¢æŸ¥ Backend æ—¥èªŒ
Get-Content logs\backend.log | Select-String "outputs"

# 4. æ¸¬è©¦ç›´æ¥è¨ªå•
curl http://localhost:5000/outputs/test.png
```

#### 5. ä»»å‹™å¡åœ¨ pending ç‹€æ…‹

**ç—‡ç‹€**:
ä»»å‹™æäº¤å¾Œé•·æ™‚é–“ç„¡é€²åº¦æ›´æ–°

**è§£æ±ºæ–¹æ¡ˆ**:
```powershell
# 1. æª¢æŸ¥ Worker æ—¥èªŒ
Get-Content logs\worker.log -Tail 50

# 2. æª¢æŸ¥ Redis éšŠåˆ—
docker exec -it redis redis-cli
LLEN studio_jobs
LRANGE studio_jobs 0 -1

# 3. æ¸…ç†éšŠåˆ—ï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰
DEL studio_jobs

# 4. é‡å•Ÿ Worker
# é—œé–‰ Worker çµ‚ç«¯çª—å£ï¼Œé‡æ–°åŸ·è¡Œ
python worker/src/main.py
```

### è¨ºæ–·å‘½ä»¤

```powershell
# å¿«é€Ÿè¨ºæ–·æ‰€æœ‰æœå‹™
.\verify.bat

# è©³ç´°ç«¯å£æª¢æŸ¥
netstat -ano | findstr "5000 6379 3307 8188 4040"

# Docker æœå‹™ç‹€æ…‹
docker ps -a
docker-compose logs --tail=50

# ç£ç›¤ç©ºé–“æª¢æŸ¥
Get-PSDrive C
dir storage\outputs | Measure-Object -Property Length -Sum

# æ—¥èªŒåˆ†æ
Select-String -Path logs\*.log -Pattern "ERROR" | Select-Object -Last 20
```

---
## ğŸ“Š ç³»çµ±ç›£æ§

### Phase 6 æ–°å¢åŠŸèƒ½

ComfyUI Studio åœ¨ Phase 6 å¼•å…¥äº†å®Œæ•´çš„ç›£æ§èˆ‡å®‰å…¨æ©Ÿåˆ¶ã€‚

#### 1. å‰ç«¯å³æ™‚ç›£æ§ HUD

è¨ªå• `http://localhost:5000/` å³å¯çœ‹åˆ°å³ä¸Šè§’çš„ç³»çµ±ç›£æ§é¢æ¿ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System Monitor          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ Server: Online       â”‚
â”‚ ğŸŸ¢ Worker: Online       â”‚
â”‚ Queue: 3 pending        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹æ€§**:
- æ¯ 5 ç§’è‡ªå‹•æ›´æ–°
- Server/Worker ç‹€æ…‹å³æ™‚é¡¯ç¤º
- éšŠåˆ—é•·åº¦æ•¸å­—é¡¯ç¤º
- Cyberpunk éœ“è™¹é¢¨æ ¼è¨­è¨ˆ

#### 2. å¾Œç«¯ç›£æ§å„€è¡¨æ¿ (Phase 8c æ–°å¢)

å•Ÿå‹•å¾Œç«¯æ™‚æœƒè‡ªå‹•é¡¯ç¤ºç½®é ‚çš„ç›£æ§å„€è¡¨æ¿ï¼š

```bash
python backend/src/app.py
```

**çµ‚ç«¯è¼¸å‡º**:
```
ğŸ“Š Backend Status Dashboard
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metric                   | Value          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ Redis Queue Length    | 2              â”‚
â”‚ ğŸ’¾ Redis Memory Usage    | 42.50 MB       â”‚
â”‚ âš™ï¸ Worker Status          | ğŸŸ¢ Online      â”‚
â”‚ ğŸ“‹ Queued Tasks          | 3              â”‚
â”‚ â³ Processing Tasks       | 1              â”‚
â”‚ âœ“ Finished Tasks         | 125            â”‚
â”‚ âœ— Failed Tasks           | 2              â”‚
â”‚ ğŸ‘¥ Active Users (24h)    | 5              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[14:19:52] INFO     âœ“ è³‡æ–™åº«é€£æ¥æˆåŠŸ
[14:19:53] INFO     âœ“ Redis é€£æ¥æˆåŠŸ
[14:19:54] INFO     ğŸ“¤ æ”¶åˆ°ä»»å‹™è«‹æ±‚ [User#001]
[14:19:55] INFO     âœ“ ä»»å‹™å·²å…¥éšŠ [User#001]
...ï¼ˆæ—¥èªŒè‡ªå‹•å¾€ä¸Šæ»¾å‹•ï¼Œå„€è¡¨æ¿å§‹çµ‚ç½®é ‚ï¼‰...
```

**ç‰¹æ€§**:
- âœ¨ **ç½®é ‚é¡¯ç¤º**: å„€è¡¨æ¿å§‹çµ‚åœ¨é ‚éƒ¨ï¼ˆä½¿ç”¨ Rich Liveï¼‰
- ğŸ”„ **å¯¦æ™‚æ›´æ–°**: æ¯ 5 ç§’è‡ªå‹•æ›´æ–°ä¸€æ¬¡
- ğŸ“Š **å®Œæ•´æŒ‡æ¨™**:
  - Redis éšŠåˆ—é•·åº¦
  - Redis è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³
  - Worker åœ¨ç·š/é›¢ç·šç‹€æ…‹
  - ä»»å‹™çµ±è¨ˆï¼ˆå¾…è™•ç†/è™•ç†ä¸­/å·²å®Œæˆ/å¤±æ•—ï¼‰
  - æ´»èºç”¨æˆ¶æ•¸ï¼ˆéå» 24 å°æ™‚ï¼‰
- ğŸ¯ **éå…¨å±æ¨¡å¼**: æ—¥èªŒè‡ªç„¶æ»¾å‹•ï¼Œå„€è¡¨æ¿ä¸è¢«è¦†è“‹
- ğŸ·ï¸ **ç”¨æˆ¶è¿½è¹¤**: æ¯æ¢æ—¥èªŒè‡ªå‹•æ·»åŠ  `[User#XXX]` æ¨™ç±¤

**æŠ€è¡“å¯¦ç¾**:
- ä½¿ç”¨ `Rich.Live` å¯¦æ™‚æ›´æ–°ï¼ˆ`refresh_per_second=0.2`ï¼‰
- åƒæ•¸é…ç½®: `screen=False, transient=False` ä¿æŒå„€è¡¨æ¿ä½ç½®
- å¾Œå°ç·šç¨‹æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡ç‹€æ…‹
- èˆ‡æ—¥èªŒç³»çµ±é›†æˆï¼Œç„¡è¡çª

#### 3. Metrics API ç«¯é»

```bash
# ç²å–ç³»çµ±æŒ‡æ¨™
curl http://localhost:5000/api/metrics
```

**éŸ¿æ‡‰ç¯„ä¾‹**:
```json
{
  "queue_length": 3,
  "worker_status": "online",
  "active_jobs": 1
}
```

#### 4. Worker å¿ƒè·³æ©Ÿåˆ¶

- Worker æ¯ 10 ç§’å‘ Redis ç™¼é€å¿ƒè·³
- Backend æª¢æ¸¬ `worker:heartbeat` éµï¼ˆ30ç§’ TTLï¼‰
- è‡ªå‹•åˆ¤å®š Worker åœ¨ç·š/é›¢ç·šç‹€æ…‹

#### 5. ç›£æ§è…³æœ¬

```bash
# ä½¿ç”¨ BAT è…³æœ¬æŸ¥çœ‹ç³»çµ±ç‹€æ…‹
.\scripts\monitor_status.bat
```

**é¡¯ç¤ºå…§å®¹**:
- Backend å¥åº·æª¢æŸ¥
- ç³»çµ±æŒ‡æ¨™ï¼ˆéšŠåˆ—/Worker/æ´»å‹•ä»»å‹™ï¼‰
- Redis ç‹€æ…‹
- Docker å®¹å™¨ç‹€æ…‹
- ComfyUI é€£æ¥ç‹€æ…‹
- MySQL ä»»å‹™çµ±è¨ˆ

#### 6. å®‰å…¨åŠŸèƒ½ (Phase 6)

**Rate Limiting**:
- `/api/generate`: 10 æ¬¡/åˆ†é˜ï¼ˆé˜²æ­¢ç®—åŠ›æ¿«ç”¨ï¼‰
- `/api/status`: 2 æ¬¡/ç§’ = 120 æ¬¡/åˆ†é˜ï¼ˆè¼ªè©¢æŸ¥è©¢ï¼‰
- `/api/metrics`: 2 æ¬¡/ç§’ï¼ˆç›£æ§å„€è¡¨æ¿ï¼‰

**Input Validation**:
- Prompt é•·åº¦é™åˆ¶ï¼š1000 å­—ç¬¦
- æ‹’çµ•éé•·è«‹æ±‚ä¸¦å›å‚³æ˜ç¢ºéŒ¯èª¤

### è©³ç´°èªªæ˜æ–‡ä»¶

- ğŸ“„ [PHASE_8C_IMPROVEMENT.md](./PHASE_8C_IMPROVEMENT.md) - ç›£æ§å„€è¡¨æ¿ç½®é ‚æ”¹é€²è©³è§£
- ğŸ“„ [Update_MD/UpdateList.md](./Update_MD/UpdateList.md) - å®Œæ•´æ›´æ–°æ—¥èªŒ

**Path Traversal Protection**:
- æª”æ¡ˆè·¯å¾‘é©—è­‰ç¢ºä¿åœ¨ `storage/outputs/` å…§
- é˜²æ­¢æƒ¡æ„è·¯å¾‘å­˜å–

#### 6. æ—¥èªŒç³»çµ±

**Backend æ—¥èªŒ** (`logs/backend.log`):
```log
2026-01-06 16:35:07 - INFO - âœ… MySQL é€£æ¥æˆåŠŸ
2026-01-06 16:35:08 - INFO - æ”¶åˆ°ç”Ÿæˆè«‹æ±‚ (ä»»å‹™ ID: 79315428-...)
```

**Worker æ—¥èªŒ** (`logs/worker.log`):
```log
2026-01-06 16:35:08 - INFO - ğŸš€ é–‹å§‹è™•ç†ä»»å‹™
[ComfyClient] é€²åº¦: 50%
2026-01-06 16:35:11 - INFO - âœ… ä»»å‹™å®Œæˆ
```

**æ—¥èªŒé…ç½®**:
- RotatingFileHandler (5MB Ã— 3 å‚™ä»½)
- è‡ªå‹•è¼ªè½‰ï¼Œä¿ç•™æœ€è¿‘ 15MB æ—¥èªŒ

---
## ğŸ“ æ›´æ–°æ—¥èªŒ

### Architecture Review - 2026-01-21 â­ æœ€æ–°
- âœ… å…¨é¢æ¶æ§‹è¤‡å¯©èˆ‡ç¢ºèª
- âœ… ç¢ºèªç„¡é‡è¤‡ä»£ç¢¼ã€ç„¡é«’ code
- âœ… æ‰€æœ‰æ ¸å¿ƒå‡½å¼å”¯ä¸€å­˜åœ¨
- âœ… é…ç½®ç¹¼æ‰¿æ­£ç¢ºç„¡èª¤
- âœ… æ›´æ–° UpdateList.md èˆ‡ README.md

### Member System Beta - 2026-01-20
- âœ… æœƒå“¡èªè­‰ç³»çµ± (Flask-Login + Bcrypt)
- âœ… User ORM æ¨¡å‹ (SQLAlchemy)
- âœ… Auth API: register, login, logout, me
- âœ… Member API: profile, password, delete
- âœ… å‰ç«¯ç™»å…¥/è¨»å†Šé é¢ (`login.html`)
- âœ… æœƒå“¡ä¸­å¿ƒé é¢ (`profile.html`)
- âœ… ä¸»é å‹•æ…‹æœƒå“¡ç‹€æ…‹åˆ‡æ›

### Phase 9 - Reliability & User Experience (2026-01-12)
- âœ… Worker è¶…æ™‚å»¶é•· (1 å°æ™‚)
- âœ… 60 ç§’é€²åº¦æ—¥èªŒ
- âœ… å‰ç«¯ Image Composition å¤šå·¥å…·ç‹€æ…‹ç®¡ç†
- âœ… UI é–ƒçˆå•é¡Œä¿®å¾©

### Video Studio Integration (2026-01-15)
- âœ… ä¸‰ç¨®å½±ç‰‡å·¥ä½œæµæ•´åˆ
- âœ… Config-Driven Parser (image_map)
- âœ… Structured Logging ç³»çµ±

### Phase 6 - Security & Monitoring (2026-01-06)
- âœ… Rate Limiting
- âœ… Input Validation
- âœ… Metrics API
- âœ… Worker Heartbeat

### Phase 5 - Ngrok Integration & Architecture Optimization (2026-01-05)
- âœ… Backend éœæ…‹æ–‡ä»¶æœå‹™æ•´åˆ (Port 5000 çµ±ä¸€)
- âœ… Ngrok è‡ªå‹•é…ç½®ç³»çµ± (update_ngrok_config.ps1)
- âœ… æ–‡æª”æ•´åˆèˆ‡æ¸…ç† (4â†’1 æ–‡ä»¶)
- âœ… éŸ¿æ‡‰å¼è¨­è¨ˆæ”¹é€² (ç§»å‹•ç«¯æ”¯æŒ)
- âœ… PowerShell è…³æœ¬è‹±æ–‡åŒ– (é¿å…ç·¨ç¢¼å•é¡Œ)

### Phase 4 - Stability & Connectivity (2026-01-05)
- âœ… Gallery åœ–ç‰‡é¡¯ç¤ºä¿®å¾©
- âœ… å®Œæ•´æ—¥èªŒç³»çµ±å¯¦ä½œ
- âœ… RotatingFileHandler é…ç½®

### Phase 3 - Database & Storage (2025-12-XX)
- âœ… MySQL æŒä¹…åŒ–å­˜å„²
- âœ… æ­·å²è¨˜éŒ„æŸ¥è©¢
- âœ… è»Ÿåˆªé™¤æ©Ÿåˆ¶

### Phase 2 - Task Queue (2025-12-XX)
- âœ… Redis ä»»å‹™éšŠåˆ—
- âœ… Worker ç•°æ­¥è™•ç†
- âœ… é€²åº¦è¿½è¹¤ç³»çµ±

### Phase 1 - MVP (2025-12-XX)
- âœ… åŸºç¤ Frontend UI
- âœ… Flask Backend API
- âœ… ComfyUI æ•´åˆ

ğŸ“š **å®Œæ•´æ›´æ–°è¨˜éŒ„è«‹åƒé–±** [docs/UpdateList.md](docs/UpdateList.md)

---

## ğŸ“ æ”¯æŒèˆ‡è²¢ç»

### æ–‡æª”è³‡æº
- [README.md](README.md) - é …ç›®å®Œæ•´æ–‡æª”ï¼ˆæœ¬æ–‡ä»¶ï¼‰
- [NGROK_SETUP.md](NGROK_SETUP.md) - Ngrok è©³ç´°æŒ‡å—
- [UpdateList.md](UpdateList.md) - æ›´æ–°æ—¥èªŒ
- [API_TESTING.md](backend/Readme/API_TESTING.md) - API æ¸¬è©¦æŒ‡å—

### ç²å–å¹«åŠ©
1. æŸ¥çœ‹ [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤) ç« ç¯€
2. æª¢æŸ¥æ—¥èªŒæ–‡ä»¶ (`logs/backend.log`, `logs/worker.log`)
3. ä½¿ç”¨ `verify.bat` è¨ºæ–·æœå‹™ç‹€æ…‹

### è²¢ç»æŒ‡å—
1. Fork æœ¬é …ç›®
2. å‰µå»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. é–‹å•Ÿ Pull Request

---

## ğŸ“„ è¨±å¯è­‰

æœ¬é …ç›®æ¡ç”¨ MIT è¨±å¯è­‰ - è©³è¦‹ LICENSE æ–‡ä»¶

---

## ğŸ™ è‡´è¬

- [ComfyUI](https://github.com/comfyanonymous/ComfyUI) - å¼·å¤§çš„ AI åœ–åƒç”Ÿæˆå·¥å…·
- [Tailwind CSS](https://tailwindcss.com/) - å¯¦ç”¨å„ªå…ˆçš„ CSS æ¡†æ¶
- [Lucide Icons](https://lucide.dev/) - ç¾è§€çš„é–‹æºåœ–æ¨™åº«
- [Flask](https://flask.palletsprojects.com/) - è¼•é‡ç´š Web æ¡†æ¶

---

<div align="center">

**ğŸ¨ ComfyUI Studio - è®“ AI å‰µä½œæ›´ç°¡å–®**

Made with â¤ï¸ by ComfyUI Studio Team

[â¬† å›åˆ°é ‚éƒ¨](#-comfyui-studio---ai-creative-platform)

</div>
