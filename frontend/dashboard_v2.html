<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIGEN.IO - Creative Studio</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- API Configuration -->
    <script src="config.js"></script>
    <!-- Google Fonts - Orbitron (Tech/Futuristic Font) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <style>
        /* Hide Scrollbar */
        ::-webkit-scrollbar {
            display: none;
        }

        * {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animations */
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* Glass Effects */
        .glass-sidebar {
            background: rgba(5, 5, 8, 0.7);
            backdrop-filter: blur(32px);
            -webkit-backdrop-filter: blur(32px);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-card {
            background: rgba(10, 10, 15, 0.5);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .glass-card:hover {
            background: rgba(20, 20, 30, 0.6);
            border-color: rgba(168, 85, 247, 0.5);
            transform: translateY(-4px);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.8), 0 0 20px rgba(168, 85, 247, 0.2);
        }

        /* Tool Icon Styles */
        .tool-icon {
            transition: all 0.3s ease;
        }

        .tool-icon:hover {
            transform: scale(1.05);
        }

        /* Nav Item */
        .nav-item {
            transition: all 0.2s ease;
            position: relative;
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            right: 0;
            top: 20%;
            bottom: 20%;
            width: 3px;
            background: #a78bfa;
            border-radius: 4px 0 0 4px;
            box-shadow: 0 0 10px #a78bfa;
        }

        .nav-item.active {
            background: rgba(168, 85, 247, 0.15);
            color: #a78bfa;
        }

        /* Background Image */
        .bg-image {
            background-image: url('image/BG_v02.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Status Indicator */
        @keyframes pulse-dot {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .status-dot {
            animation: pulse-dot 2s infinite;
        }

        /* Neon Stroke Flow Animation */
        @keyframes neon-stroke-flow {
            0% {
                filter:
                    drop-shadow(0 0 5px #a855f7) drop-shadow(0 0 10px #a855f7) drop-shadow(0 0 15px #7c3aed);
                -webkit-text-stroke-color: #f3c8ff;
            }

            25% {
                filter:
                    drop-shadow(0 0 8px #c084fc) drop-shadow(0 0 15px #a855f7) drop-shadow(0 0 20px #7c3aed);
                -webkit-text-stroke-color: #e9d5ff;
            }

            50% {
                filter:
                    drop-shadow(0 0 10px #e9d5ff) drop-shadow(0 0 20px #c084fc) drop-shadow(0 0 25px #a855f7);
                -webkit-text-stroke-color: #fae8ff;
            }

            75% {
                filter:
                    drop-shadow(0 0 8px #c084fc) drop-shadow(0 0 15px #a855f7) drop-shadow(0 0 20px #7c3aed);
                -webkit-text-stroke-color: #e9d5ff;
            }

            100% {
                filter:
                    drop-shadow(0 0 5px #a855f7) drop-shadow(0 0 10px #a855f7) drop-shadow(0 0 15px #7c3aed);
                -webkit-text-stroke-color: #f3c8ff;
            }
        }

        .neon-title {
            animation: neon-stroke-flow 4s ease-in-out infinite;
        }
    </style>
</head>

<body class="h-screen w-full flex overflow-hidden bg-[#020205] text-white font-sans selection:bg-purple-500/30">

    <!-- Background Layer (pointer-events-none 確保不會阻擋點擊) -->
    <div class="fixed inset-0 z-0 pointer-events-none">
        <!-- Background Image -->
        <div class="absolute inset-0 bg-image"></div>
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-b from-[#020205]/0 via-[#020205]/90 to-[#020205]/100"></div>
        <!-- Noise Texture -->
        <div
            class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-40 mix-blend-overlay">
        </div>
    </div>

    <!-- Left Sidebar (Icon Only) -->
    <aside class="glass-sidebar w-20 flex-shrink-0 flex flex-col h-full z-30 relative">
        <!-- Logo -->
        <div class="h-20 flex items-center justify-center border-b border-white/5">
            <div
                class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-600 to-indigo-800 flex items-center justify-center shadow-lg border border-white/10 hover:border-purple-500/50 transition-colors cursor-pointer group">
                <i data-lucide="sparkles" class="text-white w-6 h-6 group-hover:scale-110 transition-transform"></i>
            </div>
        </div>

        <!-- Navigation Icons -->
        <nav class="flex-1 py-6 px-3 space-y-3">
            <button onclick="navigateTo('dashboard')"
                class="nav-item active w-full p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all"
                title="Dashboard">
                <i data-lucide="home" class="w-7 h-7 mx-auto"></i>
            </button>
            <button onclick="navigateTo('canvas')"
                class="nav-item w-full p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all"
                title="Image Studio">
                <i data-lucide="layers" class="w-7 h-7 mx-auto"></i>
            </button>
            <button onclick="navigateTo('motion')"
                class="nav-item w-full p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all"
                title="Video Studio">
                <i data-lucide="film" class="w-7 h-7 mx-auto"></i>
            </button>
            <button onclick="navigateTo('avatar')"
                class="nav-item w-full p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all"
                title="Avatar Studio">
                <i data-lucide="user-circle-2" class="w-7 h-7 mx-auto"></i>
            </button>
            <div class="h-[1px] bg-white/10 my-4"></div>
            <button onclick="navigateTo('gallery')"
                class="nav-item w-full p-4 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all"
                title="Gallery">
                <i data-lucide="image" class="w-7 h-7 mx-auto"></i>
            </button>
        </nav>

        <!-- Bottom: System Status -->
        <div class="p-4 border-t border-white/5">
            <div id="system-status"
                class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 cursor-pointer hover:bg-white/10 transition-colors"
                title="System Status">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500 status-dot"></div>
                </div>
                <i data-lucide="activity" class="w-5 h-5 text-gray-400"></i>
            </div>
        </div>

        <!-- User Profile (Bottom) -->
        <div class="p-4 border-t border-white/5">
            <!-- Guest State -->
            <a id="auth-guest" href="/login.html"
                class="hidden flex-col items-center gap-2 p-3 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-all"
                title="Login">
                <i data-lucide="log-in" class="w-6 h-6"></i>
            </a>

            <!-- User State -->
            <a id="auth-user" href="/profile.html"
                class="hidden flex-col items-center gap-2 p-3 rounded-xl hover:bg-white/5 transition-all group"
                title="Profile">
                <div
                    class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 border border-white/20 flex items-center justify-center group-hover:border-purple-500/50 transition-colors">
                    <i data-lucide="user" class="w-5 h-5"></i>
                </div>
            </a>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 h-full flex flex-col overflow-hidden relative z-10">

        <!-- Top Bar -->
        <header class="h-20 flex-shrink-0 flex items-center justify-end px-10 relative">

            <!-- Top Right: User Info -->
            <div id="top-right-auth">
                <!-- Guest -->
                <a id="topbar-guest" href="/login.html"
                    class="hidden items-center gap-2 px-5 py-2.5 rounded-xl bg-white/10 backdrop-blur-md border border-white/20 text-white text-sm font-medium hover:bg-white/20 hover:border-purple-500/50 transition-all">
                    <i data-lucide="log-in" class="w-4 h-4"></i>
                    <span>登入 / 註冊</span>
                </a>

                <!-- User -->
                <a id="topbar-user" href="/profile.html"
                    class="hidden items-center gap-3 px-4 py-2.5 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 hover:bg-white/10 hover:border-purple-500/30 transition-all group">
                    <div
                        class="w-8 h-8 rounded-full bg-gradient-to-b from-purple-500 to-purple-800 border border-white/20 flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4 text-white"></i>
                    </div>
                    <span id="topbar-user-name"
                        class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">會員中心</span>
                    <i data-lucide="chevron-right"
                        class="w-4 h-4 text-gray-500 group-hover:text-purple-400 transition-colors"></i>
                </a>
            </div>
        </header>

        <!-- Main Content: Tool Grid -->
        <div class="flex-1 overflow-y-auto px-10 pb-10 flex flex-col items-center justify-center pt-80">
            <div class="max-w-7xl mx-auto w-full text-center">

                <!-- Neon Title - Centered (Outline Style) -->
                <h1 class="text-7xl md:text-9xl lg:text-9xl font-bold mb-20 animate-fade-in neon-title"
                    style="font-family: 'Orbitron', sans-serif; -webkit-text-stroke: 2px #f3c8ff; color: transparent; transform: skewX(-10deg); letter-spacing: 0.05em;">
                    Let's Create
                </h1>

                <!-- Dashboard View -->
                <div id="view-dashboard" class="animate-fade-in">
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-10">

                        <!-- Text to Image -->
                        <button onclick="navigateTo('text_to_image')"
                            class="tool-icon glass-card rounded-2xl p-8 flex flex-col items-center justify-center gap-4 group">
                            <div
                                class="w-20 h-20 rounded-2xl bg-gradient-to-br from-purple-500/20 to-indigo-600/20 border border-purple-500/30 flex items-center justify-center group-hover:border-purple-500/60 transition-all">
                                <i data-lucide="image" class="w-10 h-10 text-purple-400"></i>
                            </div>
                            <div class="text-center">
                                <h3 class="text-2xl font-semibold text-white mb-1"
                                    style="font-family: 'Orbitron', sans-serif;">Text to Image</h3>
                                <p class="text-base text-gray-200">文字生成圖片</p>
                            </div>
                        </button>

                        <!-- Image Composition -->
                        <button onclick="navigateTo('canvas')"
                            class="tool-icon glass-card rounded-2xl p-8 flex flex-col items-center justify-center gap-4 group">
                            <div
                                class="w-20 h-20 rounded-2xl bg-gradient-to-br from-blue-500/20 to-cyan-600/20 border border-blue-500/30 flex items-center justify-center group-hover:border-blue-500/60 transition-all">
                                <i data-lucide="layers" class="w-10 h-10 text-blue-400"></i>
                            </div>
                            <div class="text-center">
                                <h3 class="text-2xl font-semibold text-white mb-1"
                                    style="font-family: 'Orbitron', sans-serif;">Image Studio</h3>
                                <p class="text-base text-gray-200">圖片合成工具</p>
                            </div>
                        </button>

                        <!-- Video Generation -->
                        <button onclick="navigateTo('motion')"
                            class="tool-icon glass-card rounded-2xl p-8 flex flex-col items-center justify-center gap-4 group">
                            <div
                                class="w-20 h-20 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-600/20 border border-amber-500/30 flex items-center justify-center group-hover:border-amber-500/60 transition-all">
                                <i data-lucide="film" class="w-10 h-10 text-amber-400"></i>
                            </div>
                            <div class="text-center">
                                <h3 class="text-2xl font-semibold text-white mb-1"
                                    style="font-family: 'Orbitron', sans-serif;">Video Studio</h3>
                                <p class="text-base text-gray-200">影片生成工具</p>
                            </div>
                        </button>

                        <!-- Avatar Studio -->
                        <button onclick="navigateTo('avatar')"
                            class="tool-icon glass-card rounded-2xl p-8 flex flex-col items-center justify-center gap-4 group">
                            <div
                                class="w-20 h-20 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-teal-600/20 border border-emerald-500/30 flex items-center justify-center group-hover:border-emerald-500/60 transition-all">
                                <i data-lucide="user-circle-2" class="w-10 h-10 text-emerald-400"></i>
                            </div>
                            <div class="text-center">
                                <h3 class="text-2xl font-semibold text-white mb-1"
                                    style="font-family: 'Orbitron', sans-serif;">Avatar Studio</h3>
                                <p class="text-base text-gray-200">虛擬人像生成</p>
                            </div>
                        </button>

                    </div>

                    <!-- To Be Continue Button -->
                    <div class="mt-10 w-full">
                        <button disabled
                            class="w-1/2 py-5 rounded-2xl bg-white/5 border border-dashed border-white/20 text-gray-500 text-lg font-medium cursor-not-allowed hover:border-purple-500/30 transition-all">
                            <span class="opacity-60" style="font-family: 'Orbitron', sans-serif;">To Be Continue
                                ...</span>
                        </button>
                    </div>
                </div>

                <!-- Other Views (Hidden by default) -->
                <div id="view-canvas" class="hidden">
                    <div class="glass-card rounded-2xl p-8 text-center">
                        <h2 class="text-2xl font-bold mb-4">Image Composition Studio</h2>
                        <p class="text-gray-400">圖片合成工具介面（保留原有功能）</p>
                    </div>
                </div>

                <div id="view-motion" class="hidden">
                    <div class="glass-card rounded-2xl p-8 text-center">
                        <h2 class="text-2xl font-bold mb-4">Video Generation Studio</h2>
                        <p class="text-gray-400">影片生成工具介面（保留原有功能）</p>
                    </div>
                </div>

                <div id="view-avatar" class="hidden">
                    <div class="glass-card rounded-2xl p-8 text-center">
                        <h2 class="text-2xl font-bold mb-4">Avatar Studio</h2>
                        <p class="text-gray-400">虛擬人像生成介面（保留原有功能）</p>
                    </div>
                </div>

                <div id="view-gallery" class="hidden">
                    <div class="glass-card rounded-2xl p-8 text-center">
                        <h2 class="text-2xl font-bold mb-4">Personal Gallery</h2>
                        <p class="text-gray-400">個人作品集介面（保留原有功能）</p>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // ==========================================
        // Enhanced Lucide Icons Initialization
        // ==========================================

        // Initialize immediately when script loads
        if (typeof lucide !== 'undefined') {
            console.log('[Lucide] Library loaded, initializing icons...');
            lucide.createIcons();
        }

        // Backup initialization on window load
        window.addEventListener('load', () => {
            console.log('[Lucide] Window loaded, re-initializing icons...');
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });

        // API Configuration
        const API_BASE = (typeof window.API_URL !== 'undefined') ? window.API_URL : '';
        console.log('[Dashboard] API_BASE:', API_BASE || '(relative path)');

        // Current View State
        let currentView = 'dashboard';

        /**
         * Navigation Function
         */
        function navigateTo(viewName) {
            console.log('[Nav] Navigating to:', viewName);

            // Hide all views
            const allViews = document.querySelectorAll('[id^="view-"]');
            allViews.forEach(view => view.classList.add('hidden'));

            // Show target view
            const targetView = document.getElementById(`view-${viewName}`);
            if (targetView) {
                targetView.classList.remove('hidden');
                targetView.classList.add('animate-fade-in');
            }

            // Update nav active state
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));

            const activeNav = document.querySelector(`[onclick="navigateTo('${viewName}')"]`);
            if (activeNav) {
                activeNav.classList.add('active');
            }

            currentView = viewName;
            localStorage.setItem('currentView', viewName);

            // Re-initialize icons after navigation
            setTimeout(() => {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }, 100);
        }

        /**
         * Check Login Status
         */
        async function checkLoginStatus() {
            console.log('[Auth] Checking login status...');

            const authGuest = document.getElementById('auth-guest');
            const authUser = document.getElementById('auth-user');
            const topbarGuest = document.getElementById('topbar-guest');
            const topbarUser = document.getElementById('topbar-user');

            try {
                const response = await fetch(`${API_BASE}/api/me`, {
                    credentials: 'include'
                });
                const data = await response.json();
                console.log('[Auth] Response:', data);

                if (data.logged_in && data.user) {
                    // Logged in
                    authGuest.classList.add('hidden');
                    authUser.classList.remove('hidden');
                    authUser.classList.add('flex');

                    topbarGuest.classList.add('hidden');
                    topbarUser.classList.remove('hidden');
                    topbarUser.classList.add('flex');

                    document.getElementById('topbar-user-name').textContent = data.user.name || '會員中心';
                    console.log('[Auth] Logged in as:', data.user.email);
                } else {
                    // Not logged in
                    authGuest.classList.remove('hidden');
                    authGuest.classList.add('flex');
                    authUser.classList.add('hidden');

                    topbarGuest.classList.remove('hidden');
                    topbarGuest.classList.add('flex');
                    topbarUser.classList.add('hidden');

                    console.log('[Auth] Not logged in');
                }

                lucide.createIcons();
            } catch (error) {
                console.error('[Auth] Check failed:', error);
                // Show guest state on error
                authGuest.classList.remove('hidden');
                authGuest.classList.add('flex');
                authUser.classList.add('hidden');
                topbarGuest.classList.remove('hidden');
                topbarGuest.classList.add('flex');
                topbarUser.classList.add('hidden');
            }
        }

        /**
         * Initialize on Page Load
         */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[Dashboard] Initializing...');

            // Restore last view
            const savedView = localStorage.getItem('currentView');
            if (savedView && savedView !== 'dashboard') {
                navigateTo(savedView);
            }

            // Check login status (comment out if you want to disable redirect)
            // checkLoginStatus();

            // For development: show guest state by default
            document.getElementById('auth-guest').classList.remove('hidden');
            document.getElementById('auth-guest').classList.add('flex');
            document.getElementById('topbar-guest').classList.remove('hidden');
            document.getElementById('topbar-guest').classList.add('flex');

            // Final icon initialization
            console.log('[Lucide] DOMContentLoaded - Final initialization');
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
                console.log('[Lucide] Icons created successfully');
            }
        });
    </script>

</body>

</html>