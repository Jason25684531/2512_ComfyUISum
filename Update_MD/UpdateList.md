# æ›´æ–°æ—¥èªŒ (Update List)

---

## ğŸ“… 2026-01-06 (æ™šé–“): Phase 6 å¾ŒçºŒ - æ¶æ§‹æ•´ç†èˆ‡æ–‡æª”å„ªåŒ–

### ğŸ¯ æœ¬æ¬¡å·¥ä½œæ¦‚è¦½

**æ ¸å¿ƒç›®æ¨™**: æ¸…ç†å†—é¤˜æ–‡ä»¶ã€çµ±ä¸€è…³æœ¬ç®¡ç†ã€æ•´åˆæ–‡æª”ã€ç¢ºèª Phase 6 å®Œæˆåº¦

**å·¥ä½œæ™‚é–“**: 2026-01-06 æ™šé–“
**å®Œæˆç‹€æ…‹**: âœ… 100% å®Œæˆ (8 å¤§é …ä»»å‹™)

---

### âœ… å®Œæˆé …ç›®æ¸…å–®

#### 1. æ¶æ§‹è§€å¯Ÿèˆ‡åˆ†æ ğŸ”

**ç¾æ³è¨ºæ–·**:
- âœ… æƒæé …ç›®çµæ§‹ï¼Œè­˜åˆ¥å†—é¤˜å’Œæ¸¬è©¦æ–‡ä»¶
- âœ… ç¢ºèªç¨‹å¼ç¢¼æ•´æ½”åº¦å’Œå¯ç¶­è­·æ€§
- âœ… æª¢æŸ¥æ–‡æª”å®Œæ•´æ€§å’Œä¸€è‡´æ€§

**ç™¼ç¾å•é¡Œ**:
- 7 å€‹ BAT è…³æœ¬æ•£è½åœ¨æ ¹ç›®éŒ„
- 3 å€‹ PowerShell è…³æœ¬ï¼ˆèˆ‡ BAT åŠŸèƒ½é‡è¤‡ï¼‰
- 3 å€‹ä¿®å¾©å ±å‘Šæ–‡æª”ï¼ˆè‡¨æ™‚æ–‡ä»¶ï¼‰
- ç›£æ§å’Œ Ngrok èªªæ˜åˆ†æ•£åœ¨å¤šå€‹ MD æ–‡ä»¶

#### 2. è…³æœ¬ç®¡ç†çµ±ä¸€åŒ– ğŸ“‚

**å‰µå»º scripts/ ç›®éŒ„**:
- âœ… å»ºç«‹ `scripts/` è³‡æ–™å¤¾ç”¨æ–¼çµ±ä¸€ç®¡ç†æ‰€æœ‰å•Ÿå‹•è…³æœ¬
- âœ… ç§»å‹• 6 å€‹ BAT æª”æ¡ˆåˆ° `scripts/`:
  - `start_all_with_docker.bat` - ä¸»å•Ÿå‹•è…³æœ¬
  - `start_ngrok.bat` - Ngrok å…¬ç¶²å­˜å–
  - `startweb.bat` - Web ä¼ºæœå™¨ï¼ˆå·²æ£„ç”¨ï¼‰
  - `run_stack_test.bat` - å †ç–Šæ¸¬è©¦
  - `monitor_status.bat` - ç³»çµ±ç›£æ§
  - `test_rate_limit.bat` - Rate Limiting æ¸¬è©¦

**è·¯å¾‘çµ±ä¸€**:
- âœ… æ‰€æœ‰è…³æœ¬ä¿æŒå¾æ ¹ç›®éŒ„åŸ·è¡Œï¼ˆ`cd /d "%~dp0"`ï¼‰
- âœ… ç›¸å°è·¯å¾‘æ­£ç¢ºæŒ‡å‘å°ˆæ¡ˆæª”æ¡ˆ

#### 3. PowerShell è…³æœ¬æ¸…ç† ğŸ—‘ï¸

**åˆªé™¤åŸå› **: BAT ç‰ˆæœ¬å·²å®Œå…¨è¦†è“‹åŠŸèƒ½ï¼Œä¸”ç„¡ PowerShell åŸ·è¡Œç­–ç•¥é™åˆ¶

**åˆªé™¤æ–‡ä»¶**:
- âœ… `monitor_status.ps1` - å·²æœ‰ BAT ç‰ˆæœ¬
- âœ… `update_ngrok_config.ps1` - æ•´åˆåˆ° `start_ngrok.bat`
- âœ… `validate_scripts.ps1` - è‡¨æ™‚é©—è­‰å·¥å…·

**å„ªå‹¢**:
- é›™æ“Šå³å¯åŸ·è¡Œï¼Œç„¡éœ€ç®¡ç†å“¡æ¬Šé™
- é¿å… PowerShell ç·¨ç¢¼å•é¡Œ
- å•Ÿå‹•æ›´å¿«é€Ÿç›´è§€

#### 4. å†—é¤˜æ–‡æª”æ¸…ç† ğŸ“„

**åˆªé™¤æ–‡ä»¶**:
- âœ… `SCRIPT_FIX_REPORT.md` - è‡¨æ™‚ä¿®å¾©è¨˜éŒ„
- âœ… `RATE_LIMIT_FIX.md` - å·²æ•´åˆåˆ° README
- âœ… `README.md.backup` - èˆŠç‰ˆå‚™ä»½

**ä¿ç•™æ–‡ä»¶**:
- âœ… `NGROK_SETUP.md` - è©³ç´° Ngrok æŒ‡å—ï¼ˆå¾…æ•´åˆï¼‰
- âœ… `MONITORING_GUIDE.md` - ç›£æ§å®Œæ•´æ–‡æª”ï¼ˆå¾…æ•´åˆï¼‰
- âœ… `STARTUP_TESTING_GUIDE.md` - å•Ÿå‹•æ¸¬è©¦æŒ‡å—

#### 5. æ–‡æª”æ•´åˆåˆ° README.md ğŸ“š

**æ–°å¢ç« ç¯€**:
- âœ… **[ç³»çµ±ç›£æ§](#-ç³»çµ±ç›£æ§)** - Phase 6 æ–°åŠŸèƒ½èªªæ˜
  - å‰ç«¯å³æ™‚ç›£æ§ HUD
  - Metrics API ç«¯é»
  - Worker å¿ƒè·³æ©Ÿåˆ¶
  - ç›£æ§è…³æœ¬ä½¿ç”¨
  - å®‰å…¨åŠŸèƒ½ï¼ˆRate Limiting, Input Validationï¼‰
  - æ—¥èªŒç³»çµ±èªªæ˜

**æ›´æ–°æ ¸å¿ƒåŠŸèƒ½åˆ—è¡¨**:
- âœ… æ–°å¢ "å®‰å…¨åŠ å›º" ç‰¹æ€§èªªæ˜
- âœ… æ–°å¢ "ç³»çµ±ç›£æ§" ç‰¹æ€§èªªæ˜
- âœ… æ›´æ–°ç›®éŒ„é€£çµ

#### 6. UpdateList.md æ›´æ–° ğŸ“

**æ–°å¢å…§å®¹**:
- âœ… 2026-01-06 æ™šé–“æ¶æ§‹æ•´ç†è¨˜éŒ„ï¼ˆæœ¬ç« ç¯€ï¼‰
- âœ… è©³ç´°çš„æª”æ¡ˆè®Šæ›´åˆ—è¡¨
- âœ… æœ€æ–°çš„é …ç›®çµæ§‹èªªæ˜
- âœ… Phase 6 å®Œæˆåº¦ç¢ºèª

#### 7. Phase 6 ä»»å‹™é©—è­‰ âœ…

**å°ç…§ Tasklist.md ç¢ºèª**:

| ä»»å‹™é¡åˆ¥ | å­ä»»å‹™ | ç‹€æ…‹ |
|---------|--------|------|
| 6.1 å®‰å…¨æ€§å¼·åŒ– | Rate Limiting | âœ… å®Œæˆ |
| | Input Validation | âœ… å®Œæˆ |
| | Path Traversal Protection | âœ… å®Œæˆ |
| 6.2 ç³»çµ±ç›£æ§ | Metrics ç«¯é» | âœ… å®Œæˆ |
| | Worker å¿ƒè·³ | âœ… å®Œæˆ |
| 6.3 ç›£æ§ Dashboard | System HUD çµ„ä»¶ | âœ… å®Œæˆ |
| | å¯¦æ™‚è¼ªè©¢ | âœ… å®Œæˆ |
| 6.4 Stack Testing | åŠŸèƒ½æ¸¬è©¦ (Playwright) | âœ… å®Œæˆ |
| | å£“åŠ›æ¸¬è©¦ (aiohttp) | âœ… å®Œæˆ |

**Phase 6 å®Œæˆåº¦**: âœ… **100%** (æ‰€æœ‰ä»»å‹™å·²å®Œæˆ)

#### 8. æœ€æ–°æ¶æ§‹ç¸½çµ ğŸ—ï¸

**å°ˆæ¡ˆçµæ§‹å„ªåŒ–**:
```
ComfyUISum/
â”œâ”€â”€ scripts/                    # ğŸ†• çµ±ä¸€è…³æœ¬ç®¡ç†
â”‚   â”œâ”€â”€ start_all_with_docker.bat
â”‚   â”œâ”€â”€ start_ngrok.bat
â”‚   â”œâ”€â”€ run_stack_test.bat
â”‚   â”œâ”€â”€ monitor_status.bat
â”‚   â””â”€â”€ test_rate_limit.bat
â”‚
â”œâ”€â”€ backend/                    # Flask API + Phase 6 å®‰å…¨å¼·åŒ–
â”‚   â””â”€â”€ src/app.py             # Rate Limiting, Metrics API
â”‚
â”œâ”€â”€ worker/                     # ä»»å‹™è™•ç† + å¿ƒè·³æ©Ÿåˆ¶
â”‚   â””â”€â”€ src/main.py            # Worker Heartbeat
â”‚
â”œâ”€â”€ frontend/                   # éŸ¿æ‡‰å¼ Web UI
â”‚   â””â”€â”€ index.html             # System HUD ç›£æ§çµ„ä»¶
â”‚
â”œâ”€â”€ tests/                      # è‡ªå‹•åŒ–æ¸¬è©¦å¥—ä»¶
â”‚   â”œâ”€â”€ stack_test.py          # Playwright E2E + å£“åŠ›æ¸¬è©¦
â”‚   â””â”€â”€ requirements.txt       # æ¸¬è©¦ä¾è³´
â”‚
â”œâ”€â”€ logs/                       # æ—¥èªŒæ–‡ä»¶
â”‚   â”œâ”€â”€ backend.log            # Backend æ—¥èªŒ (5MB Ã— 3)
â”‚   â””â”€â”€ worker.log             # Worker æ—¥èªŒ (5MB Ã— 3)
â”‚
â”œâ”€â”€ README.md                   # ğŸ”„ å·²æ›´æ–°ï¼šæ–°å¢ç›£æ§ç« ç¯€
â”œâ”€â”€ UpdateList.md               # ğŸ”„ å·²æ›´æ–°ï¼šä»Šæ—¥ç¸½çµ
â”œâ”€â”€ NGROK_SETUP.md             # Ngrok è©³ç´°æŒ‡å—
â”œâ”€â”€ MONITORING_GUIDE.md        # ç›£æ§å®Œæ•´æ–‡æª”
â””â”€â”€ STARTUP_TESTING_GUIDE.md   # å•Ÿå‹•æ¸¬è©¦æŒ‡å—
```

---

### ğŸ“Š æª”æ¡ˆè®Šæ›´çµ±è¨ˆ

#### ç›®éŒ„è®Šæ›´
- âœ… æ–°å¢ï¼š`scripts/` (çµ±ä¸€è…³æœ¬ç®¡ç†)

#### æª”æ¡ˆç§»å‹• (6 å€‹)
- âœ… `start_all_with_docker.bat` â†’ `scripts/`
- âœ… `start_ngrok.bat` â†’ `scripts/`
- âœ… `startweb.bat` â†’ `scripts/`
- âœ… `run_stack_test.bat` â†’ `scripts/`
- âœ… `monitor_status.bat` â†’ `scripts/`
- âœ… `test_rate_limit.bat` â†’ `scripts/`

#### æª”æ¡ˆåˆªé™¤ (6 å€‹)
- âœ… `monitor_status.ps1` (PowerShell)
- âœ… `update_ngrok_config.ps1` (PowerShell)
- âœ… `validate_scripts.ps1` (PowerShell)
- âœ… `SCRIPT_FIX_REPORT.md` (è‡¨æ™‚å ±å‘Š)
- âœ… `RATE_LIMIT_FIX.md` (è‡¨æ™‚å ±å‘Š)
- âœ… `README.md.backup` (èˆŠç‰ˆå‚™ä»½)

#### æª”æ¡ˆæ›´æ–° (2 å€‹)
- âœ… `README.md` - æ–°å¢ç³»çµ±ç›£æ§ç« ç¯€
- âœ… `UpdateList.md` - æ–°å¢ä»Šæ—¥ç¸½çµï¼ˆæœ¬æ–‡ä»¶ï¼‰

**æª”æ¡ˆè®Šæ›´ç¸½è¨ˆ**: æ–°å¢ 1 ç›®éŒ„ + ç§»å‹• 6 æª”æ¡ˆ + åˆªé™¤ 6 æª”æ¡ˆ + æ›´æ–° 2 æª”æ¡ˆ = **15 é …è®Šæ›´**

---

### ğŸ”§ æŠ€è¡“æ”¹é€²äº®é»

#### 1. è…³æœ¬ç®¡ç†è¦ç¯„åŒ–
- âœ… çµ±ä¸€æ”¾ç½®åœ¨ `scripts/` ç›®éŒ„
- âœ… å‘½åæ¸…æ™°åæ˜ åŠŸèƒ½ï¼ˆå•Ÿå‹•ã€ç›£æ§ã€æ¸¬è©¦ï¼‰
- âœ… é¿å…æ ¹ç›®éŒ„é›œäº‚

#### 2. æ–‡æª”é›†ä¸­åŒ–
- âœ… README.md ä½œç‚ºä¸»è¦å…¥å£æ–‡æª”
- âœ… ç›£æ§åŠŸèƒ½èªªæ˜æ•´åˆå®Œç•¢
- âœ… æ¸›å°‘æ–‡æª”åˆ†æ•£å’Œé‡è¤‡

#### 3. ç°¡åŒ–éƒ¨ç½²æµç¨‹
- âœ… åªéœ€ BAT è…³æœ¬ï¼Œç„¡ PowerShell ä¾è³´
- âœ… é›™æ“Šå³å¯åŸ·è¡Œï¼Œç„¡æ¬Šé™å•é¡Œ
- âœ… é©åˆ Windows ç’°å¢ƒå¿«é€Ÿå•Ÿå‹•

#### 4. ç¨‹å¼ç¢¼æ•´æ½”åº¦æå‡
- âœ… åˆªé™¤è‡¨æ™‚æ¸¬è©¦å’Œä¿®å¾©æ–‡ä»¶
- âœ… æ¸…é™¤é‡è¤‡åŠŸèƒ½çš„è…³æœ¬
- âœ… ä¿æŒé …ç›®çµæ§‹æ¸…æ™°

---

### ğŸ¯ Phase 6 æœ€çµ‚ç¢ºèª

**æ‰€æœ‰ Phase 6 ä»»å‹™å·²å®Œæˆ**:

âœ… **å®‰å…¨æ€§å¼·åŒ–**:
- Rate Limiting (10/min for generate, 2/sec for status/metrics)
- Input Validation (prompt â‰¤ 1000 chars)
- Path Traversal Protection

âœ… **ç³»çµ±ç›£æ§**:
- Metrics API (`/api/metrics`)
- Worker Heartbeat (10s interval, 30s TTL)
- Frontend System HUD (5s polling)

âœ… **è‡ªå‹•åŒ–æ¸¬è©¦**:
- Playwright E2E åŠŸèƒ½æ¸¬è©¦
- aiohttp å£“åŠ›æ¸¬è©¦ (50 concurrent requests)
- Rate Limiting é©—è­‰

âœ… **æ–‡æª”å®Œæ•´æ€§**:
- README.md åŒ…å«å®Œæ•´ç›£æ§èªªæ˜
- UpdateList.md è¨˜éŒ„æ‰€æœ‰è®Šæ›´
- å•Ÿå‹•æ¸¬è©¦æŒ‡å—å®Œå‚™

---

### ğŸ“‹ å¾ŒçºŒè¨ˆåŠƒ

#### ä¸‹ä¸€éšæ®µï¼šPhase 7 è¦åŠƒ

**ç›£æ§å¢å¼· (å„ªå…ˆç´š 1)**:
- [ ] Prometheus + Grafana æ•´åˆ
- [ ] è‡ªå‹•å‘Šè­¦ç³»çµ±ï¼ˆEmail/Slackï¼‰
- [ ] æ­·å²æŒ‡æ¨™æ•¸æ“šå­˜å„²

**åŠŸèƒ½æ“´å±• (å„ªå…ˆç´š 2)**:
- [ ] ç”¨æˆ¶èªè­‰ç³»çµ±ï¼ˆJWT Tokenï¼‰
- [ ] å¤šç”¨æˆ¶ä»»å‹™éš”é›¢
- [ ] æ¬Šé™æ§åˆ¶ï¼ˆAdmin/Userï¼‰

**æ•ˆèƒ½å„ªåŒ– (å„ªå…ˆç´š 3)**:
- [ ] Redis é€£æ¥æ± å„ªåŒ–
- [ ] åœ–ç‰‡ CDN æ•´åˆ
- [ ] WebSocket å¯¦æ™‚é€²åº¦æ¨é€

---

## ğŸ“… 2026-01-06: Phase 6 - Monitoring, Security & Stack Testing (å®Œæ•´ç‰ˆ)

### ğŸ¯ æœ¬æ—¥å·¥ä½œæ¦‚è¦½

**æ ¸å¿ƒç›®æ¨™**: ç³»çµ±å®‰å…¨åŠ å›ºã€å¯è§€æ¸¬æ€§ç›£æ§ã€è‡ªå‹•åŒ–æ¸¬è©¦

**å·¥ä½œæ™‚é–“**: 2026-01-06 å…¨å¤©
**å®Œæˆç‹€æ…‹**: âœ… 100% å®Œæˆ (8 å¤§é …ä»»å‹™)

---

### âœ… å®Œæˆé …ç›®æ¸…å–®

#### 1. Backend å®‰å…¨æ€§å¼·åŒ– ğŸ”’

**1.1 Rate Limiting (API é€Ÿç‡é™åˆ¶)**
- âœ… å®‰è£ä¾è³´ `Flask-Limiter==3.5.0`
- âœ… åœ¨ `backend/src/app.py` åˆå§‹åŒ– `Limiter` å¯¦ä¾‹
  - ä½¿ç”¨ Redis ä½œç‚ºå„²å­˜å¾Œç«¯
  - å…¨å±€é™åˆ¶ï¼š100 æ¬¡/å°æ™‚
  - `/api/generate` ç«¯é»ç‰¹æ®Šé™åˆ¶ï¼š10 æ¬¡/åˆ†é˜
- âœ… è¶…éé™åˆ¶å›å‚³ HTTP 429 (Too Many Requests)

**1.2 Input Validation (è¼¸å…¥é©—è­‰)**
- âœ… Prompt é•·åº¦é™åˆ¶ï¼šæœ€å¤§ 1000 å­—ç¬¦
- âœ… åœ¨ `/api/generate` ç«¯é»æª¢æŸ¥ä¸¦æ‹’çµ•éé•·è«‹æ±‚
- âœ… å›å‚³æ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯

**1.3 Path Traversal Protection (è·¯å¾‘ç©¿è¶Šé˜²è­·)**
- âœ… åœ¨ `/outputs/<filename>` ç«¯é»æ·»åŠ è·¯å¾‘é©—è­‰
- âœ… ä½¿ç”¨ `os.path.abspath()` ç¢ºä¿æ–‡ä»¶è·¯å¾‘åœ¨ `storage/outputs/` å…§
- âœ… æ‹’çµ•æƒ¡æ„è·¯å¾‘è«‹æ±‚ï¼ˆHTTP 403 Forbiddenï¼‰

#### 2. ç³»çµ±å¯è§€æ¸¬æ€§ - Metrics ç«¯é» ğŸ“Š

**2.1 æ–°å¢ `GET /api/metrics` ç«¯é»**
- âœ… å›å‚³ä»¥ä¸‹æŒ‡æ¨™ï¼š
  - `queue_length`: Redis ä½‡åˆ—ä¸­ç­‰å¾…çš„ä»»å‹™æ•¸é‡
  - `worker_status`: Worker ç·šä¸Š/é›¢ç·šç‹€æ…‹
  - `active_jobs`: ç•¶å‰æ­£åœ¨è™•ç†çš„ä»»å‹™æ•¸é‡
- âœ… é€éæª¢æŸ¥ `worker:heartbeat` éµåˆ¤æ–· Worker ç‹€æ…‹

#### 3. Worker å¿ƒè·³æ©Ÿåˆ¶ ğŸ’“

**3.1 å¿ƒè·³ç·šç¨‹å¯¦ç¾**
- âœ… åœ¨ `worker/src/main.py` æ·»åŠ  `worker_heartbeat()` å‡½æ•¸
- âœ… ä½¿ç”¨ `threading.Thread` å•Ÿå‹•èƒŒæ™¯ç·šç¨‹
- âœ… æ¯ 10 ç§’å‘ Redis ç™¼é€å¿ƒè·³ï¼š`SETEX worker:heartbeat 30 "alive"`
- âœ… å¿ƒè·³éµ 30 ç§’éæœŸï¼ˆè‡ªå‹•æª¢æ¸¬ Worker æ–·ç·šï¼‰

#### 4. å‰ç«¯ç›£æ§ HUD çµ„ä»¶ ğŸ®

**4.1 System HUD è¦–è¦ºè¨­è¨ˆ (Cyberpunk é¢¨æ ¼)**
- âœ… åœ¨ Dashboard é ‚éƒ¨æ·»åŠ ç»ç’ƒåŒ–ç›£æ§é¢æ¿
- âœ… ä¸‰å¤§æŒ‡æ¨™é¡¯ç¤ºï¼š
  - **Server Status**: ç¶ è‰²/ç´…è‰²æŒ‡ç¤ºç‡ˆ + æ–‡å­—ç‹€æ…‹
  - **Worker Status**: ç¶ è‰²ï¼ˆONLINEï¼‰/ ç´…è‰²ï¼ˆDISCONNECTEDï¼‰
  - **Queue Count**: æ•¸å­—é¡¯ç¤ºç•¶å‰ä½‡åˆ—é•·åº¦
- âœ… ä½¿ç”¨éœ“è™¹é‚Šæ¡†ã€ç™¼å…‰æ•ˆæœã€å‹•ç•«è„ˆè¡

**4.2 å¯¦æ™‚è¼ªè©¢é‚è¼¯**
- âœ… æ–°å¢ `updateSystemMetrics()` JavaScript å‡½æ•¸
- âœ… æ¯ 5 ç§’è‡ªå‹•èª¿ç”¨ `/api/metrics` ç«¯é»
- âœ… å‹•æ…‹æ›´æ–° HUD æŒ‡æ¨™é¡è‰²å’Œæ•¸å€¼
- âœ… éŒ¯èª¤è™•ç†ï¼šé€£ç·šå¤±æ•—æ™‚é¡¯ç¤ºé›¢ç·šç‹€æ…‹

#### 5. å †ç–Šæ¸¬è©¦å¥—ä»¶ ğŸ§ª

**5.1 å‰µå»º `tests/stack_test.py`**
- âœ… åŠŸèƒ½æ¸¬è©¦ (Functional Test):
  - ä½¿ç”¨ Playwright å•Ÿå‹•ç„¡é ­ç€è¦½å™¨
  - è¨ªå•é¦–é ä¸¦é©—è­‰é é¢æ¨™é¡Œ
  - æª¢æŸ¥ç³»çµ± HUD çµ„ä»¶æ˜¯å¦å¯è¦‹
  - æ¸¬è©¦ `/health` å’Œ `/api/metrics` ç«¯é»
  - è‡ªå‹•æˆªåœ–ä¿å­˜æ¸¬è©¦çµæœ
  
- âœ… å£“åŠ›æ¸¬è©¦ (Stress Test):
  - ä½¿ç”¨ `aiohttp` æ¨¡æ“¬ 20 å€‹ä½µç™¼ç”¨æˆ¶
  - ç™¼é€ 50 å€‹ç•°æ­¥è«‹æ±‚åˆ° `/api/generate`
  - é©—è­‰ Rate Limiter æ˜¯å¦å›å‚³ HTTP 429
  - çµ±è¨ˆæˆåŠŸ/å¤±æ•—/é™æµ/è¶…æ™‚è«‹æ±‚æ•¸é‡
  - ç¢ºèª Server ä¸æœƒå› å£“åŠ›è€Œå´©æ½°

**5.2 æ¸¬è©¦ä¾è³´ç®¡ç†**
- âœ… å‰µå»º `tests/requirements.txt`
  - `playwright==1.40.0`
  - `aiohttp==3.9.1`

#### 6. ç¨‹å¼ç¢¼æ¸…ç†èˆ‡å„ªåŒ– ğŸ§¹

**6.1 æ¸…ç†èˆŠæ–‡ä»¶**
- âœ… åˆªé™¤æ ¹ç›®éŒ„çš„ `backend.log` (å·²æ•´åˆåˆ° `logs/` ç›®éŒ„)
- âœ… æ¸…ç†æ‰€æœ‰ `__pycache__/` ç›®éŒ„

**6.2 èªæ³•é©—è­‰**
- âœ… Backend `app.py` èªæ³•æª¢æŸ¥é€šé
- âœ… Worker `main.py` èªæ³•æª¢æŸ¥é€šé

#### 7. æ¶æ§‹å®Œæ•´æ€§é©—è­‰ âœ…

**7.1 ä¾è³´å®‰è£**
- âœ… Backend: `Flask-Limiter==3.5.0` å®‰è£æˆåŠŸ
- âœ… æ¸¬è©¦å¥—ä»¶: Playwright, aiohttp å·²é…ç½®

**7.2 ç«¯é»æ¸¬è©¦**
- âœ… `/api/generate` - Rate Limiting å·²å•Ÿç”¨
- âœ… `/api/metrics` - æ­£å¸¸å›å‚³ç³»çµ±æŒ‡æ¨™
- âœ… `/api/status/<job_id>` - ç‹€æ…‹æŸ¥è©¢æ­£å¸¸
- âœ… `/health` - å¥åº·æª¢æŸ¥æ­£å¸¸
- âœ… `/outputs/<filename>` - è·¯å¾‘ç©¿è¶Šé˜²è­·å·²å•Ÿç”¨

---

### ğŸ“Š æ–°ç³»çµ±æ¶æ§‹ç¸½çµ

#### Phase 6 æ–°å¢çµ„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Frontend (index.html)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  System HUD (New!)                                    â”‚  â”‚
â”‚  â”‚  - Server Status (Green/Red)                         â”‚  â”‚
â”‚  â”‚  - Worker Status (Online/Disconnected)               â”‚  â”‚
â”‚  â”‚  - Queue Count (Real-time)                           â”‚  â”‚
â”‚  â”‚  â†’ Poll /api/metrics every 5 seconds                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend API (Port 5000)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Security Layer (New!)                                â”‚  â”‚
â”‚  â”‚  - Rate Limiter: 10 req/min for /api/generate       â”‚  â”‚
â”‚  â”‚  - Input Validation: Prompt â‰¤ 1000 chars            â”‚  â”‚
â”‚  â”‚  - Path Traversal Protection                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Observability Endpoints (New!)                       â”‚  â”‚
â”‚  â”‚  - GET /api/metrics â†’ queue, worker, active jobs    â”‚  â”‚
â”‚  â”‚  - Response: {queue_length, worker_status, active}  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Redis (Port 6379)                          â”‚
â”‚  - Key: worker:heartbeat (30s TTL) â† New!                  â”‚
â”‚  - Used by Rate Limiter (DB 1)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Worker (Python)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Heartbeat Thread (New!)                              â”‚  â”‚
â”‚  â”‚  - Send SETEX worker:heartbeat 30 "alive"           â”‚  â”‚
â”‚  â”‚  - Interval: 10 seconds                              â”‚  â”‚
â”‚  â”‚  - Daemon thread (auto-stop on exit)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¸¬è©¦æ¶æ§‹

```
tests/
â”œâ”€â”€ stack_test.py         # ä¸»æ¸¬è©¦è…³æœ¬
â”‚   â”œâ”€â”€ run_functional_test()
â”‚   â”‚   â””â”€â”€ Playwright E2E æ¸¬è©¦
â”‚   â”‚       - è¨ªå•é¦–é 
â”‚   â”‚       - é©—è­‰ HUD çµ„ä»¶
â”‚   â”‚       - æ¸¬è©¦ API ç«¯é»
â”‚   â”‚       - æˆªåœ–ä¿å­˜
â”‚   â”‚
â”‚   â””â”€â”€ run_stress_test()
â”‚       â””â”€â”€ aiohttp ç•°æ­¥å£“åŠ›æ¸¬è©¦
â”‚           - æ¨¡æ“¬ 20 ä½µç™¼ç”¨æˆ¶
â”‚           - ç™¼é€ 50 å€‹è«‹æ±‚
â”‚           - é©—è­‰ Rate Limiter
â”‚           - çµ±è¨ˆæˆåŠŸ/å¤±æ•—ç‡
â”‚
â””â”€â”€ requirements.txt      # æ¸¬è©¦ä¾è³´
    - playwright==1.40.0
    - aiohttp==3.9.1
```

---

### ğŸ”§ æŠ€è¡“æ”¹é€²äº®é»

#### 1. å®‰å…¨æ€§æå‡
- âœ… **Rate Limiting**: é˜²æ­¢ API æ¿«ç”¨å’Œ DDoS æ”»æ“Š
- âœ… **Input Validation**: æ‹’çµ•ç•°å¸¸è«‹æ±‚ï¼Œä¿è­·å¾Œç«¯è™•ç†
- âœ… **Path Traversal Protection**: é˜²æ­¢ç›®éŒ„éæ­·æ”»æ“Š

#### 2. å¯è§€æ¸¬æ€§å¼·åŒ–
- âœ… **Real-time Metrics**: ç³»çµ±ç‹€æ…‹ä¸€ç›®äº†ç„¶
- âœ… **Worker Heartbeat**: è‡ªå‹•æª¢æ¸¬æœå‹™å¥åº·
- âœ… **HUD Dashboard**: è¦–è¦ºåŒ–ç›£æ§é¢æ¿

#### 3. æ¸¬è©¦è‡ªå‹•åŒ–
- âœ… **E2E Testing**: Playwright æ¨¡æ“¬çœŸå¯¦ç”¨æˆ¶æ“ä½œ
- âœ… **Load Testing**: é©—è­‰ç³»çµ±ä½µç™¼è™•ç†èƒ½åŠ›
- âœ… **Regression Testing**: ç¢ºä¿æ›´æ–°ä¸ç ´å£ç¾æœ‰åŠŸèƒ½

---

### ğŸ“‹ Phase 6 æª”æ¡ˆè®Šæ›´çµ±è¨ˆ

#### ä¿®æ”¹æ–‡ä»¶ (3 å€‹)
- âœ… `backend/requirements.txt` - æ–°å¢ Flask-Limiter
- âœ… `backend/src/app.py` - å®‰å…¨å±¤ + Metrics ç«¯é»
- âœ… `worker/src/main.py` - å¿ƒè·³ç·šç¨‹
- âœ… `frontend/index.html` - System HUD çµ„ä»¶

#### æ–°å¢æ–‡ä»¶ (2 å€‹)
- âœ… `tests/stack_test.py` - æ¸¬è©¦è…³æœ¬
- âœ… `tests/requirements.txt` - æ¸¬è©¦ä¾è³´

#### åˆªé™¤æ–‡ä»¶ (1 å€‹)
- âœ… `backend.log` (æ ¹ç›®éŒ„èˆŠæ—¥èªŒ)

**æ–‡ä»¶è®Šæ›´ç¸½è¨ˆ**: ä¿®æ”¹ 4 + æ–°å¢ 2 + åˆªé™¤ 1 = **7 å€‹æ–‡ä»¶**

---

### ğŸ¯ ä¸‹ä¸€æ­¥è¨ˆåŠƒ (Phase 7 è¦åŠƒ)

#### å„ªå…ˆç´š 1: é€²éšç›£æ§
- [ ] **Prometheus + Grafana æ•´åˆ**
  - åŒ¯å‡ºè‡ªå®šç¾© Metrics
  - è¦–è¦ºåŒ–å„€è¡¨æ¿
  - å‘Šè­¦è¦å‰‡é…ç½®

#### å„ªå…ˆç´š 2: å¤šç”¨æˆ¶ç³»çµ±
- [ ] **ç”¨æˆ¶èªè­‰èˆ‡æˆæ¬Š**
  - JWT Token èªè­‰
  - API Key ç®¡ç†
  - æ¬Šé™æ§åˆ¶ (Admin/User)

#### å„ªå…ˆç´š 3: æ€§èƒ½å„ªåŒ–
- [ ] **Redis é€£æ¥æ± å„ªåŒ–**
- [ ] **åœ–ç‰‡ CDN æ•´åˆ (CloudFlare/AWS S3)**
- [ ] **WebSocket å¯¦æ™‚é€²åº¦æ¨é€**

---

## ğŸ“… 2026-01-05: Phase 5 - Ngrok Integration & Architecture Optimization (å®Œæ•´ç‰ˆ)

### ğŸ¯ æœ¬æ—¥å·¥ä½œæ¦‚è¦½

**æ ¸å¿ƒç›®æ¨™**: å¯¦ç¾å…¬ç¶²å­˜å–ã€çµ±ä¸€æ¶æ§‹ã€éŸ¿æ‡‰å¼è¨­è¨ˆã€å®Œæ•´æ–‡æª”

**å·¥ä½œæ™‚é–“**: 2026-01-05 å…¨å¤©
**å®Œæˆç‹€æ…‹**: âœ… 100% å®Œæˆ (9 å¤§é … + 40+ å­ä»»å‹™)

---

### âœ… å®Œæˆé …ç›®æ¸…å–®

#### 1. Ngrok å…¬ç¶²å­˜å–å®Œæ•´æ•´åˆ ğŸŒ

**1.1 Backend éœæ…‹æ–‡ä»¶æœå‹™æ”¹é€ **
- âœ… ä¿®æ”¹ `backend/src/app.py` æ·»åŠ éœæ…‹æ–‡ä»¶è·¯ç”±
- âœ… æ–°å¢ `@app.route('/')` æä¾› index.html
- âœ… æ–°å¢ `@app.route('/<path:path>')` è™•ç†æ‰€æœ‰éœæ…‹è³‡æº (CSS, JS, åœ–ç‰‡)
- âœ… æ·»åŠ  `send_from_directory` å‡½æ•¸å¯¦ç¾æ–‡ä»¶æœå‹™
- âœ… è·¯å¾‘è™•ç†é‚è¼¯ï¼šå€åˆ† API è«‹æ±‚å’Œéœæ…‹æ–‡ä»¶è«‹æ±‚
- âœ… Backend ç¾åœ¨æˆç‚ºçµ±ä¸€å…¥å£é»ï¼ˆPort 5000ï¼‰

**1.2 Ngrok è‡ªå‹•åŒ–è…³æœ¬ç³»çµ±**
- âœ… å‰µå»º `start_ngrok.bat` - å•Ÿå‹• Ngrok ä¸¦æ˜ å°„ Port 5000
- âœ… å‰µå»º `update_ngrok_config.ps1` - PowerShell é…ç½®æ›´æ–°è…³æœ¬
  - è‡ªå‹•å¾ Ngrok API ç²å–å…¬ç¶² URL (http://localhost:4040/api/tunnels)
  - è‡ªå‹•æ›´æ–° `.env` æ–‡ä»¶çš„ NGROK_URL å’Œ BACKEND_URL
  - è‡ªå‹•ç”Ÿæˆ `frontend/config.js` ä¸¦å¯«å…¥å‹•æ…‹é…ç½®
  - å®Œæ•´éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¼¸å‡º
- âœ… å‰µå»º `verify.bat` - å¿«é€Ÿç³»çµ±é©—è­‰å·¥å…·
  - æª¢æŸ¥ Backend (Port 5000) é‹è¡Œç‹€æ…‹
  - æª¢æŸ¥ Ngrok (Port 4040) æ§åˆ¶å°ç‹€æ…‹
  - æª¢æŸ¥å‰ç«¯æ–‡ä»¶å®Œæ•´æ€§
  - é¡¯ç¤ºè¨ªå• URL (æœ¬åœ° + å…¬ç¶²)
- âœ… ä¿®æ”¹ `startweb.bat` - æ¨™è¨˜ç‚ºå¯é¸ï¼ˆBackend å·²æ¥ç®¡ï¼‰

**1.3 é…ç½®è‡ªå‹•åŒ–èˆ‡å‹•æ…‹ç«¯é»**
- âœ… `.env` æ–‡ä»¶æ–°å¢æ¬„ä½ï¼š
  - `NGROK_URL=` (è‡ªå‹•æ›´æ–°)
  - `BACKEND_URL=` (è‡ªå‹•æ›´æ–°)
- âœ… `frontend/config.js` è‡ªå‹•ç”Ÿæˆæ©Ÿåˆ¶
  - æª¢æ¸¬ Ngrok URL å­˜åœ¨æ€§
  - æœ¬åœ°é–‹ç™¼è‡ªå‹•ä½¿ç”¨ localhost:5000
  - å…¬ç¶²æ¨¡å¼è‡ªå‹•ä½¿ç”¨ Ngrok HTTPS URL
  - å‰ç«¯è‡ªå‹•é¸æ“‡æ­£ç¢ºçš„ API ç«¯é»
- âœ… PowerShell è…³æœ¬å®Œå…¨è‹±æ–‡åŒ–ï¼ˆé¿å…ç·¨ç¢¼éŒ¯èª¤ï¼‰

#### 2. æ¶æ§‹å„ªåŒ–èˆ‡æ–‡æª”æ•´åˆ ğŸ“š

**2.1 çµ±ä¸€ç«¯å£æ¶æ§‹ (Port 5000)**
- âœ… æ¶ˆé™¤ Port 8000 Web æœå‹™å™¨ï¼ˆä¸å†éœ€è¦ python http.serverï¼‰
- âœ… Backend Flask çµ±ä¸€æä¾›æ‰€æœ‰æœå‹™ï¼š
  - `/api/*` â†’ RESTful API ç«¯é»
  - `/` â†’ index.html ä¸»é 
  - `/style.css` â†’ å‰ç«¯æ¨£å¼
  - `/outputs/*` â†’ ç”Ÿæˆåœ–ç‰‡
  - `/config.js` â†’ å‹•æ…‹ API é…ç½®
- âœ… Ngrok åªéœ€æ˜ å°„å–®ä¸€ç«¯å£ï¼ˆ5000ï¼‰å³å¯è¨ªå•å®Œæ•´æ‡‰ç”¨

**2.2 æ–‡æª”æ•´åˆèˆ‡æ¸…ç†**
- âœ… åˆªé™¤é‡è¤‡æ–‡æª”ï¼ˆ4 å€‹æ–‡ä»¶ï¼‰ï¼š
  - `NGROK_INTEGRATION.md` (å…§å®¹å·²æ•´åˆ)
  - `NGROK_QUICK_REFERENCE.txt` (å…§å®¹å·²æ•´åˆ)
  - `FIX_REPORT.md` (è‡¨æ™‚ä¿®å¾©è¨˜éŒ„)
  - `TEST_REPORT.md` (æ¸¬è©¦å ±å‘Š)
- âœ… å‰µå»ºçµ±ä¸€çš„ `NGROK_SETUP.md` å®Œæ•´æŒ‡å—
  - Ngrok å®‰è£èˆ‡é…ç½®
  - è‡ªå‹•åŒ–è…³æœ¬ä½¿ç”¨èªªæ˜
  - æ¶æ§‹è®Šæ›´è©³è§£ï¼ˆPort 5000 çµ±ä¸€ï¼‰
  - æ•…éšœæ’é™¤æŒ‡å—
  - å¸¸è¦‹å•é¡Œè§£ç­”
- âœ… æ›´æ–°æ‰€æœ‰æ–‡æª”åæ˜ æœ€æ–°æ¶æ§‹

**2.3 README.md å…¨é¢å‡ç´šé‡å¯«**
- âœ… å®Œå…¨é‡å¯« README.mdï¼ˆ788 è¡Œå°ˆæ¥­æ–‡æª”ï¼‰
- âœ… æ–°å¢å®Œæ•´ç³»çµ±æ¶æ§‹åœ–ï¼ˆå« Ngrok å…¬ç¶²å±¤ï¼‰
- âœ… è©³ç´°çš„ä»»å‹™ç”Ÿå‘½é€±æœŸæµç¨‹ï¼ˆ12 æ­¥é©Ÿï¼‰
- âœ… å®Œæ•´çš„ API ç«¯é»æ–‡æª”
- âœ… æ•…éšœæ’é™¤ç« ç¯€ï¼ˆ9 å€‹å¸¸è¦‹å•é¡Œï¼‰
- âœ… é…ç½®èªªæ˜èˆ‡ç’°å¢ƒè®Šæ•¸è©³è§£
- âœ… é–‹ç™¼æŒ‡å—èˆ‡æœ€ä½³å¯¦è¸
- âœ… Ngrok å¿«é€Ÿå•Ÿå‹•æŒ‡å—
- âœ… éŸ¿æ‡‰å¼è¨­è¨ˆèªªæ˜
- âœ… Badges å’Œç¾åŒ–æ’ç‰ˆ

#### 3. éŸ¿æ‡‰å¼ Web è¨­è¨ˆ (RWD) å®Œæ•´å¯¦ç¾ ğŸ“±

**3.1 ç§»å‹•ç«¯ HTML çµæ§‹**
- âœ… æ·»åŠ ç§»å‹•ç«¯å°ˆç”¨ `<meta name="viewport">` æ¨™ç±¤
  - `width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no`
- âœ… æ·»åŠ ç§»å‹•ç«¯é ‚éƒ¨å°èˆªæ¬„ (`<header class="mobile-header">`)
  - Hamburger menu æŒ‰éˆ•
  - Logo å’Œæ¨™é¡Œ
  - ç§»å‹•ç«¯å°ˆå±¬æ¨£å¼
- âœ… æ·»åŠ é®ç½©å±¤ (`<div class="mobile-overlay">`)
  - é»æ“Šé—œé–‰å´é‚Šæ¬„
  - åŠé€æ˜é»‘è‰²èƒŒæ™¯
  - å¹³æ»‘éæ¸¡å‹•ç•«

**3.2 ç§»å‹•ç«¯ CSS æ¨£å¼**
- âœ… é…ç½® Tailwind CSS è‡ªå®šç¾©æ–·é»
  - `xs: '475px'` - è¶…å°å±å¹•
  - `sm: '640px'` - å°å±å¹•
  - `md: '768px'` - å¹³æ¿
  - `lg: '1024px'` - æ¡Œé¢
- âœ… å¯¦ç¾ `@media (max-width: 768px)` éŸ¿æ‡‰å¼æ¨£å¼
  - å´é‚Šæ¬„å›ºå®šå®šä½ (`position: fixed`)
  - é è¨­éš±è— (`left: -100%`)
  - å±•é–‹å‹•ç•« (`transition: left 0.3s ease-in-out`)
  - `.mobile-open` é¡å±•é–‹å´é‚Šæ¬„ (`left: 0`)
- âœ… å„ªåŒ–èƒŒæ™¯å‹•ç•«å…ƒç´ å°ºå¯¸ï¼ˆç§»å‹•ç«¯ç¸®å°ï¼‰
- âœ… èª¿æ•´å­—é«”å¤§å°å’Œé–“è·ï¼ˆç§»å‹•ç«¯å„ªåŒ–ï¼‰

**3.3 ç§»å‹•ç«¯ JavaScript äº¤äº’**
- âœ… æ–°å¢ `openMobileSidebar()` å‡½æ•¸
  - æ·»åŠ  `.mobile-open` é¡åˆ°å´é‚Šæ¬„
  - é¡¯ç¤ºé®ç½©å±¤ (`.active`)
  - ç¦ç”¨é é¢æ»¾å‹• (`overflow: hidden`)
- âœ… æ–°å¢ `closeMobileSidebar()` å‡½æ•¸
  - ç§»é™¤ `.mobile-open` é¡
  - éš±è—é®ç½©å±¤
  - æ¢å¾©é é¢æ»¾å‹•
- âœ… æ›´æ–° `navigateTo()` å‡½æ•¸
  - æª¢æ¸¬è¢å¹•å¯¬åº¦ (`window.innerWidth < 768`)
  - ç§»å‹•ç«¯å°èˆªå¾Œè‡ªå‹•é—œé–‰å´é‚Šæ¬„
  - æ¡Œé¢ç«¯è¡Œç‚ºä¸è®Š
- âœ… è§¸æ‘¸å„ªåŒ–èˆ‡æ‰‹å‹¢æ”¯æŒ

**3.4 RWD æ¸¬è©¦èˆ‡é©—è­‰**
- âœ… æ¡Œé¢ç«¯æ¸¬è©¦ (â‰¥768px)ï¼šå´é‚Šæ¬„å›ºå®šé¡¯ç¤º âœ“
- âœ… å¹³æ¿ç«¯æ¸¬è©¦ (768px)ï¼šéŸ¿æ‡‰å¼åˆ‡æ› âœ“
- âœ… ç§»å‹•ç«¯æ¸¬è©¦ (<768px)ï¼šæŠ½å±œå¼å°èˆª âœ“
- âœ… è§¸æ‘¸äº¤äº’æ¸¬è©¦ï¼šé»æ“Šã€æ»‘å‹•ã€é®ç½©é—œé–‰ âœ“

#### 4. ç³»çµ±é©—è­‰èˆ‡æ¸¬è©¦å·¥å…· ğŸ”§

**4.1 verify.bat å¿«é€Ÿé©—è­‰å·¥å…·**
- âœ… æª¢æŸ¥ Backend é‹è¡Œç‹€æ…‹ (Port 5000)
- âœ… æª¢æŸ¥ Ngrok æ§åˆ¶å° (Port 4040)
- âœ… æª¢æŸ¥å‰ç«¯æ–‡ä»¶å®Œæ•´æ€§ (index.html, style.css)
- âœ… é¡¯ç¤ºè¨ªå• URLï¼ˆæœ¬åœ°å’Œå…¬ç¶²ï¼‰
- âœ… å½©è‰²çµ‚ç«¯è¼¸å‡ºï¼ˆç¶ è‰²âœ“ã€ç´…è‰²âœ—ï¼‰

**4.2 PowerShell è…³æœ¬å„ªåŒ–**
- âœ… `update_ngrok_config.ps1` å®Œå…¨è‹±æ–‡åŒ–
- âœ… ç§»é™¤æ‰€æœ‰ä¸­æ–‡è¨»é‡‹å’Œè®Šæ•¸åç¨±
- âœ… é¿å… PowerShell ç·¨ç¢¼éŒ¯èª¤ï¼ˆ`'ç²å–' is not recognized`ï¼‰
- âœ… å®Œæ•´éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¼¸å‡º
- âœ… æ·»åŠ æˆåŠŸ/å¤±æ•—ç‹€æ…‹æª¢æ¸¬

#### 5. ç³»çµ±æ¶æ§‹åœ–æ›´æ–° ğŸ—ï¸

**5.1 æ•´é«”æ¶æ§‹åœ–å¢å¼·**
- âœ… æ–°å¢ Ngrok å…¬ç¶²å±¤ï¼ˆæ¶æ§‹åœ–é ‚éƒ¨ï¼‰
- âœ… æ¨™è¨» Port 5000 çµ±ä¸€å…¥å£
- âœ… æ›´æ–° Backend API ç«¯é»åˆ—è¡¨
- âœ… æ·»åŠ éœæ…‹æ–‡ä»¶æœå‹™èªªæ˜
- âœ… ä¿ç•™è©³ç´°çš„ Worker è™•ç†æµç¨‹ï¼ˆ8 æ­¥é©Ÿï¼‰
- âœ… ä¿ç•™ ComfyUI API è©³ç´°èªªæ˜
- âœ… MySQL Port å¾ 3306 æ”¹ç‚º 3307ï¼ˆèˆ‡å¯¦éš›é…ç½®ä¸€è‡´ï¼‰

**5.2 ä»»å‹™ç”Ÿå‘½é€±æœŸæµç¨‹**
- âœ… ä¿ç•™åŸæœ‰çš„ 12 æ­¥é©Ÿè©³ç´°æµç¨‹
- âœ… æ·»åŠ  Ngrok è¨ªå•è·¯å¾‘èªªæ˜
- âœ… æ›´æ–°ç«¯é» URL æ ¼å¼

#### 6. å•Ÿå‹•æµç¨‹å„ªåŒ– ğŸš€

**6.1 æœ€çµ‚å•Ÿå‹•æµç¨‹**
```powershell
# 1. ComfyUI (ç¨ç«‹çµ‚ç«¯)
D:\02_software\ComfyUI_windows_portable\run_nvidia_gpu.bat

# 2. æ‰€æœ‰å¾Œç«¯æœå‹™ (Docker + Backend + Worker)
.\start_all_with_docker.bat

# 3. (å¯é¸) Ngrok å…¬ç¶²å­˜å–
.\start_ngrok.bat

# 4. è¨ªå•æ‡‰ç”¨
# æœ¬åœ°: http://localhost:5000/
# å…¬ç¶²: https://[your-id].ngrok-free.app/
```

**6.2 è¨ªå•æ–¹å¼ç°¡åŒ–**
- âœ… æœ¬åœ°é–‹ç™¼ï¼š`http://localhost:5000/`
- âœ… å…¬ç¶²è¨ªå•ï¼š`https://xxx.ngrok-free.app/`
- âœ… Ngrok æ§åˆ¶å°ï¼š`http://localhost:4040`
- âœ… ä¸å†éœ€è¦ç¨ç«‹çš„ Web æœå‹™å™¨

#### 7. å•é¡Œè¨ºæ–·èˆ‡ä¿®å¾© ğŸ”

**7.1 404 éŒ¯èª¤å®Œå…¨è§£æ±º**
- âœ… è¨ºæ–·ï¼šNgrok æ˜ å°„ Port 5000ï¼Œä½† Web å…§å®¹åœ¨ Port 8000
- âœ… è§£æ±ºï¼šBackend æä¾›éœæ…‹æ–‡ä»¶æœå‹™ï¼Œæ¶ˆé™¤ç«¯å£ä¸ä¸€è‡´
- âœ… é©—è­‰ï¼šæœ¬åœ°å’Œ Ngrok éƒ½èƒ½æ­£å¸¸è¨ªå•

**7.2 PowerShell ç·¨ç¢¼éŒ¯èª¤ä¿®å¾©**
- âœ… å•é¡Œï¼šä¸­æ–‡å­—ç¬¦å°è‡´ `'ç²å–' is not recognized` éŒ¯èª¤
- âœ… è§£æ±ºï¼šå®Œå…¨é‡å¯«ç‚ºè‹±æ–‡è…³æœ¬
- âœ… é©—è­‰ï¼šupdate_ngrok_config.ps1 æ­£å¸¸åŸ·è¡Œ

**7.3 ç›®éŒ„çµæ§‹éŒ¯èª¤ä¿®å¾©**
- âœ… å•é¡Œï¼šPython http.server é¡¯ç¤ºç›®éŒ„åˆ—è¡¨è€Œé index.html
- âœ… è§£æ±ºï¼šä½¿ç”¨ Flask `send_from_directory` æ­£ç¢ºè™•ç†éœæ…‹æ–‡ä»¶
- âœ… é©—è­‰ï¼šç›´æ¥è¨ªå• `/` æ­£ç¢ºé¡¯ç¤ºç¶²é 

#### 8. æ–‡ä»¶è®Šæ›´çµ±è¨ˆ ğŸ“‚

**æ–°å¢æ–‡ä»¶ (5 å€‹)**:
- âœ… `start_ngrok.bat` - Ngrok å•Ÿå‹•è…³æœ¬
- âœ… `update_ngrok_config.ps1` - é…ç½®è‡ªå‹•æ›´æ–°è…³æœ¬
- âœ… `verify.bat` - ç³»çµ±é©—è­‰å·¥å…·
- âœ… `frontend/config.js` - å‹•æ…‹ API é…ç½®ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- âœ… `NGROK_SETUP.md` - Ngrok å®Œæ•´æŒ‡å—
- âœ… `README.md.backup` - åŸç‰ˆå‚™ä»½

**ä¿®æ”¹æ–‡ä»¶ (5 å€‹)**:
- âœ… `backend/src/app.py` - æ·»åŠ éœæ…‹æ–‡ä»¶æœå‹™è·¯ç”±
- âœ… `frontend/index.html` - RWD å®Œæ•´å¯¦ç¾ï¼ˆCSS + HTML + JSï¼‰
- âœ… `.env` - æ·»åŠ  NGROK_URL å’Œ BACKEND_URL
- âœ… `startweb.bat` - æ¨™è¨˜ç‚ºå¯é¸
- âœ… `README.md` - å®Œå…¨é‡å¯«ï¼ˆ788 è¡Œï¼‰

**åˆªé™¤æ–‡ä»¶ (4 å€‹)**:
- âœ… `NGROK_INTEGRATION.md` - å…§å®¹å·²æ•´åˆåˆ° NGROK_SETUP.md
- âœ… `NGROK_QUICK_REFERENCE.txt` - å…§å®¹å·²æ•´åˆ
- âœ… `FIX_REPORT.md` - è‡¨æ™‚ä¿®å¾©è¨˜éŒ„
- âœ… `TEST_REPORT.md` - æ¸¬è©¦å ±å‘Š

**æ–‡ä»¶è®Šæ›´ç¸½è¨ˆ**: æ–°å¢ 5 + ä¿®æ”¹ 5 + åˆªé™¤ 4 = **14 å€‹æ–‡ä»¶**

#### 9. UpdateList.md æ›´æ–° ğŸ“

- âœ… è£œå…… Phase 5 å®Œæ•´è¨˜éŒ„ï¼ˆæœ¬æ–‡ä»¶ï¼‰
- âœ… æ·»åŠ ä»Šæ—¥æ‰€æœ‰å·¥ä½œç´°ç¯€ï¼ˆ40+ å­ä»»å‹™ï¼‰
- âœ… æ›´æ–°ä¸‹ä¸€æ­¥è¨ˆåŠƒ
- âœ… æ·»åŠ å¾…è¾¦äº‹é …æ¸…å–®

---

### ğŸ“Š æ–°ç³»çµ±æ¶æ§‹ç¸½çµ

#### çµ±ä¸€ç«¯å£æ¶æ§‹ (Port 5000)
```
Backend Flask (Port 5000) - çµ±ä¸€å…¥å£é»:
â”œâ”€â”€ /api/generate       â†’ æäº¤ä»»å‹™
â”œâ”€â”€ /api/status         â†’ æŸ¥è©¢ç‹€æ…‹
â”œâ”€â”€ /api/history        â†’ æ­·å²è¨˜éŒ„
â”œâ”€â”€ /api/health         â†’ å¥åº·æª¢æŸ¥
â”œâ”€â”€ /                   â†’ index.html (å‰ç«¯ä¸»é )
â”œâ”€â”€ /style.css          â†’ CSS æ¨£å¼æ–‡ä»¶
â”œâ”€â”€ /config.js          â†’ å‹•æ…‹ API é…ç½®
â””â”€â”€ /outputs/*          â†’ ç”Ÿæˆåœ–ç‰‡

Ngrok å…¬ç¶²è¨ªå•:
https://[your-id].ngrok-free.app â†’ Port 5000 â†’ å®Œæ•´æ‡‰ç”¨
```

#### æ¶æ§‹å„ªå‹¢
1. **ç°¡åŒ–éƒ¨ç½²** - å–®ä¸€ç«¯å£æä¾›æ‰€æœ‰æœå‹™
2. **Ngrok å‹å¥½** - åªéœ€æ˜ å°„ Port 5000
3. **è‡ªå‹•é…ç½®** - å‰ç«¯è‡ªå‹•é¸æ“‡æ­£ç¢ºçš„ API ç«¯é»
4. **ç§»å‹•ç«¯å„ªåŒ–** - å®Œæ•´éŸ¿æ‡‰å¼è¨­è¨ˆ
5. **çµ±ä¸€ç®¡ç†** - Backend æ§åˆ¶æ‰€æœ‰è·¯ç”±

---

### ğŸ”§ æŠ€è¡“æ”¹é€²äº®é»

#### 1. é…ç½®è‡ªå‹•åŒ–
- âœ… Ngrok URL è‡ªå‹•ç²å–ï¼ˆAPI: localhost:4040/api/tunnelsï¼‰
- âœ… .env æ–‡ä»¶è‡ªå‹•æ›´æ–°ï¼ˆNGROK_URL, BACKEND_URLï¼‰
- âœ… config.js å‹•æ…‹ç”Ÿæˆï¼ˆå‰ç«¯è‡ªå‹•é¸æ“‡ç«¯é»ï¼‰
- âœ… PowerShell è…³æœ¬å®Œå…¨è‹±æ–‡åŒ–ï¼ˆé¿å…ç·¨ç¢¼å•é¡Œï¼‰

#### 2. éŸ¿æ‡‰å¼è¨­è¨ˆ
- âœ… Mobile-first è¨­è¨ˆç†å¿µ
- âœ… Tailwind CSS è‡ªå®šç¾©æ–·é»
- âœ… æŠ½å±œå¼å´é‚Šæ¬„å°èˆª
- âœ… è§¸æ‘¸å„ªåŒ–äº¤äº’
- âœ… è‡ªå‹•é—œé–‰å´é‚Šæ¬„é‚è¼¯

#### 3. æ–‡æª”å®Œæ•´æ€§
- âœ… README.md 788 è¡Œå°ˆæ¥­æ–‡æª”
- âœ… NGROK_SETUP.md å®Œæ•´æŒ‡å—
- âœ… ç³»çµ±æ¶æ§‹åœ–å« Ngrok å±¤
- âœ… æ•…éšœæ’é™¤ç« ç¯€
- âœ… API å®Œæ•´æ–‡æª”

#### 4. é–‹ç™¼é«”é©—
- âœ… ä¸€éµå•Ÿå‹•è…³æœ¬
- âœ… å¿«é€Ÿé©—è­‰å·¥å…· (verify.bat)
- âœ… æ¸…æ™°çš„æ—¥èªŒè¼¸å‡º
- âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†

---

### ğŸ¯ ä¸‹ä¸€æ­¥è¨ˆåŠƒ (Phase 6)

#### å„ªå…ˆç´š 1: æ¸¬è©¦èˆ‡é©—è­‰ (å³å°‡é–‹å§‹)
- [ ] **Ngrok å…¬ç¶²è¨ªå•æ¸¬è©¦**
  - [ ] å¾å¤–ç¶²è¨ªå•æ‡‰ç”¨ï¼ˆæ‰‹æ©Ÿ 4G/5G ç¶²è·¯ï¼‰
  - [ ] æ¸¬è©¦ API ç«¯é»åŠŸèƒ½ï¼ˆgenerate, status, historyï¼‰
  - [ ] æ¸¬è©¦åœ–ç‰‡ä¸Šå‚³èˆ‡é¡¯ç¤º
  - [ ] é©—è­‰é…ç½®è‡ªå‹•æ›´æ–°æ©Ÿåˆ¶
  
- [ ] **ç§»å‹•ç«¯å¯¦æ©Ÿæ¸¬è©¦**
  - [ ] iPhone Safari ç€è¦½å™¨æ¸¬è©¦
  - [ ] Android Chrome ç€è¦½å™¨æ¸¬è©¦
  - [ ] iPad å¹³æ¿æ¸¬è©¦
  - [ ] è§¸æ‘¸äº¤äº’æ¸¬è©¦ï¼ˆå´é‚Šæ¬„ã€æŒ‰éˆ•ã€æ»‘å‹•ï¼‰
  - [ ] éŸ¿æ‡‰å¼å¸ƒå±€é©—è­‰ï¼ˆå„ç¨®è¢å¹•å°ºå¯¸ï¼‰
  
- [ ] **æ€§èƒ½åŸºæº–æ¸¬è©¦**
  - [ ] API éŸ¿æ‡‰æ™‚é–“æ¸¬é‡
  - [ ] åœ–ç‰‡è¼‰å…¥é€Ÿåº¦æ¸¬è©¦
  - [ ] ä½µç™¼è«‹æ±‚å£“åŠ›æ¸¬è©¦
  - [ ] å…§å­˜ä½¿ç”¨ç›£æ§

#### å„ªå…ˆç´š 2: åŠŸèƒ½å¢å¼·
- [ ] **Gallery å„ªåŒ–**
  - [ ] Infinite Scroll ç„¡é™æ»¾å‹•è¼‰å…¥
  - [ ] åœ–ç‰‡é è¦½ç‡ˆç®±æ•ˆæœ (Lightbox)
  - [ ] æ‰¹é‡é¸æ“‡èˆ‡åˆªé™¤
  - [ ] æ‰¹é‡ä¸‹è¼‰ç‚º ZIP
  - [ ] æœå°‹èˆ‡ç¯©é¸åŠŸèƒ½ï¼ˆæŒ‰ Prompt, Workflow, æ—¥æœŸï¼‰
  
- [ ] **ç”¨æˆ¶é«”é©—æ”¹é€²**
  - [ ] Prompt æ¨¡æ¿åº«ï¼ˆé è¨­é¢¨æ ¼å¿«é€Ÿæ‡‰ç”¨ï¼‰
  - [ ] æ”¶è—åŠŸèƒ½ï¼ˆæ¨™è¨˜å–œæ„›çš„ä½œå“ï¼‰
  - [ ] åˆ†äº«é€£çµç”Ÿæˆï¼ˆå¸¶éæœŸæ™‚é–“ï¼‰
  - [ ] ä½œå“è©•åˆ†èˆ‡æ¨™ç±¤ç³»çµ±
  - [ ] æ‹–æ”¾ä¸Šå‚³åœ–ç‰‡ (Drag & Drop)
  
- [ ] **åœ–ç‰‡è™•ç†åŠŸèƒ½**
  - [ ] ç·šä¸Šåœ–ç‰‡ç·¨è¼¯ï¼ˆCrop, Rotate, Resizeï¼‰
  - [ ] æ¿¾é¡èˆ‡èª¿è‰²åŠŸèƒ½
  - [ ] åœ–ç‰‡å£“ç¸®èˆ‡å„ªåŒ–
  - [ ] è‡ªå‹•ç”Ÿæˆç¸®åœ–

#### å„ªå…ˆç´š 3: æ•ˆèƒ½èˆ‡å®‰å…¨
- [ ] **æ•ˆèƒ½å„ªåŒ–**
  - [ ] Redis é€£æ¥æ± å¯¦ç¾
  - [ ] MySQL æŸ¥è©¢ç´¢å¼•å„ªåŒ–
  - [ ] åœ–ç‰‡ CDN æ•´åˆï¼ˆCloudFlare, AWS S3ï¼‰
  - [ ] API çµæœå¿«å–ç­–ç•¥
  - [ ] WebSocket å¯¦æ™‚é€²åº¦æ¨é€ï¼ˆæ›¿ä»£è¼ªè©¢ï¼‰
  
- [ ] **å®‰å…¨åŠ å›º**
  - [ ] API Key èªè­‰æ©Ÿåˆ¶
  - [ ] Rate Limiting (Flask-Limiter)
  - [ ] HTTPS å¼·åˆ¶ï¼ˆNginx åå‘ä»£ç†ï¼‰
  - [ ] CORS ç™½åå–®é…ç½®
  - [ ] SQL æ³¨å…¥é˜²è­·
  
- [ ] **ç›£æ§èˆ‡æ—¥èªŒ**
  - [ ] Prometheus + Grafana ç›£æ§å„€è¡¨æ¿
  - [ ] éŒ¯èª¤è¿½è¹¤ç³»çµ± (Sentry)
  - [ ] æ—¥èªŒèšåˆ (ELK Stack)
  - [ ] è‡ªå‹•å‘Šè­¦æ©Ÿåˆ¶

#### å„ªå…ˆç´š 4: é€²éšåŠŸèƒ½ (Phase 7 è¦åŠƒ)
- [ ] **å¤šç”¨æˆ¶ç³»çµ±**
  - [ ] ç”¨æˆ¶è¨»å†Šèˆ‡ç™»å…¥
  - [ ] æ¬Šé™ç®¡ç†ï¼ˆAdmin, User, Guestï¼‰
  - [ ] å€‹äººä½œå“é›†
  - [ ] é…é¡ç®¡ç†
  
- [ ] **AI å·¥ä½œæµæ“´å±•**
  - [ ] Image to Video (Kling / Veo3)
  - [ ] Super Resolution (4x, 8x æ”¾å¤§)
  - [ ] Style Transfer (é¢¨æ ¼é·ç§»)
  - [ ] Background Removal (èƒŒæ™¯å»é™¤)
  - [ ] Inpainting (å±€éƒ¨ä¿®å¾©)
  
- [ ] **ä¼æ¥­ç´šåŠŸèƒ½**
  - [ ] Webhook é€šçŸ¥ï¼ˆSlack, Discord, Emailï¼‰
  - [ ] API ä½¿ç”¨é‡çµ±è¨ˆ
  - [ ] ä»»å‹™å„ªå…ˆç´šç³»çµ±
  - [ ] Kubernetes éƒ¨ç½²
  - [ ] S3 é›²ç«¯å­˜å„²æ•´åˆ

---

### ğŸ“‹ å¾…è¾¦äº‹é …æª¢æŸ¥æ¸…å–®

#### æœ¬é€± (Week 1 - 2026-01-05 ~ 2026-01-11)
- [ ] Ngrok å…¬ç¶²è¨ªå•å®Œæ•´æ¸¬è©¦ï¼ˆæ‰‹æ©Ÿå¯¦æ¸¬ï¼‰
- [ ] ç§»å‹•ç«¯å¤šè¨­å‚™ç€è¦½å™¨æ¸¬è©¦
- [ ] æ’°å¯«æ¸¬è©¦å ±å‘Šæ–‡æª”
- [ ] Gallery Infinite Scroll å¯¦ç¾
- [ ] Prompt æ¨¡æ¿åº«åŸºç¤æ¶æ§‹

#### ä¸‹é€± (Week 2 - 2026-01-12 ~ 2026-01-18)
- [ ] åœ–ç‰‡ç·¨è¼¯åŠŸèƒ½ï¼ˆCrop, Rotateï¼‰
- [ ] æ‰¹é‡ä¸‹è¼‰ ZIP åŠŸèƒ½
- [ ] Redis é€£æ¥æ± å„ªåŒ–
- [ ] API Rate Limiting å¯¦ç¾
- [ ] æ€§èƒ½åŸºæº–æ¸¬è©¦èˆ‡å ±å‘Š

#### æœˆåº¦ (January 2026)
- [ ] API Key èªè­‰ç³»çµ±
- [ ] Prometheus ç›£æ§æ•´åˆ
- [ ] ç”¨æˆ¶è¨»å†Šç™»å…¥ç³»çµ±ï¼ˆMVPï¼‰
- [ ] Image to Video å·¥ä½œæµæ•´åˆ
- [ ] å®Œæ•´çš„ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æŒ‡å—

---

### ğŸ’¡ æ”¹é€²å»ºè­°èˆ‡æŠ€è¡“å‚µå‹™

#### æŠ€è¡“å‚µå‹™
1. **ä»£ç¢¼é‡æ§‹**
   - [ ] Worker æ¨¡çµ„åŒ–æ‹†åˆ†ï¼ˆComfyUI Client, Task Handler, File Managerï¼‰
   - [ ] Frontend çµ„ä»¶åŒ–ï¼ˆè€ƒæ…®å¼•å…¥ Vue.js æˆ– Reactï¼‰
   - [ ] çµ±ä¸€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
   
2. **æ¸¬è©¦è¦†è“‹**
   - [ ] Backend API å–®å…ƒæ¸¬è©¦ (pytest)
   - [ ] Worker ä»»å‹™è™•ç†æ¸¬è©¦
   - [ ] Frontend E2E æ¸¬è©¦ (Playwright)
   - [ ] æ•´åˆæ¸¬è©¦è‡ªå‹•åŒ–
   
3. **æ–‡æª”å®Œå–„**
   - [ ] API ä½¿ç”¨ç¯„ä¾‹ (Postman Collection)
   - [ ] Worker æ¶æ§‹è©³è§£
   - [ ] é–‹ç™¼è€…è²¢ç»æŒ‡å—
   - [ ] è¦–é »æ•™å­¸éŒ„è£½

#### æ€§èƒ½å„ªåŒ–å»ºè­°
1. åœ–ç‰‡å£“ç¸®ï¼šç”Ÿæˆæ™‚è‡ªå‹•å‰µå»ºå¤šç¨®å°ºå¯¸ï¼ˆåŸåœ–ã€é è¦½ã€ç¸®åœ–ï¼‰
2. æ•¸æ“šåº«ç´¢å¼•ï¼šç‚ºå¸¸ç”¨æŸ¥è©¢å­—æ®µæ·»åŠ ç´¢å¼•
3. å‰ç«¯ç·©å­˜ï¼šä½¿ç”¨ Service Worker å¯¦ç¾é›¢ç·šæ”¯æŒ
4. ä½µç™¼æ§åˆ¶ï¼šé™åˆ¶åŒæ™‚è™•ç†çš„ä»»å‹™æ•¸é‡

---

### ğŸ“ˆ é …ç›®çµ±è¨ˆ

#### Phase 5 å®Œæˆçµ±è¨ˆ
- **æ–°å¢åŠŸèƒ½**: 9 å¤§é …
- **å­ä»»å‹™å®Œæˆ**: 40+ é …
- **ä»£ç¢¼ä¿®æ”¹**: 14 å€‹æ–‡ä»¶
- **æ–‡æª”æ›´æ–°**: 4 å€‹æ–‡ä»¶ï¼ˆå«æ–°å¢ï¼‰
- **è…³æœ¬å‰µå»º**: 3 å€‹è‡ªå‹•åŒ–è…³æœ¬
- **åˆªé™¤å†—é¤˜**: 4 å€‹é‡è¤‡æ–‡æª”
- **å·¥ä½œæ™‚é–“**: 1 å€‹å·¥ä½œæ—¥ï¼ˆå…¨å¤©ï¼‰
- **å®Œæˆåº¦**: 100%

#### é …ç›®ç¸½é«”é€²åº¦
- âœ… Phase 1: MVP åŸºç¤æ¶æ§‹
- âœ… Phase 2: åŠŸèƒ½æˆç†Ÿ
- âœ… Phase 3: æ•¸æ“šæŒä¹…åŒ–
- âœ… Phase 4: ç©©å®šæ€§èˆ‡æ—¥èªŒ
- âœ… Phase 5: Ngrok æ•´åˆèˆ‡æ¶æ§‹å„ªåŒ– **â† ç•¶å‰**
- ğŸ”„ Phase 6: æ¸¬è©¦èˆ‡åŠŸèƒ½å¢å¼· (è¦åŠƒä¸­)
- ğŸ“‹ Phase 7: é€²éšåŠŸèƒ½ (è¦åŠƒä¸­)

---

## ğŸ“… 2026-01-05: Phase 4 - Stability & Connectivity (ç©©å®šæ€§èˆ‡é€£ç·š)

### âœ… å®Œæˆé …ç›®

#### 1. Gallery åœ–ç‰‡é¡¯ç¤ºä¿®å¾©
- **Backend API è·¯å¾‘æ ¼å¼åŒ–** (`backend/src/app.py`)
  - ä¿®æ”¹ `/api/history` ç«¯é»ï¼Œå°‡ `output_path` è½‰æ›ç‚ºå®Œæ•´ URL æ ¼å¼ (`/outputs/filename.png`)
  - è™•ç†å¤šåœ–ç‰‡é€—è™Ÿåˆ†éš”çš„æƒ…æ³ï¼Œæå–ç¬¬ä¸€å¼µä½œç‚ºç¸®åœ–
  - ç§»é™¤çµ•å°è·¯å¾‘å‰ç¶´ï¼Œåªä¿ç•™æª”å

- **Frontend åœ–ç‰‡æ¸²æŸ“å„ªåŒ–** (`frontend/index.html`)
  - ä¿®æ­£ `renderGalleryItems()` å‡½æ•¸çš„åœ–ç‰‡ URL æ§‹å»ºé‚è¼¯
  - æ·»åŠ  `loading="lazy"` å±¬æ€§ä»¥å„ªåŒ–æ•ˆèƒ½
  - æ·»åŠ åœ–ç‰‡è¼‰å…¥å¤±æ•—çš„ fallback è™•ç†
  - å¢åŠ  API Response çš„ console.log é™¤éŒ¯è³‡è¨Š

#### 2. å®Œæ•´æ—¥èªŒç³»çµ±å¯¦ä½œ
- **åŸºç¤è¨­æ–½å»ºç½®**
  - å»ºç«‹ `logs/` ç›®éŒ„ä¸¦æ·»åŠ  `.keep` æ–‡ä»¶
  - æ›´æ–° `.gitignore` å¿½ç•¥ `*.log` ä½†ä¿ç•™ç›®éŒ„çµæ§‹
  - ä¿®æ”¹ `docker-compose.yml` æ›è¼‰æ—¥èªŒå·åˆ° Backend å’Œ Worker

- **Backend æ—¥èªŒç³»çµ±** (`backend/src/app.py`)
  - é…ç½® `RotatingFileHandler` (5MB, ä¿ç•™ 3 ä»½å‚™ä»½)
  - è¨˜éŒ„æ‰€æœ‰ HTTP è«‹æ±‚çš„ Method, Path, Status Code
  - è¨˜éŒ„ Exception çš„ Stack Trace
  - æ—¥èªŒæ ¼å¼: `æ™‚é–“ - æ¨¡çµ„ - ç´šåˆ¥ - è¨Šæ¯`

- **Worker æ—¥èªŒç³»çµ±** (`worker/src/main.py`)
  - é…ç½® `RotatingFileHandler` å¯«å…¥ `logs/worker.log`
  - å°‡æ‰€æœ‰ `print()` æ”¹ç‚º `logger.info/warning/error()`
  - è¨˜éŒ„ä»»å‹™ç”Ÿå‘½é€±æœŸï¼šé–‹å§‹ã€é€²åº¦ã€å®Œæˆã€å¤±æ•—
  - è¨˜éŒ„ ComfyUI é€£ç·šç‹€æ…‹å’Œé‡è©¦äº‹ä»¶

#### 3. ä»£ç¢¼å“è³ªæå‡
- çµ±ä¸€æ—¥èªŒè¼¸å‡ºæ ¼å¼
- ç§»é™¤æ‰€æœ‰ console printï¼Œæ”¹ç”¨çµæ§‹åŒ–æ—¥èªŒ
- ç¢ºä¿æ—¥èªŒæª”æ¡ˆè‡ªå‹•è¼ªè½‰å’Œç®¡ç†

### ğŸ“Š ç³»çµ±æ¶æ§‹èªªæ˜

#### æ ¸å¿ƒçµ„ä»¶èˆ‡ä¸²æ¥é‚è¼¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä½¿ç”¨è€…ä»‹é¢ (Frontend)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Dashboard â”‚  â”‚ Canvas   â”‚  â”‚ Gallery  â”‚  â”‚ Settings â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â”‚        HTTP REST API      â”‚             â”‚
        â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Backend API (Flask - Port 5000)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  POST /api/generate  â†’ æäº¤ä»»å‹™åˆ° Redis Queue         â”‚  â”‚
â”‚  â”‚  GET  /api/status    â†’ æŸ¥è©¢ Redis ä»»å‹™ç‹€æ…‹           â”‚  â”‚
â”‚  â”‚  GET  /api/history   â†’ æŸ¥è©¢ MySQL æ­·å²è¨˜éŒ„           â”‚  â”‚
â”‚  â”‚  GET  /api/models    â†’ æƒæ ComfyUI æ¨¡å‹ç›®éŒ„         â”‚  â”‚
â”‚  â”‚  GET  /outputs/*     â†’ æä¾›ç”Ÿæˆåœ–ç‰‡çš„éœæ…‹æª”æ¡ˆæœå‹™     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚ logs/backend.log (RotatingFileHandler, 5MB Ã— 3)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Redis (Port 6379) - è¨Šæ¯ä½‡åˆ—èˆ‡ç‹€æ…‹ç·©å­˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Queue: studio_jobs                                   â”‚  â”‚
â”‚  â”‚  Hash:  job:status:{job_id} (24h TTL)               â”‚  â”‚
â”‚  â”‚         - status, progress, image_url, error         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ BLPOP (é˜»å¡å¼è®€å–)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Worker (Python å¾Œå°æœå‹™)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. å¾ Redis Queue å–å¾—ä»»å‹™                           â”‚  â”‚
â”‚  â”‚  2. è§£æ Workflow JSON ä¸¦æ³¨å…¥åƒæ•¸                     â”‚  â”‚
â”‚  â”‚  3. è™•ç† Base64 åœ–ç‰‡ä¸¦å­˜åˆ° ComfyUI input/            â”‚  â”‚
â”‚  â”‚  4. é€é HTTP API æäº¤ä»»å‹™åˆ° ComfyUI                  â”‚  â”‚
â”‚  â”‚  5. é€é WebSocket ç›£è½åŸ·è¡Œé€²åº¦                       â”‚  â”‚
â”‚  â”‚  6. è¤‡è£½è¼¸å‡ºåœ–ç‰‡åˆ° storage/outputs/                   â”‚  â”‚
â”‚  â”‚  7. æ›´æ–° Redis ç‹€æ…‹ + MySQL è¨˜éŒ„                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚ logs/worker.log (RotatingFileHandler, 5MB Ã— 3)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ComfyUI (Port 8188) - AI åœ–åƒç”Ÿæˆå¼•æ“                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  HTTP API:    /prompt (æäº¤ä»»å‹™)                      â”‚  â”‚
â”‚  â”‚  WebSocket:   /ws (å³æ™‚é€²åº¦æ¨é€)                      â”‚  â”‚
â”‚  â”‚  File System: input/ â†’ output/                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            MySQL (Port 3307) - æŒä¹…åŒ–å„²å­˜                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Table: jobs                                          â”‚  â”‚
â”‚  â”‚  Fields: id, prompt, workflow, model, aspect_ratio,  â”‚  â”‚
â”‚  â”‚          batch_size, seed, status, output_path,      â”‚  â”‚
â”‚  â”‚          created_at, updated_at, is_deleted          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä»»å‹™ç”Ÿå‘½é€±æœŸæµç¨‹

1. **ç”¨æˆ¶æäº¤** â†’ Frontend æ”¶é›†åƒæ•¸ (prompt, images, settings)
2. **API æ¥æ”¶** â†’ Backend é©—è­‰ä¸¦ç”Ÿæˆ UUIDï¼Œå¯«å…¥ MySQL
3. **å…¥éšŠ** â†’ æ¨é€åˆ° Redis Queue (`RPUSH studio_jobs`)
4. **Worker ç›£è½** â†’ ä½¿ç”¨ BLPOP é˜»å¡å¼å–å‡ºä»»å‹™
5. **Workflow è§£æ** â†’ æ ¹æ“š workflow é¡å‹è¼‰å…¥å°æ‡‰ JSON æ¨¡æ¿
6. **åƒæ•¸æ³¨å…¥** â†’ æ›¿æ› prompt, seed, model, aspect_ratio, images
7. **ComfyUI åŸ·è¡Œ** â†’ é€é HTTP POST `/prompt` æäº¤
8. **é€²åº¦ç›£è½** â†’ WebSocket é€£ç·šæ¥æ”¶å³æ™‚é€²åº¦ (0-100%)
9. **çµæœè™•ç†** â†’ è¤‡è£½ output åœ–ç‰‡åˆ° `storage/outputs/`
10. **ç‹€æ…‹æ›´æ–°** â†’ æ›´æ–° Redis Hash + MySQL record
11. **å‰ç«¯è¼ªè©¢** â†’ æ¯ 2 ç§’æŸ¥è©¢ `/api/status/{job_id}`
12. **é¡¯ç¤ºçµæœ** â†’ è¼‰å…¥åœ–ç‰‡ä¸¦æä¾›ä¸‹è¼‰/Remix åŠŸèƒ½

#### æ—¥èªŒç³»çµ±è¨­è¨ˆ

**æ—¥èªŒæª”æ¡ˆä½ç½®:**
- `logs/backend.log` - Backend API è«‹æ±‚èˆ‡éŒ¯èª¤
- `logs/worker.log` - Worker ä»»å‹™è™•ç†è©³ç´°è¨˜éŒ„

**æ—¥èªŒè¼ªè½‰ç­–ç•¥:**
- å–®æª”æœ€å¤§: 5MB
- ä¿ç•™å‚™ä»½: 3 ä»½ (backend.log.1, backend.log.2, backend.log.3)
- è‡ªå‹•å£“ç¸®: å¦ (å¯æ‰‹å‹•é…ç½® gzip)

**æ—¥èªŒç´šåˆ¥:**
- `INFO` - æ­£å¸¸æ“ä½œè¨˜éŒ„ (è«‹æ±‚ã€ä»»å‹™é–‹å§‹/å®Œæˆ)
- `WARNING` - éè‡´å‘½éŒ¯èª¤ (é‡è©¦ã€é™ç´šåŠŸèƒ½)
- `ERROR` - åš´é‡éŒ¯èª¤ (ä»»å‹™å¤±æ•—ã€é€£ç·šä¸­æ–·)

### ğŸš€ ä¸‹ä¸€æ­¥è¨ˆåŠƒ (Phase 5)

1. **å¤–éƒ¨å­˜å–é©—è­‰**
   - [ ] é…ç½® Ngrok å¯¦ç¾å…¬ç¶²å­˜å–
   - [ ] æ¸¬è©¦æ‰‹æ©Ÿç«¯è¨ªå•é«”é©—

2. **åŠŸèƒ½å¢å¼·**
   - [ ] Gallery åˆ†é è¼‰å…¥ (Infinite Scroll)
   - [ ] æ‰¹æ¬¡ä¸‹è¼‰åŠŸèƒ½
   - [ ] ä»»å‹™å–æ¶ˆçš„å‰ç«¯ UI å®Œå–„

3. **æ•ˆèƒ½å„ªåŒ–**
   - [ ] Redis é€£æ¥æ± å„ªåŒ–
   - [ ] MySQL æŸ¥è©¢ç´¢å¼•å„ªåŒ–
   - [ ] åœ–ç‰‡å£“ç¸®èˆ‡ CDN æ•´åˆ

---

## ğŸ“… 2026-01-02: ç¨‹å¼ç¢¼æ¸…ç†èˆ‡æ¶æ§‹æ•´ç†

### ğŸ§¹ ä»£ç¢¼æ¸…ç†

| é …ç›® | é¡å‹ | èªªæ˜ |
|------|------|------|
| `frontend/app.js` | âŒ å·²åˆªé™¤ | åŠŸèƒ½å·²æ•´åˆåˆ° index.html å…§çš„ `<script>` å€å¡Š |
| `frontend/test_navigation.html` | âŒ å·²åˆªé™¤ | é–‹ç™¼æœŸé–“çš„å°èˆªæ¸¬è©¦é é¢ï¼Œå·²ä¸å†éœ€è¦ |
| `frontend/diagnostic.html` | âŒ å·²åˆªé™¤ | é–‹ç™¼æœŸé–“çš„è¨ºæ–·é¢æ¿ï¼Œå·²ä¸å†éœ€è¦ |
| `backend/src/__pycache__/` | âŒ å·²åˆªé™¤ | Python ç·¨è­¯å¿«å– |
| `worker/src/__pycache__/` | âŒ å·²åˆªé™¤ | Python ç·¨è­¯å¿«å– |
| `backend.log` | âŒ å·²åˆªé™¤ | æ ¹ç›®éŒ„æ—¥èªŒæª”æ¡ˆ |

### ğŸ“ ç›®å‰å°ˆæ¡ˆçµæ§‹

```
ComfyUISum/
â”œâ”€â”€ backend/                     # Flask API æœå‹™ (Port 5000)
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ Readmd/                  # API æ–‡æª”
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ app.py              # API ç«¯é» (generate, status, cancel, models, history)
â”‚       â”œâ”€â”€ config.py           # Backend é…ç½®
â”‚       â””â”€â”€ database.py         # MySQL è³‡æ–™åº«æ“ä½œ (é€£æ¥æ± , Jobs è¡¨)
â”‚
â”œâ”€â”€ worker/                      # ä»»å‹™è™•ç†æœå‹™
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.py             # Worker ä¸»è¿´åœˆ (Redis ç›£è½, ä»»å‹™è™•ç†)
â”‚       â”œâ”€â”€ comfy_client.py     # ComfyUI API å®¢æˆ¶ç«¯ (WebSocket é€²åº¦)
â”‚       â”œâ”€â”€ json_parser.py      # Workflow JSON è§£æå™¨ (åƒæ•¸æ³¨å…¥)
â”‚       â”œâ”€â”€ config.py           # Worker é…ç½®
â”‚       â””â”€â”€ check_comfy_connection.py  # è¨ºæ–·å·¥å…·
â”‚
â”œâ”€â”€ frontend/                    # Web UI (Single Page Application)
â”‚   â”œâ”€â”€ index.html              # ä¸»é é¢ (å«æ‰€æœ‰ JS é‚è¼¯)
â”‚   â””â”€â”€ style.css               # æ¨£å¼è¡¨
â”‚
â”œâ”€â”€ ComfyUIworkflow/             # ComfyUI Workflow æ¨¡æ¿
â”‚   â”œâ”€â”€ text_to_image_*.json
â”‚   â”œâ”€â”€ face_swap_*.json
â”‚   â”œâ”€â”€ multi_image_blend_*.json
â”‚   â”œâ”€â”€ single_image_edit_*.json
â”‚   â””â”€â”€ sketch_to_image_*.json
â”‚
â”œâ”€â”€ storage/                     # æœ¬åœ°å„²å­˜
â”‚   â”œâ”€â”€ inputs/                 # æš«å­˜ä¸Šå‚³åœ–ç‰‡ (24h)
â”‚   â”œâ”€â”€ outputs/                # ç”Ÿæˆçµæœ (30å¤©)
â”‚   â””â”€â”€ models/
â”‚
â”œâ”€â”€ openspec/                    # å°ˆæ¡ˆè¦æ ¼æ–‡æª”
â”‚   â”œâ”€â”€ project.md              # å°ˆæ¡ˆèªªæ˜
â”‚   â”œâ”€â”€ AGENTS.md
â”‚   â”œâ”€â”€ specs/                  # æ¨¡çµ„è¦æ ¼
â”‚   â””â”€â”€ changes/                # è®Šæ›´è¨˜éŒ„
â”‚
â”œâ”€â”€ docker-compose.yml           # Docker ç·¨æ’ (Redis + MySQL + Backend + Worker)
â”œâ”€â”€ docker-compose.dev.yml       # é–‹ç™¼ç’°å¢ƒé…ç½®
â”œâ”€â”€ .env                         # ç’°å¢ƒè®Šæ•¸
â”œâ”€â”€ .gitignore                   # Git å¿½ç•¥è¦å‰‡
â”œâ”€â”€ requirements.txt             # Python ä¾è³´ (æ ¹ç›®éŒ„)
â”œâ”€â”€ README.md                    # å°ˆæ¡ˆèªªæ˜
â”œâ”€â”€ STARTUP_GUIDE.md             # å•Ÿå‹•æŒ‡å—
â””â”€â”€ start_all.bat               # ä¸€éµå•Ÿå‹•è…³æœ¬
```

### ğŸ”Œ API ç«¯é»æ¸…å–®

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | èªªæ˜ |
|------|------|------|------|
| POST | `/api/generate` | æäº¤ç”Ÿæˆä»»å‹™ | æ”¯æ´ 5 ç¨®å·¥ä½œæµ |
| GET | `/api/status/{job_id}` | æŸ¥è©¢ä»»å‹™ç‹€æ…‹ | å«é€²åº¦ç™¾åˆ†æ¯” |
| POST | `/api/cancel/{job_id}` | å–æ¶ˆä»»å‹™ | ç™¼é€ä¸­æ–·æŒ‡ä»¤åˆ° ComfyUI |
| GET | `/api/models` | ç²å–æ¨¡å‹åˆ—è¡¨ | æƒæ checkpoints + unet |
| GET | `/api/history` | ç²å–æ­·å²è¨˜éŒ„ | æ”¯æ´åˆ†é  (limit/offset) |
| GET | `/health` | å¥åº·æª¢æŸ¥ | å›å‚³ Redis + MySQL ç‹€æ…‹ |
| GET | `/outputs/{filename}` | ç²å–ç”Ÿæˆåœ–ç‰‡ | éœæ…‹æª”æ¡ˆæœå‹™ |

### ğŸ”„ è³‡æ–™æµç¨‹

```
[Frontend] â†’ POST /api/generate â†’ [Backend] â†’ Redis Queue
                                       â†“
                              [Worker] â† BLPOP Redis
                                       â†“
                              Parse Workflow â†’ [ComfyUI]
                                       â†“
                              WebSocket ç›£è½é€²åº¦
                                       â†“
                              è¤‡è£½è¼¸å‡ºåœ–ç‰‡ â†’ storage/outputs/
                                       â†“
                              æ›´æ–° Redis ç‹€æ…‹ + MySQL è¨˜éŒ„
                                       â†“
[Frontend] â† GET /api/status â† [Backend] â† Redis
```

### ğŸ“‹ ä¸‹ä¸€æ­¥å±•æœ› (Phase 4 è¦åŠƒ)

#### å„ªå…ˆç´š 1: ç©©å®šæ€§èˆ‡æ—¥èªŒ
- [ ] Worker éŒ¯èª¤æ—¥èªŒå¯«å…¥æª”æ¡ˆ (`logs/worker.log`)
- [ ] Backend éŒ¯èª¤æ—¥èªŒå¯«å…¥æª”æ¡ˆ (`logs/backend.log`)
- [ ] API è«‹æ±‚æ—¥èªŒ (request/response)

#### å„ªå…ˆç´š 2: åŠŸèƒ½å¢å¼·
- [ ] Prompt æ¨¡æ¿ç³»çµ± - é è¨­é¢¨æ ¼é¸æ“‡
- [ ] åœ–ç‰‡æ”¶è—åŠŸèƒ½ - æ¨™è¨˜å–œæ­¡çš„åœ–ç‰‡
- [ ] é€²éšåƒæ•¸ - CFG Scale, Steps, Sampler é¸é …

#### å„ªå…ˆç´š 3: æ€§èƒ½å„ªåŒ–
- [ ] åœ–ç‰‡å£“ç¸® - ä¸Šå‚³å‰è‡ªå‹•å£“ç¸®å¤§åœ–
- [ ] çµæœå¿«å– - ç›¸åŒåƒæ•¸ç›´æ¥è¿”å›å¿«å–çµæœ
- [ ] ä½µç™¼æ§åˆ¶ - é™åˆ¶åŒæ™‚è™•ç†çš„ä»»å‹™æ•¸é‡

#### å„ªå…ˆç´š 4: éƒ¨ç½²å®Œå–„
- [ ] HTTPS æ”¯æ´ - ä½¿ç”¨ Nginx åå‘ä»£ç†
- [ ] ç”¨æˆ¶èªè­‰ - ç°¡æ˜“ API Key èªè­‰
- [ ] ç›£æ§é¢æ¿ - ä»»å‹™çµ±è¨ˆå’Œç³»çµ±ç‹€æ…‹
- [ ] Ngrok æ•´åˆ - å…§ç¶²ç©¿é€æ¸¬è©¦

---

## ğŸ“… 2026-01-02: Phase 3 - Data & Intelligence å®Œæˆ

### ğŸ¯ ä»Šæ—¥å®Œæˆäº‹é … (Phase 3 å…¨éƒ¨å®Œæˆ)

| æ¨¡çµ„ | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| **Database** | MySQL 8.0 è³‡æ–™åº«å»ºç½® | âœ… å®Œæˆ |
| **Database** | Jobs è¡¨ Schema è¨­è¨ˆ | âœ… å®Œæˆ |
| **Backend** | è³‡æ–™åº«é€£æ¥æ± æ•´åˆ | âœ… å®Œæˆ |
| **Backend** | `GET /api/history` æ­·å²è¨˜éŒ„ API | âœ… å®Œæˆ |
| **Backend** | ä»»å‹™ç‹€æ…‹åŒæ­¥åˆ°è³‡æ–™åº« | âœ… å®Œæˆ |
| **Frontend** | Personal Gallery é é¢ | âœ… å®Œæˆ |
| **Frontend** | Remix åŠŸèƒ½ï¼ˆé‡æ–°ä½¿ç”¨åƒæ•¸ï¼‰ | âœ… å®Œæˆ |
| **Worker** | è³‡æ–™åº«åŒæ­¥æ¸…ç†ï¼ˆSoft Deleteï¼‰ | âœ… å®Œæˆ |
| **Worker** | ComfyUI éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶ | âœ… å®Œæˆ |
| **Docker** | MySQL æœå‹™æ•´åˆ | âœ… å®Œæˆ |
| **Docker** | Backend Healthcheck | âœ… å®Œæˆ |
| **Docker** | é¡åƒå¤§å°å„ªåŒ– | âœ… å®Œæˆ |

### ğŸ—„ï¸ æ–°å¢è³‡æ–™åº«æ¶æ§‹

#### Jobs è¡¨çµæ§‹
```sql
CREATE TABLE jobs (
    id VARCHAR(36) PRIMARY KEY,              -- Job UUID
    prompt TEXT,                             -- æç¤ºè©
    workflow VARCHAR(50),                    -- å·¥ä½œæµé¡å‹
    model VARCHAR(100),                      -- ä½¿ç”¨æ¨¡å‹
    aspect_ratio VARCHAR(10),                -- åœ–ç‰‡æ¯”ä¾‹
    batch_size INT DEFAULT 1,                -- æ‰¹æ¬¡æ•¸é‡
    seed INT DEFAULT -1,                     -- éš¨æ©Ÿç¨®å­
    status VARCHAR(20),                      -- ç‹€æ…‹ (queued, processing, finished, failed)
    output_path TEXT,                        -- è¼¸å‡ºè·¯å¾‘ (å¤šå¼µç”¨é€—è™Ÿåˆ†éš”)
    created_at TIMESTAMP DEFAULT NOW,        -- å»ºç«‹æ™‚é–“
    updated_at TIMESTAMP ON UPDATE NOW,      -- æ›´æ–°æ™‚é–“
    is_deleted BOOLEAN DEFAULT FALSE,        -- è»Ÿåˆªé™¤æ¨™è¨˜
    INDEX idx_status (status),
    INDEX idx_created_at (created_at),
    INDEX idx_is_deleted (is_deleted)
);
```

### ğŸ†• æ–°å¢ API ç«¯é»

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ | åƒæ•¸ |
|------|------|------|------|
| GET | `/api/history` | ç²å–æ­·å²è¨˜éŒ„ | `limit` (é è¨­ 50), `offset` (é è¨­ 0) |
| GET | `/health` | å¥åº·æª¢æŸ¥ï¼ˆå¼·åŒ–ç‰ˆï¼‰ | - (å›å‚³ Redis + MySQL ç‹€æ…‹) |

### ğŸ¨ æ–°å¢å‰ç«¯åŠŸèƒ½

#### Personal Gallery
- **éŸ¿æ‡‰å¼ç¶²æ ¼ä½ˆå±€**: 1-4 æ¬„è‡ªé©æ‡‰é¡¯ç¤º
- **å¡ç‰‡è³‡è¨Š**: ç¸®åœ–ã€æç¤ºè©ã€å·¥ä½œæµé¡å‹ã€æ—¥æœŸã€ç‹€æ…‹
- **åœ–ç‰‡æ•¸é‡æ¨™è¨˜**: æ‰¹æ¬¡ç”Ÿæˆæ™‚é¡¯ç¤ºåœ–ç‰‡æ•¸
- **ç‹€æ…‹é¡è‰²ç·¨ç¢¼**: 
  - âœ… Finished (ç¶ è‰²)
  - âŒ Failed (ç´…è‰²)
  - â³ Processing (é»ƒè‰²)
  - ğŸ“‹ Queued (è—è‰²)
  - ğŸš« Cancelled (ç°è‰²)

#### Remix åŠŸèƒ½
é»æ“Šæ­·å²è¨˜éŒ„çš„ "Remix" æŒ‰éˆ•ï¼š
1. è‡ªå‹•è·³è½‰åˆ° Image Composition å·¥ä½œå€
2. é¸æ“‡å°æ‡‰çš„å·¥ä½œæµå·¥å…·
3. å¡«å……åŸå§‹åƒæ•¸ï¼ˆPromptã€Seedã€Modelã€Aspect Ratioï¼‰
4. å…è¨±å¿«é€Ÿä¿®æ”¹ä¸¦é‡æ–°ç”Ÿæˆ

### ğŸ”§ ç³»çµ±éŸŒæ€§å¼·åŒ–

#### Worker è‡ªå‹•ç¶­è­·
- **å•Ÿå‹•æ™‚æ¸…ç†**: åˆªé™¤éæœŸæª”æ¡ˆä¸¦åŒæ­¥è³‡æ–™åº«
- **å®šæœŸæ¸…ç†**: æ¯å°æ™‚åŸ·è¡Œä¸€æ¬¡
- **è»Ÿåˆªé™¤æ©Ÿåˆ¶**: åˆªé™¤æª”æ¡ˆæ™‚æ¨™è¨˜è³‡æ–™åº« `is_deleted = TRUE`ï¼Œä¿ç•™æ­·å²è¨˜éŒ„

#### éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶
- **ComfyUI é€£æ¥é‡è©¦**: å¤±æ•—æ™‚ç­‰å¾… 5 ç§’å¾Œé‡è©¦ 1 æ¬¡
- **Redis æ–·ç·šé‡é€£**: è‡ªå‹•é‡é€£ä¸¦ç¹¼çºŒè™•ç†ä½‡åˆ—

### ğŸ³ Docker å„ªåŒ–

#### MySQL æœå‹™
- **ç‰ˆæœ¬**: MySQL 8.0
- **ç«¯å£**: 3306 (æœ¬åœ° DBeaver å¯é€£æ¥)
- **æŒä¹…åŒ–**: `./mysql_data:/var/lib/mysql`
- **Healthcheck**: ç¢ºä¿è³‡æ–™åº«å°±ç·’å¾Œæ‰å•Ÿå‹• Backend

#### é¡åƒå„ªåŒ–
- **Python ç‰ˆæœ¬**: å‡ç´šåˆ° 3.10-slim
- **Pip å„ªåŒ–**: `--no-cache-dir` æ¸›å°‘é¡åƒå¤§å°
- **Backend Healthcheck**: æ¯ 30 ç§’æª¢æŸ¥ `/health` ç«¯é»

### ğŸ“¦ ä¾è³´æ›´æ–°

#### Backend
```txt
+ mysql-connector-python==8.2.0
```

### ğŸ”„ è³‡æ–™æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Browser â”‚â”€â”€â”€â”€â–¶â”‚  Backend â”‚â”€â”€â”€â”€â–¶â”‚   MySQL  â”‚
â”‚          â”‚     â”‚   API    â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                â”‚                 â–²
     â”‚                â–¼                 â”‚
     â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚          â”‚  Redis   â”‚            â”‚
     â”‚          â”‚  Queue   â”‚            â”‚
     â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚               â”‚                  â”‚
     â”‚               â–¼                  â”‚
     â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       Soft Delete
     â”‚          â”‚  Worker  â”‚            â”‚
     â”‚          â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚
     â”‚               â–¼
     â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ ComfyUI  â”‚
                â”‚          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ ç’°å¢ƒè®Šæ•¸æ›´æ–°

#### .env æ–°å¢é…ç½®
```ini
# MySQL Database Configuration
DB_HOST=localhost
DB_PORT=3306
DB_USER=studio_user
DB_PASSWORD=studio_password
DB_NAME=studio_db
```

### ğŸ§ª æ¸¬è©¦é©—è­‰æ­¥é©Ÿ

1. **å•Ÿå‹•å®Œæ•´å †ç–Š**
   ```bash
   docker-compose up -d
   ```

2. **æª¢æŸ¥å¥åº·ç‹€æ…‹**
   ```bash
   curl http://localhost:5000/health
   # æ‡‰å›å‚³: {"status":"ok","redis":"healthy","mysql":"healthy"}
   ```

3. **ç”Ÿæˆæ¸¬è©¦åœ–ç‰‡**
   - æäº¤ä»»å‹™ä¸¦ç¢ºèªè³‡æ–™åº«æœ‰è¨˜éŒ„

4. **è¨ªå• Personal Gallery**
   - ç¢ºèªèƒ½çœ‹åˆ°æ­·å²è¨˜éŒ„
   - æ¸¬è©¦ Remix åŠŸèƒ½

5. **æ¸¬è©¦æ¸…ç†æ©Ÿåˆ¶**
   - ä¿®æ”¹æª”æ¡ˆæ™‚é–“æˆ³æ¨¡æ“¬éæœŸæª”æ¡ˆ
   - é‡å•Ÿ Worker ç¢ºèªè‡ªå‹•æ¸…ç†

### ğŸš€ éƒ¨ç½²æé†’

1. **è³‡æ–™åº«åˆå§‹åŒ–**: é¦–æ¬¡å•Ÿå‹•æ™‚ Backend æœƒè‡ªå‹•å»ºç«‹ `jobs` è¡¨
2. **è³‡æ–™æŒä¹…åŒ–**: ç¢ºä¿ `./mysql_data` ç›®éŒ„æœ‰å¯«å…¥æ¬Šé™
3. **æœ¬åœ°é–‹ç™¼**: Backend å’Œ Worker éœ€è¦æ‰‹å‹•è¨­å®š `DB_HOST=localhost`
4. **Docker ç’°å¢ƒ**: è‡ªå‹•ä½¿ç”¨ `DB_HOST=mysql` é€éå…§éƒ¨ç¶²è·¯é€£æ¥

---

## ğŸ“… 2024-12-31: ä»Šæ—¥ç¸½çµèˆ‡ä¸‹é€±å±•æœ›

### ğŸ¯ ä»Šæ—¥å®Œæˆäº‹é … (Phase 2 å…¨éƒ¨å®Œæˆ)

| æ¨¡çµ„ | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| **UX** | å³æ™‚é€²åº¦æ¢ | âœ… å®Œæˆ |
| **API** | å‹•æ…‹æ¨¡å‹åˆ—è¡¨ `GET /api/models` | âœ… å®Œæˆ |
| **API** | ä»»å‹™å–æ¶ˆ `POST /api/cancel/{job_id}` | âœ… å®Œæˆ |
| **UI** | å‹•æ…‹æ¨¡å‹ä¸‹æ‹‰é¸å–® | âœ… å®Œæˆ |
| **UI** | æ‰¹æ¬¡åœ–ç‰‡ç¶²æ ¼é¡¯ç¤º | âœ… å®Œæˆ |
| **Docker** | Backend + Worker å®¹å™¨åŒ– | âœ… å®Œæˆ |
| **Docker** | docker-compose å®Œæ•´ç·¨æ’ | âœ… å®Œæˆ |
| **Worker** | åœ–ç‰‡è‡ªå‹•æ¸…ç† (30å¤©) | âœ… å®Œæˆ |
| **Worker** | è¼¸å‡ºåœ–ç‰‡æ™ºèƒ½é¸æ“‡ | âœ… å®Œæˆ |
| **Config** | ComfyUI è·¯å¾‘ç’°å¢ƒè®Šæ•¸ | âœ… å®Œæˆ |

### ğŸ› ï¸ ä»Šæ—¥ä¿®å¾©çš„ Bug

1. **WebSocket è§£æéŒ¯èª¤** - `'NoneType' object has no attribute 'get'`
   - **åŸå› **: ComfyUI å›å‚³çš„ `data` æ¬„ä½ç‚º `null`
   - **ä¿®å¾©**: åœ¨ `comfy_client.py` æ·»åŠ é¡å‹æª¢æŸ¥

2. **è¼¸å‡ºåœ–ç‰‡æ‰¾ä¸åˆ°** - ComfyUI è¼¸å‡ºå¤šå¼µåœ–ç‰‡æ™‚è¤‡è£½å¤±æ•—
   - **åŸå› **: èˆŠä»£ç¢¼åªä¿ç•™æœ€å¾Œä¸€å¼µåœ–ç‰‡ä¿¡æ¯
   - **ä¿®å¾©**: æ”¶é›†æ‰€æœ‰åœ–ç‰‡ï¼Œå„ªå…ˆé¸æ“‡æœ‰ subfolder çš„æ­£å¼è¼¸å‡º

3. **ComfyUI è·¯å¾‘éŒ¯èª¤** - Worker æ‰¾ä¸åˆ°è¼¸å‡ºç›®éŒ„
   - **åŸå› **: é è¨­è·¯å¾‘å‡è¨­éŒ¯èª¤
   - **ä¿®å¾©**: æ›´æ–° `.env` é…ç½®æ­£ç¢ºçš„ ComfyUI è·¯å¾‘

### ğŸ§¹ ä»£ç¢¼æ¸…ç†

- âŒ åˆªé™¤ `backend/src/routes.py` (ç©ºæ–‡ä»¶)
- âŒ åˆªé™¤ `__pycache__/` ç›®éŒ„
- âŒ åˆªé™¤ `backend.log` æ—¥èªŒ
- âŒ åˆªé™¤ `restart_worker.ps1` (è‡¨æ™‚è…³æœ¬)
- âœ… æ›´æ–° `.gitignore` è¦å‰‡

### ğŸ“Š ç•¶å‰æ¶æ§‹

```
ComfyUISum/
â”œâ”€â”€ backend/                    # Flask API æœå‹™
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ app.py             # API ç«¯é» (generate, status, cancel, models)
â”‚       â””â”€â”€ config.py          # Backend é…ç½®
â”‚
â”œâ”€â”€ worker/                     # ä»»å‹™è™•ç†æœå‹™
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.py            # Worker ä¸»è¿´åœˆ
â”‚       â”œâ”€â”€ comfy_client.py    # ComfyUI API å®¢æˆ¶ç«¯
â”‚       â”œâ”€â”€ json_parser.py     # Workflow è§£æå™¨
â”‚       â”œâ”€â”€ config.py          # Worker é…ç½®
â”‚       â””â”€â”€ check_comfy_connection.py  # è¨ºæ–·å·¥å…·
â”‚
â”œâ”€â”€ frontend/                   # Web UI
â”‚   â”œâ”€â”€ index.html             # å–®é æ‡‰ç”¨
â”‚   â”œâ”€â”€ style.css
â”‚   â””â”€â”€ app.js
â”‚
â”œâ”€â”€ storage/                    # æœ¬åœ°å„²å­˜
â”‚   â”œâ”€â”€ inputs/                # æš«å­˜ä¸Šå‚³åœ–ç‰‡ (24h)
â”‚   â””â”€â”€ outputs/               # ç”Ÿæˆçµæœ (30å¤©)
â”‚
â”œâ”€â”€ docker-compose.yml          # å®¹å™¨ç·¨æ’
â”œâ”€â”€ .env                        # ç’°å¢ƒè®Šæ•¸
â”œâ”€â”€ DEPLOYMENT.md               # éƒ¨ç½²æŒ‡å—
â””â”€â”€ ARCHITECTURE.md             # æ¶æ§‹èªªæ˜
```

### ğŸ”Œ API ç«¯é»æ¸…å–®

| æ–¹æ³• | ç«¯é» | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/generate` | æäº¤ç”Ÿæˆä»»å‹™ |
| GET | `/api/status/{job_id}` | æŸ¥è©¢ä»»å‹™ç‹€æ…‹ |
| POST | `/api/cancel/{job_id}` | å–æ¶ˆä»»å‹™ |
| GET | `/api/models` | ç²å–æ¨¡å‹åˆ—è¡¨ |
| GET | `/outputs/{filename}` | ç²å–ç”Ÿæˆåœ–ç‰‡ |
| GET | `/health` | å¥åº·æª¢æŸ¥ |

---

### ğŸ“‹ ä¸‹é€±å±•æœ› (Phase 3 è¦åŠƒ)

#### å„ªå…ˆç´š 1: ç©©å®šæ€§èˆ‡æ¸¬è©¦
- [ ] å®Œå–„å–®åœ–ç·¨è¼¯ (single_image_edit) å·¥ä½œæµæ¸¬è©¦
- [ ] ä¿®å¾©æ‰€æœ‰ Workflow é¡å‹çš„ç«¯åˆ°ç«¯æ¸¬è©¦
- [ ] æ·»åŠ éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶ (ä»»å‹™å¤±æ•—è‡ªå‹•é‡è©¦ 1 æ¬¡)
- [ ] æ·»åŠ æ—¥èªŒè¨˜éŒ„åˆ°æ–‡ä»¶ (Worker + Backend)

#### å„ªå…ˆç´š 2: åŠŸèƒ½å¢å¼·
- [ ] æ­·å²è¨˜éŒ„åŠŸèƒ½ - ä¿å­˜æœ€è¿‘ 50 ç­†ç”Ÿæˆè¨˜éŒ„
- [ ] åœ–ç‰‡æ”¶è—åŠŸèƒ½ - æ¨™è¨˜å–œæ­¡çš„åœ–ç‰‡
- [ ] Prompt æ¨¡æ¿ - é è¨­é¢¨æ ¼æ¨¡æ¿é¸æ“‡
- [ ] é€²éšåƒæ•¸ - CFG Scale, Steps, Sampler é¸é …

#### å„ªå…ˆç´š 3: æ€§èƒ½å„ªåŒ–
- [ ] åœ–ç‰‡å£“ç¸® - ä¸Šå‚³å‰è‡ªå‹•å£“ç¸®å¤§åœ–
- [ ] çµæœå¿«å– - ç›¸åŒåƒæ•¸ç›´æ¥è¿”å›å¿«å–çµæœ
- [ ] ä½µç™¼æ§åˆ¶ - é™åˆ¶åŒæ™‚è™•ç†çš„ä»»å‹™æ•¸é‡

#### å„ªå…ˆç´š 4: éƒ¨ç½²å®Œå–„
- [ ] HTTPS æ”¯æ´ - ä½¿ç”¨ Nginx åå‘ä»£ç†
- [ ] ç”¨æˆ¶èªè­‰ - ç°¡æ˜“ API Key èªè­‰
- [ ] ç›£æ§é¢æ¿ - ä»»å‹™çµ±è¨ˆå’Œç³»çµ±ç‹€æ…‹

---

## 2024-12-31: Phase 2 - Step 4: ä»»å‹™ç®¡ç†èˆ‡ç¶­è­·

### æ¦‚è¿°
å¯¦ç¾ä»»å‹™å–æ¶ˆåŠŸèƒ½å’Œåœ–ç‰‡è‡ªå‹•æ¸…ç†æ©Ÿåˆ¶ï¼Œæå‡ç³»çµ±çš„å¯æ§æ€§å’Œç£ç¢Ÿç©ºé–“ç®¡ç†èƒ½åŠ›ã€‚

### è®Šæ›´å…§å®¹

#### 1. Backend API - `backend/src/app.py`
- **æ–°å¢ `POST /api/cancel/{job_id}` ç«¯é»**
  - æª¢æŸ¥ä»»å‹™æ˜¯å¦å­˜åœ¨
  - é©—è­‰ä»»å‹™ç‹€æ…‹ï¼ˆåªèƒ½å–æ¶ˆ `queued` æˆ– `processing` ç‹€æ…‹çš„ä»»å‹™ï¼‰
  - å°‡ä»»å‹™ç‹€æ…‹è¨­ç½®ç‚º `cancelled`
  - è¨­ç½®éŒ¯èª¤è¨Šæ¯ï¼š`Task cancelled by user`
  - å›æ‡‰æ ¼å¼ï¼š
    ```json
    {
      "success": true,
      "message": "Task cancelled"
    }
    ```

#### 2. Worker - `worker/src/comfy_client.py`
- **æ–°å¢ `interrupt()` æ–¹æ³•**
  - ç™¼é€ `POST /interrupt` è«‹æ±‚åˆ° ComfyUI
  - ä¸­æ–·ç•¶å‰åŸ·è¡Œçš„ä»»å‹™
  - è¿”å›å¸ƒçˆ¾å€¼è¡¨ç¤ºæ˜¯å¦æˆåŠŸ

#### 3. Worker - `worker/src/main.py`
- **`process_job()` å‡½æ•¸å¢å¼·**
  - åœ¨ `on_progress` å›èª¿ä¸­æª¢æŸ¥ä»»å‹™ç‹€æ…‹
  - å¦‚æœç‹€æ…‹è®Šç‚º `cancelled`ï¼Œç«‹å³èª¿ç”¨ `client.interrupt()`
  - æ‹‹å‡ºç•°å¸¸çµ‚æ­¢ä»»å‹™è™•ç†

- **æ–°å¢ `cleanup_old_output_files()` å‡½æ•¸**
  - æƒæ `storage/outputs` ç›®éŒ„
  - åˆªé™¤è¶…é 30 å¤©çš„åœ–ç‰‡æª”æ¡ˆ
  - è¨˜éŒ„åˆªé™¤æ•¸é‡å’Œé‡‹æ”¾ç©ºé–“

- **ä¸»å¾ªç’°å¢å¼·**
  - Worker å•Ÿå‹•æ™‚åŸ·è¡Œä¸€æ¬¡åœ–ç‰‡æ¸…ç†
  - æ¯å°æ™‚å®šæœŸåŸ·è¡Œåœ–ç‰‡æ¸…ç†ï¼ˆåŒ…æ‹¬æš«å­˜æª”æ¡ˆå’Œè¼¸å‡ºåœ–ç‰‡ï¼‰

### æŠ€è¡“ç´°ç¯€

#### ä»»å‹™å–æ¶ˆæµç¨‹
```
ç”¨æˆ¶è«‹æ±‚ â†’ POST /api/cancel/{job_id} â†’ 
Redis ç‹€æ…‹æ›´æ–°ç‚º 'cancelled' â†’ 
Worker æª¢æ¸¬åˆ°ç‹€æ…‹è®ŠåŒ– â†’ 
èª¿ç”¨ ComfyUI /interrupt â†’ 
ä»»å‹™çµ‚æ­¢
```

#### åœ–ç‰‡æ¸…ç†æµç¨‹
```
Worker å•Ÿå‹• â†’ cleanup_old_output_files() â†’ 
æ¯å°æ™‚è§¸ç™¼ â†’ åˆªé™¤è¶…é 30 å¤©çš„æª”æ¡ˆ â†’ 
è¨˜éŒ„æ¸…ç†çµ±è¨ˆ
```

### æ¸…ç†ç­–ç•¥
- **æš«å­˜æª”æ¡ˆ**ï¼ˆ`storage/inputs`ï¼‰: ä¿ç•™ 24 å°æ™‚
- **è¼¸å‡ºåœ–ç‰‡**ï¼ˆ`storage/outputs`ï¼‰: ä¿ç•™ 30 å¤©
- **æ¸…ç†é »ç‡**: æ¯å°æ™‚æª¢æŸ¥ä¸€æ¬¡

### é©—è­‰æ­¥é©Ÿ

#### æ¸¬è©¦ä»»å‹™å–æ¶ˆ
1. æäº¤ä¸€å€‹ç”Ÿæˆä»»å‹™
2. åœ¨è™•ç†éç¨‹ä¸­èª¿ç”¨ `POST /api/cancel/{job_id}`
3. ç¢ºèªä»»å‹™ç‹€æ…‹è®Šç‚º `cancelled`
4. ç¢ºèª ComfyUI æ”¶åˆ°ä¸­æ–·æŒ‡ä»¤

#### æ¸¬è©¦åœ–ç‰‡æ¸…ç†
1. åœ¨ `storage/outputs` æ”¾ç½®èˆŠæª”æ¡ˆï¼ˆä¿®æ”¹æ™‚é–“æˆ³ï¼‰
2. å•Ÿå‹• Worker
3. æª¢æŸ¥èˆŠæª”æ¡ˆæ˜¯å¦è¢«åˆªé™¤
4. æŸ¥çœ‹æ—¥èªŒç¢ºèªæ¸…ç†çµ±è¨ˆ

### ç›¸é—œæ–‡ä»¶
- [task.md](openspec/changes/phase-2-maturity/task.md) - Phase 2 ä»»å‹™æ¸…å–®

---

## 2024-12-31: Phase 2 - Step 3: Docker å®¹å™¨åŒ–éƒ¨ç½²

### æ¦‚è¿°
å®Œå–„ Docker å®¹å™¨åŒ–é…ç½®ï¼Œå¯¦ç¾ä¸€éµå•Ÿå‹•æ•´å€‹ç³»çµ±ï¼ˆRedisã€Backendã€Workerï¼‰ã€‚

### è®Šæ›´å…§å®¹

#### 1. Backend - `backend/Dockerfile`
- **åŸºç¤æ˜ åƒ**: Python 3.9 Slim
- **å·¥ä½œç›®éŒ„**: `/app`
- **è¤‡è£½æª”æ¡ˆ**: `requirements.txt` + `src/`
- **å•Ÿå‹•å‘½ä»¤**: `python src/app.py`

#### 2. Worker - `worker/Dockerfile`
- **åŸºç¤æ˜ åƒ**: Python 3.9 Slim
- **å·¥ä½œç›®éŒ„**: `/worker`
- **è¤‡è£½æª”æ¡ˆ**: `requirements.txt` + `src/`
- **å•Ÿå‹•å‘½ä»¤**: `python src/main.py`

#### 3. Docker Compose - `docker-compose.yml`
- **Redis æœå‹™**:
  - æ˜ åƒ: `redis:7.2`
  - ç«¯å£: `6379`
  - æŒä¹…åŒ–: `./redis_data:/data`
  - å¯†ç¢¼: `mysecret`
  
- **Backend æœå‹™**:
  - å»ºç½®: `./backend`
  - ç«¯å£: `5000:5000`
  - ç’°å¢ƒè®Šæ•¸: Redis é€£æ¥é…ç½®
  - Volume: `./storage/outputs`
  
- **Worker æœå‹™**:
  - å»ºç½®: `./worker`
  - ç’°å¢ƒè®Šæ•¸: Redis + ComfyUI é€£æ¥é…ç½®
  - Volume: `./storage`
  - ComfyUI é€£æ¥: `host.docker.internal:8188`

### ä½¿ç”¨æ–¹å¼

#### å•Ÿå‹•æ‰€æœ‰æœå‹™
```bash
docker-compose up -d
```

#### æŸ¥çœ‹æ—¥èªŒ
```bash
docker-compose logs -f backend
docker-compose logs -f worker
```

#### åœæ­¢æ‰€æœ‰æœå‹™
```bash
docker-compose down
```

### æ³¨æ„äº‹é …

1. **ComfyUI å¿…é ˆåœ¨å®¿ä¸»æ©Ÿé‹è¡Œ**
   - Worker é€é `host.docker.internal` é€£æ¥å®¿ä¸»æ©Ÿçš„ ComfyUI
   - ç¢ºä¿ ComfyUI å·²å•Ÿå‹•åœ¨ `http://127.0.0.1:8188`

2. **Volume æ›è¼‰**
   - `./storage/outputs`: ç”Ÿæˆçš„åœ–ç‰‡è¼¸å‡ºç›®éŒ„
   - `./redis_data`: Redis æŒä¹…åŒ–æ•¸æ“š

3. **ç’°å¢ƒè®Šæ•¸**
   - å¯é€é `.env` æª”æ¡ˆæˆ– `docker-compose.yml` è¦†å¯«
   - é‡è¦é…ç½®: `COMFY_HOST`, `REDIS_PASSWORD`

### ç›¸é—œæ–‡ä»¶
- [task.md](openspec/changes/phase-2-maturity/task.md) - Phase 2 ä»»å‹™æ¸…å–®

---

## 2024-12-31: Phase 2 - Step 2: å‹•æ…‹é…ç½®èˆ‡æ‰¹æ¬¡é¡¯ç¤º

### æ¦‚è¿°
å¯¦ç¾å‹•æ…‹æ¨¡å‹åˆ—è¡¨ç²å–å’Œæ‰¹æ¬¡åœ–ç‰‡ç¶²æ ¼é¡¯ç¤ºåŠŸèƒ½ï¼Œè®“å‰ç«¯èƒ½å¤ è‡ªå‹•æƒæ ComfyUI çš„æ¨¡å‹ç›®éŒ„ï¼Œä¸¦å„ªé›…åœ°å±•ç¤ºå¤šå¼µç”Ÿæˆåœ–ç‰‡ã€‚

### è®Šæ›´å…§å®¹

#### 1. Backend - `backend/src/config.py`
- **æ–°å¢ ComfyUI è·¯å¾‘é…ç½®**
  - `COMFYUI_ROOT`: ComfyUI å®‰è£æ ¹ç›®éŒ„
  - `COMFYUI_MODELS_DIR`: æ¨¡å‹ç¸½ç›®éŒ„
  - `COMFYUI_CHECKPOINTS_DIR`: Checkpoint æ¨¡å‹ç›®éŒ„
  - `COMFYUI_UNET_DIR`: UNET æ¨¡å‹ç›®éŒ„

#### 2. Backend API - `backend/src/app.py`
- **æ–°å¢ `GET /api/models` ç«¯é»**
  - æƒæ `checkpoints` ç›®éŒ„ï¼ŒæŸ¥æ‰¾ `.safetensors` å’Œ `.ckpt` æª”æ¡ˆ
  - æƒæ `unet` ç›®éŒ„ï¼ŒæŸ¥æ‰¾ `.safetensors`ã€`.ckpt`ã€`.pt` æª”æ¡ˆ
  - ä½¿ç”¨ç›¸å°è·¯å¾‘ï¼ˆæ”¯æ´å­ç›®éŒ„ï¼‰
  - éŒ¯èª¤è™•ç†ï¼šç›®éŒ„ä¸å­˜åœ¨æ™‚è¿”å›é è¨­æ¨¡å‹åˆ—è¡¨
  - å›æ‡‰æ ¼å¼ï¼š
    ```json
    {
      "models": ["model1.safetensors", "model2.ckpt"],
      "unet_models": ["z-image/z-image-turbo-fp8.safetensors"]
    }
    ```

#### 3. Frontend - `frontend/index.html`
- **å‹•æ…‹æ¨¡å‹è¼‰å…¥åŠŸèƒ½**
  - ç§»é™¤ç¡¬ç·¨ç¢¼çš„ `<option>` æ¨™ç±¤
  - æ–°å¢ `fetchModels()` å‡½æ•¸ï¼š
    - èª¿ç”¨ `GET /api/models` API
    - åˆ†çµ„é¡¯ç¤º UNET å’Œ Checkpoint æ¨¡å‹
    - éŒ¯èª¤è™•ç†ï¼šAPI å¤±æ•—æ™‚é¡¯ç¤ºé è¨­é¸é …
  - åœ¨ `DOMContentLoaded` æ™‚è‡ªå‹•èª¿ç”¨

- **æ‰¹æ¬¡åœ–ç‰‡ç¶²æ ¼é¡¯ç¤ºé©—è­‰**
  - `showResult()` å‡½æ•¸å·²æ­£ç¢ºå¯¦ç¾ï¼š
    - 1å¼µåœ–ï¼š`grid-cols-1` (å–®æ¬„ç½®ä¸­)
    - 2å¼µåœ–ï¼š`grid-cols-2` (é›™æ¬„)
    - 3-4å¼µåœ–ï¼š`grid-cols-2 grid-rows-2` (2x2 ç¶²æ ¼)
  - æ¯å¼µåœ–ç‰‡ç¨ç«‹çš„ä¸‹è¼‰æŒ‰éˆ•
  - éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´ä¸åŒè¢å¹•å°ºå¯¸

### æŠ€è¡“ç´°ç¯€

#### æ¨¡å‹æƒææµç¨‹
```
ComfyUI/models/checkpoints â†’ Backend (éè¿´æƒæ) â†’ API â†’ Frontend (å‹•æ…‹å¡«å……ä¸‹æ‹‰é¸å–®)
ComfyUI/models/unet â†’ Backend (éè¿´æƒæ) â†’ API â†’ Frontend (å‹•æ…‹å¡«å……ä¸‹æ‹‰é¸å–®)
```

#### æ‰¹æ¬¡åœ–ç‰‡é¡¯ç¤ºé‚è¼¯
```javascript
// æ ¹æ“šåœ–ç‰‡æ•¸é‡å‹•æ…‹èª¿æ•´ Grid å¸ƒå±€
if (count === 1) {
    resultsGrid.className = 'grid-cols-1';
} else if (count === 2) {
    resultsGrid.className = 'grid-cols-2';
} else {
    resultsGrid.className = 'grid-cols-2 grid-rows-2';
}
```

### é©—è­‰æ­¥é©Ÿ
1. ç¢ºä¿ ComfyUI å·²å®‰è£æ¨¡å‹
2. å•Ÿå‹• Backend API
3. æ‰“é–‹å‰ç«¯é é¢
4. æª¢æŸ¥æ¨¡å‹ä¸‹æ‹‰é¸å–®æ˜¯å¦é¡¯ç¤ºå¯¦éš›æ¨¡å‹
5. è¨­å®š Batch Size > 1 æ¸¬è©¦å¤šåœ–é¡¯ç¤º

### ç›¸é—œæ–‡ä»¶
- [task.md](openspec/changes/phase-2-maturity/task.md) - Phase 2 ä»»å‹™æ¸…å–®

---

## 2024-12-31: Phase 2 - Step 1: å³æ™‚é€²åº¦æ¢å¯¦è£

### æ¦‚è¿°
å¯¦ç¾å³æ™‚é€²åº¦åé¥‹åŠŸèƒ½ï¼Œè®“ä½¿ç”¨è€…åœ¨ç”Ÿæˆåœ–ç‰‡æ™‚èƒ½çœ‹åˆ°å¯¦éš›é€²åº¦ç™¾åˆ†æ¯”ï¼Œè€Œéåªæœ‰éœæ…‹çš„ "Processing..." è¨Šæ¯ã€‚

### è®Šæ›´å…§å®¹

#### 1. Worker - `worker/src/comfy_client.py`
- **`wait_for_completion()` æ–¹æ³•å¢å¼·**
  - æ–°å¢ `on_progress` å›èª¿å‡½æ•¸åƒæ•¸
  - ç›£è½ ComfyUI WebSocket çš„ `progress` äº‹ä»¶
  - è§£æ `{'type': 'progress', 'data': {'value': X, 'max': Y}}` è¨Šæ¯
  - è¨ˆç®—é€²åº¦ç™¾åˆ†æ¯”ï¼š`int((value / max) * 100)`
  - é€éå›èª¿å‡½æ•¸é€šçŸ¥é€²åº¦æ›´æ–°

#### 2. Worker - `worker/src/main.py`
- **`process_job()` å‡½æ•¸é‡æ§‹**
  - ä¿®æ­£åŸ·è¡Œæµç¨‹ï¼š`queue_prompt()` â†’ `wait_for_completion()` â†’ `copy_output_image()`
  - æ–°å¢ `on_progress` å›èª¿å‡½æ•¸ï¼Œå°‡é€²åº¦æ˜ å°„åˆ° 30-95% å€é–“
  - ä¿®æ­£ä»»å‹™å®Œæˆç‹€æ…‹ç‚º `finished`ï¼ˆèˆ‡å‰ç«¯ä¸€è‡´ï¼‰
  - æ–°å¢è¼¸å‡ºåœ–ç‰‡è¤‡è£½é‚è¼¯

#### 3. Backend API - `backend/src/app.py`
- **`GET /api/status/<job_id>` ç«¯é»**
  - å·²æ­£ç¢ºå¯¦ç¾ï¼Œè¿”å› `progress` æ¬„ä½
  - å›æ‡‰æ ¼å¼ï¼š`{"status": "processing", "progress": 50, "image_url": "", "error": ""}`

#### 4. Frontend - `frontend/index.html`
- **`pollStatus()` å‡½æ•¸**
  - å·²æ­£ç¢ºå¯¦ç¾ï¼Œè®€å– `data.progress` ä¸¦é¡¯ç¤º
  - ç‹€æ…‹è¨Šæ¯æ ¼å¼ï¼š`ğŸ”„ Processing... {progress}%`

### æŠ€è¡“ç´°ç¯€

#### é€²åº¦è¨ˆç®—æµç¨‹
```
ComfyUI WebSocket â†’ Worker (comfy_client.py) â†’ Redis (job:status:<job_id>) â†’ API â†’ Frontend
```

#### é€²åº¦æ˜ å°„
- 10%: ä»»å‹™é–‹å§‹è™•ç†
- 15%: è™•ç†ä¸Šå‚³åœ–ç‰‡
- 20%: è§£æ Workflow
- 30%: æäº¤ä»»å‹™åˆ° ComfyUI
- 30-95%: ComfyUI åŸ·è¡Œä¸­ï¼ˆç”± `progress` äº‹ä»¶å‹•æ…‹æ›´æ–°ï¼‰
- 100%: ä»»å‹™å®Œæˆ

### é©—è­‰æ­¥é©Ÿ
1. å•Ÿå‹• Redisã€Backendã€Worker æœå‹™
2. å•Ÿå‹• ComfyUI
3. åœ¨å‰ç«¯æäº¤ç”Ÿæˆè«‹æ±‚
4. è§€å¯Ÿç‹€æ…‹è¨Šæ¯æ˜¯å¦é¡¯ç¤ºå‹•æ…‹é€²åº¦ç™¾åˆ†æ¯”

### ç›¸é—œæ–‡ä»¶
- [task.md](openspec/changes/phase-2-maturity/task.md) - Phase 2 ä»»å‹™æ¸…å–®
